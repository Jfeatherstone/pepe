<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.0"/>
    <title>pepe.auto.ForceSolve API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../auto.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pepe.auto</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#forceSolveArgDTypes">forceSolveArgDTypes</a>
            </li>
            <li>
                    <a class="variable" href="#excludedArgs">excludedArgs</a>
            </li>
            <li>
                    <a class="function" href="#forceSolve">forceSolve</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../pepe.html">pepe</a><wbr>.<a href="./../auto.html">auto</a><wbr>.ForceSolve    </h1>

                        <div class="docstring"><p>Start from a directory of images and solve for all of the particle positions, orientations, and forces.</p>
</div>

                        <input id="mod-ForceSolve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-ForceSolve-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">Start from a directory of images and solve for all of the particle positions, orientations, and forces.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span> <span class="nn">cv2</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span> <span class="nn">inspect</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span> <span class="nn">ast</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">tqdm</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">import</span> <span class="nn">pepe</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">from</span> <span class="nn">pepe.preprocess</span> <span class="kn">import</span> <span class="n">checkImageType</span><span class="p">,</span> <span class="n">lightCorrectionDiff</span><span class="p">,</span> <span class="n">circularMask</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span> <span class="nn">pepe.analysis</span> <span class="kn">import</span> <span class="n">initialForceSolve</span><span class="p">,</span> <span class="n">forceOptimize</span><span class="p">,</span> <span class="n">gSquared</span><span class="p">,</span> <span class="n">g2ForceCalibration</span><span class="p">,</span> <span class="n">singleParticleForceBalance</span><span class="p">,</span> <span class="n">forceOptimizeArgDTypes</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span> <span class="nn">pepe.tracking</span> <span class="kn">import</span> <span class="n">houghCircle</span><span class="p">,</span> <span class="n">convCircle</span><span class="p">,</span> <span class="n">angularConvolution</span><span class="p">,</span> <span class="n">circleTrackArgDTypes</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span> <span class="nn">pepe.simulate</span> <span class="kn">import</span> <span class="n">genSyntheticResponse</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span> <span class="nn">pepe.utils</span> <span class="kn">import</span> <span class="n">preserveOrderArgsort</span><span class="p">,</span> <span class="n">rectangularizeForceArrays</span><span class="p">,</span> <span class="n">explicitKwargs</span><span class="p">,</span> <span class="n">parseList</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">pepe.visualize</span> <span class="kn">import</span> <span class="n">genColors</span><span class="p">,</span> <span class="n">visCircles</span><span class="p">,</span> <span class="n">visForces</span><span class="p">,</span> <span class="n">visContacts</span><span class="p">,</span> <span class="n">visRotation</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">from</span> <span class="nn">pepe.topology</span> <span class="kn">import</span> <span class="n">findPeaksMulti</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="c1"># All of the dtypes of the args for the below method</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="c1"># The following args are not included, because they are not</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="c1"># important: progressBarOffset, progressBarTitle</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="n">forceSolveArgDTypes</span>  <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>            <span class="s2">&quot;imageExtension&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>            <span class="s2">&quot;imageEndIndex&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>            <span class="s2">&quot;imageStartIndex&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>            <span class="s2">&quot;carryOverAlpha&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>            <span class="s2">&quot;carryOverForce&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>            <span class="s2">&quot;showProgressBar&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>            <span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>            <span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>            <span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>            <span class="s2">&quot;g2CalibrationImage&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>            <span class="s2">&quot;g2CalibrationCutoffFactor&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>            <span class="s2">&quot;maskImage&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>            <span class="s2">&quot;cropXMin&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>            <span class="s2">&quot;cropXMax&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>            <span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>            <span class="s2">&quot;guessRadius&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>            <span class="s2">&quot;fSigma&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>            <span class="s2">&quot;pxPerMeter&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>            <span class="s2">&quot;brightfield&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>            <span class="s2">&quot;contactPadding&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>            <span class="s2">&quot;g2MaskPadding&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>            <span class="s2">&quot;contactMaskRadius&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>            <span class="s2">&quot;peBlurKernel&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>            <span class="s2">&quot;requireForceBalance&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>            <span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>            <span class="s2">&quot;circleTrackingGain&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>            <span class="s2">&quot;circleTrackingKwargs&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>            <span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>            <span class="s2">&quot;photoelasticGain&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>            <span class="s2">&quot;optimizationKwargs&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>            <span class="s2">&quot;maxBetaDisplacement&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>            <span class="s2">&quot;forceNoiseWidth&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>            <span class="s2">&quot;alphaNoiseWidth&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>            <span class="s2">&quot;saveMovie&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>            <span class="s2">&quot;pickleArrays&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>            <span class="s2">&quot;outputRootFolder&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>            <span class="s2">&quot;outputExtension&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>            <span class="s2">&quot;genFitReport&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>            <span class="s2">&quot;performOptimization&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>            <span class="s2">&quot;inputSettingsFile&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>            <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">}</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="c1"># These dtypes don&#39;t matter, so we don&#39;t need to carry them</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="c1"># through the settings file, but we want to explicitly define</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="c1"># them so that the test function in pepe/test/test_auto.py</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="c1"># doesn&#39;t catch them as missing</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="n">excludedArgs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;progressBarOffset&quot;</span><span class="p">,</span> <span class="s2">&quot;progressBarTitle&quot;</span><span class="p">]</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="c1"># Decorator that allows us to identify which keyword arguments were explicitly</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="c1"># passed to the function, and which were left as default values. See beginning</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="c1"># of method code for more information/motivation.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="nd">@explicitKwargs</span><span class="p">()</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="k">def</span> <span class="nf">forceSolve</span><span class="p">(</span><span class="n">imageDirectory</span><span class="p">,</span> <span class="n">guessRadius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fSigma</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pxPerMeter</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">brightfield</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">contactPadding</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">g2MaskPadding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">contactMaskRadius</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">lightCorrectionImage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lightCorrectionHorizontalMask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lightCorrectionVerticalMask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">g2CalibrationImage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">g2CalibrationCutoffFactor</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span> <span class="n">maskImage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cropXMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cropXMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">peBlurKernel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">imageExtension</span><span class="o">=</span><span class="s1">&#39;bmp&#39;</span><span class="p">,</span> <span class="n">requireForceBalance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">imageStartIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">imageEndIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">carryOverAlpha</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">carryOverForce</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">circleDetectionMethod</span><span class="o">=</span><span class="s1">&#39;convolution&#39;</span><span class="p">,</span> <span class="n">circleTrackingKwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">circleTrackingChannel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">circleTrackingGain</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">maxBetaDisplacement</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">photoelasticChannel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">photoelasticGain</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">forceNoiseWidth</span><span class="o">=</span><span class="mf">.03</span><span class="p">,</span> <span class="n">alphaNoiseWidth</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span> <span class="n">optimizationKwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">performOptimization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showProgressBar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">progressBarOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">progressBarTitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saveMovie</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outputRootFolder</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">inputSettingsFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pickleArrays</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">genFitReport</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outputExtension</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">    Complete pipeline to solve for forces and particle positions for all image files</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">    in a directory. Results will be returned and potentially written to various files.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">    See `Returns` section for more information</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">    Expects all particles to be the same (or very similar) sizes. This assumption is made</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">    by the calculation of the gradient squared calibration value, which is computed just</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">    once using the guess of the radii. This should not be a problem if the radii are only</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">    slightly varied (~10 pixels or something) but any more than that and errors will begin</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">    to accumulate.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">    This method has **a lot** of arguments; it is intended to be used once reasonable</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">    values for all of these have already been found. While the `debug` option for this function</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">    is very helpful, it is recommended to utilize the various notebooks/examples to find good</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">    choices for parameters first.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">    The output readme file can also serve as a cache of the parameter values/settings, which</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">    can be passed back to future calls of this method using the `inputSettingsFile` argument.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">    Parameters</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">    ----------</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">    imageDirectory : str</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">        An absolute or relative path to the directory containing the images that are</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">        to be analyzed. The names of the images need not follow any particular naming</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">        scheme, but they should be such that sorting the list alphabetically will give</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">        the images in their proper order.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">    guessRadius : float</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">        The radius of the particles to be detected, in pixels. As of now, this value will</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">        be taken as the particle radius, but future versions may be able to vary this to</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">        find the optimal value.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">        Currently no support for particles of different sizes.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">    fSigma : float</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">        Stress optic coefficient, relating to material thickness, wavelength of light and</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">        other material property (denoted as C in most literature; sometimes also called the</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        &quot;stress optic coefficient&quot;).</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">    pxPerMeter : float</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        The number of pixels per meter in the images. Depends on the camera, lens, and </span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        zoom settings used to capture the images.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">        Note that this is **not** the inverse of the number of pixels per meter, as is used</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">        in some of the other force solving implementations.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">    brightfield : bool</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        Whether the images are captured using a brightfield polariscope (`True`) or</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        a darkfield polariscope (`False`).</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">    contactPadding : int</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        Maximum distance (in pixels) between a particle&#39;s edge and the wall or the edges of two</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">        particles that will still be considered a potential force-bearing contact.</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">    g2MaskPadding : int or float</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">        Number of pixels to ignore at the edge of each particle when calculating the average G^2.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">        If float value &lt; 1 is passed, gradient mask radius will be taken as that percent of the full</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        particle radius. A value of 0 means no padding is included.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">    contactMaskRadius : float</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        The radius of the circular mask that will be constructed around each contact to estimate</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        the magnitude of the force using the gradient squared in that region.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">    lightCorrectionImage : str or np.ndarray[H,W[,C]]</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        The path to an image (or an array representing an image) that contains no particles, and</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        can be used to correct for any light gradients present in the actual data.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">    lightCorrectionHorizontalMask : str or np.ndarray[H,W[,C]]</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        A mask array, containing values of `0` or `1`, with the latter representing areas over which</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        the horizontal light correction should be calculated. Can also be a path to an image.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">    lightCorrectionVerticalMask : str or np.ndarray[H,W[,C]]</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">        A mask array, containing values of `0` or `1`, with the latter representing areas over which</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">        the vertical light correction should be calculated. Can also be a path to an image.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">    g2CalibrationImage : str or np.ndarray[H,W,C]</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        An image with a single particle (or at least one particle) that has no force acting on it.</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        Used to determine the base level of gradient squared (due to noise) for a free particle. Can</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">        also be a path to an image.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">    g2CalibrationCutoffFactor : float</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">        The factor that is multipled by the mean gradient squared value of the particles in the </span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">        calibration image. Any particle that has an average gradient squared value below the </span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">        calibration value multipled by this factor will be assumed to have no forces acting on it.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">    maskImage : str or np.ndarray[H,W,C]</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">        A mask array, containing values of `0` or `1`, with the latter representing the regions of</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">        importance for the image. Used in detecting particles, generating initial guesses, and</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        calculating error during non-linear optimization. can also be a path to an image.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">    cropXMin : int or None</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        Left bound to crop down the image in the x direction.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">    cropXMax : int or None</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        Right bound to crop down the image in the x direction.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">    peBlurKernel : int</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">        The kernel size that will be used for bluring the photoelastic channel of each image, to</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        reduce noise. Should be an odd integer.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">    imageExtension : str</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">        The extension of the image files that will be read in from `imageDirectory`. Should not include</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">        the &#39;.&#39; before the extension.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">    requireForceBalance : bool</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        Whether to impose particle-wise force balance at each step (`True`) or to take the results of</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">        the optimization process as they are (`False`).</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">        Currently WIP, and does not do anything.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">    forceBalanceWeighting : float</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">        If a non-zero positive value, adds a contribution to the optimization cost</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">        pertaining to how well the ensemble of forces satisfy force balance.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">    imageStartIndex : int or None</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">        The index of which image to start at when analyzing the files in `imageDirectory`. Value</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">        of `None` will start at the first (alphabetically sorted) image.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">    imageEndIndex : int or None</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        The index of which image to end at when analyzing the files in `imageDirectory`. Value</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">        of `None` will end at the last (alphabetically sorted) image.</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">    circleDetectionMethod : [&#39;convolution&#39; or &#39;hough&#39;]</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">        Whether to use the convolution or hough circle detection method to identify particles.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">        See `pepe.tracking.convCircle()` and `pepe.tracking.houghCircle()` for more information.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">    circleTrackingKwargs : **kwargs</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        Keyword arguments to be passed to the selected circle tracking function.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        See `pepe.tracking.convCircle()` and `pepe.tracking.houghCircle()` for more information.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">    circleTrackingChannel : int</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">        The channel of the image that will be used to track the particles. `0` for red, `1` for</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        green, and `2` for blue.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">    circleTrackingGain : float</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        The gain applied to the intensity in the circle tracking channel.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">    maxBetaDisplacement : float</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        The maximum distance (angle) that a force can move between frames and still be identified</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        as the same force. If a force moves more than this value, it will still be recorded as a force,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">        but will be considered a new and independent force from any of the ones in the previous frame.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">    photoelasticChannel : int</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">        The channel of the image that will be used to gauge the photoelastic response. `0` for red, `1` for</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        green, and `2` for blue.</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">    photoelasticGain : float</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">        The gain applied to the intensity in the photoelastic channel.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">    forceNoiseWidth : float or None</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">        The width of the gaussian distribution (centered at 0) that noise is sampled from to add to the</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">        force guesses (potentially from the previous frame). This is done to avoid getting stuck in a local</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        minimum for too long (adds some Monte-Carlo-esque behavior to the solving).</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">    alphaNoiseWidth : float or None</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        The width of the gaussian distribution (centered at 0) that noise is sampled from to add to the</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        alpha guesses (potentially from the previous frame). This is done to avoid getting stuck in a local</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        minimum for too long (adds some Monte-Carlo-esque behavior to the solving).</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">    optimizationKwargs : **kwargs</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        Keyword arguments to be passed to the optimization process.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        For more information, see `pepe.analysis.forceOptimize()`.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">    performOptimization : bool</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">        Whether or not to perform optimization on the particles.</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">        Mostly included as a debug option, but any real data analysis should</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">        utilize the optimization, as the initial guessing is often not nearly</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">        accurate enough to get any real results.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">    debug : bool</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        Whether to print progress updates for each frame to the screen (`True`) or not (`False`).</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">    showProgressBar : bool</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">        Whether to show a progress bar throughout the analysis (`True`) or not (`False`). Uses</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">        `tqdm` library.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">    progressBarOffset : int</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        The number of lines to offset the progress bar by. Generally an internal variable</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        used when multiple threads are active.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">    progressBarTitle : str</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        The text to be written to the left of the progress bar. Generally an internal variable</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        controlled by some solving script.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">    saveMovie : bool</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        Whether to save a compiled gif of the reconstructed forces at each frame at the end (`True`)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        or not (`False`).</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">    outputRootFolder : str</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        The location where the output folder (potentially containg the movie, pickle files, readme, etc.)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">        will be created. Output folder itself will be named after the `imageDirectory`, with &#39;_Synthetic&#39;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        appended to the end.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">    pickleArrays : bool</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">        Whether to save the forces, betas, alphas, centers, and radii as pickle files (`True`) or not (`False`).</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">        Files will be located in the output folder (see `outputRootFolder`).</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">    inputSettingsFile : str</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">        Path to a readme file containg parameters for the solving process, likely generated from</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">        a previous iteration of the program. Explicitly passed arguments will override those that</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">        are included in the settings file.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">        Currently WIP and does not do anything.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">    genFitReport : bool</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">        Whether or not to generate a fit report of the results, including errors per frame,</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">        examinations of all particles/forces, and settings, compiled in a latex pdf.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">        Will generate both the compiled file &#39;FitReport.pdf&#39; and the source directory</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">        &#39;FitReport_src/&#39;.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">    </span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">    Returns</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">    -------</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">    rectForceArr : list[P](np.ndarray[F,T])</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        A list of arrays representing the force magnitude for each force on each particle.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">    rectAlphaArr : list[P](np.ndarray[F,T])</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">        A list of arrays representing the alpha angle for each force on each particle.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">    rectBetaArr : list[P](np.ndarray[F,T])</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">        A list of arrays representing the beta angle for force on each particle.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">    rectCenterArr : np.ndarray[P,T,2]</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a><span class="sd">        Particle centers for each timestep. Elements take on a value of `[np.nan, np.nan]`</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        if the particle does not exist for a given timestep.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">    rectRadiusArr : np.ndarray[P,T]</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">        Particle radii for each timestep. Elements take on a value of `np.nan` if the particle</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">        does not exist for a given timestep.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">    Depending on kwarg values, several files may be written created in the output</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">    folder, which will be located in `outputRootFolder` and named according</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">    to:  &#39;&lt;`imageDirectory`&gt;_Synthetic/&#39;.</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>   
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="n">overallStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>    <span class="c1"># For the sake of saving the options to a readme file (and potentially)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>    <span class="c1"># reading them back out, it is easiest to keep all of the settings in a</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>    <span class="c1"># dictionary</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="c1"># We have 3 layers of precedence for reading in settings:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>    <span class="c1"># 1. Explicitly passed kwarg</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="c1"># 2. Read in from settings file</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>    <span class="c1"># 3. Default value of a kwarg</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>    <span class="c1"># So we assign the elements of our settings dict in opposite order</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>    <span class="c1"># 3. All of the default values</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>    <span class="c1"># The following variables are not present:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>    <span class="c1"># progressBarOffset, progressBarTitle</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>    <span class="c1"># This is because we don&#39;t care about saving them</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>    <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">imageDirectory</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="c1"># Convert to absolute path</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                <span class="s2">&quot;imageExtension&quot;</span><span class="p">:</span> <span class="n">imageExtension</span><span class="p">,</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                <span class="s2">&quot;imageEndIndex&quot;</span><span class="p">:</span> <span class="n">imageEndIndex</span><span class="p">,</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                <span class="s2">&quot;imageStartIndex&quot;</span><span class="p">:</span> <span class="n">imageStartIndex</span><span class="p">,</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                <span class="s2">&quot;carryOverAlpha&quot;</span><span class="p">:</span> <span class="n">carryOverAlpha</span><span class="p">,</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                <span class="s2">&quot;carryOverForce&quot;</span><span class="p">:</span> <span class="n">carryOverForce</span><span class="p">,</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                <span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">:</span> <span class="n">lightCorrectionImage</span><span class="p">,</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                <span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">:</span> <span class="n">lightCorrectionVerticalMask</span><span class="p">,</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                <span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">:</span> <span class="n">lightCorrectionHorizontalMask</span><span class="p">,</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                <span class="s2">&quot;g2CalibrationImage&quot;</span><span class="p">:</span> <span class="n">g2CalibrationImage</span><span class="p">,</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                <span class="s2">&quot;g2CalibrationCutoffFactor&quot;</span><span class="p">:</span> <span class="n">g2CalibrationCutoffFactor</span><span class="p">,</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                <span class="s2">&quot;maskImage&quot;</span><span class="p">:</span> <span class="n">maskImage</span><span class="p">,</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                <span class="s2">&quot;cropXMin&quot;</span><span class="p">:</span> <span class="n">cropXMin</span><span class="p">,</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                <span class="s2">&quot;cropXMax&quot;</span><span class="p">:</span> <span class="n">cropXMax</span><span class="p">,</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                <span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">:</span> <span class="n">circleDetectionMethod</span><span class="p">,</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                <span class="s2">&quot;guessRadius&quot;</span><span class="p">:</span> <span class="n">guessRadius</span><span class="p">,</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>                <span class="s2">&quot;fSigma&quot;</span><span class="p">:</span> <span class="n">fSigma</span><span class="p">,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>                <span class="s2">&quot;pxPerMeter&quot;</span><span class="p">:</span> <span class="n">pxPerMeter</span><span class="p">,</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                <span class="s2">&quot;brightfield&quot;</span><span class="p">:</span> <span class="n">brightfield</span><span class="p">,</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                <span class="s2">&quot;contactPadding&quot;</span><span class="p">:</span> <span class="n">contactPadding</span><span class="p">,</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                <span class="s2">&quot;g2MaskPadding&quot;</span><span class="p">:</span> <span class="n">g2MaskPadding</span><span class="p">,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                <span class="s2">&quot;contactMaskRadius&quot;</span><span class="p">:</span> <span class="n">contactMaskRadius</span><span class="p">,</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                <span class="s2">&quot;peBlurKernel&quot;</span><span class="p">:</span> <span class="n">peBlurKernel</span><span class="p">,</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                <span class="s2">&quot;requireForceBalance&quot;</span><span class="p">:</span> <span class="n">requireForceBalance</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                <span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">:</span> <span class="n">circleTrackingChannel</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                <span class="s2">&quot;circleTrackingGain&quot;</span><span class="p">:</span> <span class="n">circleTrackingGain</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                <span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">:</span> <span class="n">photoelasticChannel</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                <span class="s2">&quot;photoelasticGain&quot;</span><span class="p">:</span> <span class="n">photoelasticGain</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                <span class="s2">&quot;maxBetaDisplacement&quot;</span><span class="p">:</span> <span class="n">maxBetaDisplacement</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                <span class="s2">&quot;forceNoiseWidth&quot;</span><span class="p">:</span> <span class="n">forceNoiseWidth</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                <span class="s2">&quot;alphaNoiseWidth&quot;</span><span class="p">:</span> <span class="n">alphaNoiseWidth</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                <span class="s2">&quot;showProgressBar&quot;</span><span class="p">:</span> <span class="n">showProgressBar</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>                <span class="s2">&quot;saveMovie&quot;</span><span class="p">:</span> <span class="n">saveMovie</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                <span class="s2">&quot;pickleArrays&quot;</span><span class="p">:</span> <span class="n">pickleArrays</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>                <span class="s2">&quot;outputRootFolder&quot;</span><span class="p">:</span> <span class="n">outputRootFolder</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>                <span class="s2">&quot;outputExtension&quot;</span><span class="p">:</span> <span class="n">outputExtension</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>                <span class="s2">&quot;genFitReport&quot;</span><span class="p">:</span> <span class="n">genFitReport</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>                <span class="s2">&quot;performOptimization&quot;</span><span class="p">:</span> <span class="n">performOptimization</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="n">debug</span><span class="p">}</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>    <span class="c1"># For the next step, we will need to know all of the data types of each</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>    <span class="c1"># argument (to properly cast). Because certain arguments have None as a default</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>    <span class="c1"># value, we can&#39;t automatically generate this information.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>    <span class="c1"># See above this method for the list of these, since they are also used</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>    <span class="c1"># in the TrialObject file</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>    <span class="c1"># We need to do the same thing for the kwargs for both</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>    <span class="c1"># circle tracking and optimization</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>    <span class="c1"># These have both been moved to either the tracking/DTypes.py</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>    <span class="c1"># or the analysis/ForceSolve.py files, respectively</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>    <span class="c1"># Now add all the dictionaries together</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>    <span class="n">argDTypes</span> <span class="o">=</span> <span class="n">forceSolveArgDTypes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>    <span class="n">argDTypes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">circleTrackArgDTypes</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>    <span class="n">argDTypes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">forceOptimizeArgDTypes</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>    <span class="c1"># 2. Anything read in from a settings file</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="c1"># Note that it works to our advantage that we already have values for most entries,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="c1"># since the settings file doesn&#39;t include type information, so we need the old</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="c1"># values to cast properly. 1. is actually contained in here as well, because</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="c1"># we can just check to see if that variable was explicitly passed before overwriting it.</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="c1"># 1. The kwargs that are explicitly passed</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>    <span class="c1"># This one is a little tricky, because there isn&#39;t a super great way by default</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>    <span class="c1"># to differentiate whether a kwarg is explicitly passed or is its default value</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>    <span class="c1"># (without just keeping a list of default values). I also don&#39;t want to</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="c1"># replace the entire function signature with (*args, **kwargs) because then the</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>    <span class="c1"># documentation would not be as good (I think). So the solution here is to define</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>    <span class="c1"># a decorator that has the (*args, **kwargs) signature, and to create an attribute</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>    <span class="c1"># of this method that is a list of the kwargs that are explicitly passed to the</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>    <span class="c1"># decorator. See `pepe.utils.explicitKwargs()` for more info.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>    <span class="k">if</span> <span class="n">inputSettingsFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inputSettingsFile</span><span class="p">):</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>            <span class="n">fileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">inputSettingsFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileObj</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>                <span class="c1"># Check each line and see if it looks like a dictionary value</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>                <span class="n">split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>                <span class="c1"># Read settings into the master settings file</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">argDTypes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">forceSolve</span><span class="o">.</span><span class="n">explicit_kwargs</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>                    <span class="c1"># Cast to the type of the value already in the dict</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>                    <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>                        <span class="n">settings</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>                        <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>                            <span class="n">settings</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">parseList</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">argDTypes</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()])</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                            <span class="c1"># Bools need a special condition</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                            <span class="k">if</span> <span class="n">argDTypes</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>                                <span class="n">val</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>                                <span class="n">val</span> <span class="o">=</span> <span class="n">argDTypes</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()](</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>                            <span class="n">settings</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: provided settings file does not exist! Attempting to run regardless...&#39;</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>    <span class="c1"># While the following variables all have a default value of 0, they cannot actually</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>    <span class="c1"># be left as this value. The reason they have a default value is so that if these</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>    <span class="c1"># values are indicated by a settings file, we don&#39;t want to have to enter them again.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>    <span class="c1"># So here, we make sure we have values for them all, either explicitly passed or read in.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="n">requiredVars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">,</span> <span class="s2">&quot;fSigma&quot;</span><span class="p">,</span> <span class="s2">&quot;pxPerMeter&quot;</span><span class="p">]</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requiredVars</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="k">assert</span> <span class="n">settings</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1"> value not supplied explicitly or implicitly!&#39;</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="c1"># Now carry over the kwargs that are sent to the optimization procedure into that</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>    <span class="c1"># dictionary. We can find the names of arguments by using the `inspect` library</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>    <span class="n">possibleOptimKwargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">forceOptimize</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>    <span class="k">for</span> <span class="n">pkw</span> <span class="ow">in</span> <span class="n">possibleOptimKwargs</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="k">if</span> <span class="n">pkw</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="n">optimizationKwargs</span><span class="p">[</span><span class="n">pkw</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">pkw</span><span class="p">]</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="c1"># We want to do the same thing for the circle tracking function, but we don&#39;t</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>    <span class="c1"># yet know which circle tracking function we are using yet, so we&#39;ll carry</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>    <span class="c1"># that over a bit later.</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>    <span class="c1"># Find all images in the directory</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>    <span class="n">imageFiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">])</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>    <span class="c1"># This goes before the sorting/extension filtering so we can get more specific</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>    <span class="c1"># error messages (and we have another one of these below)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: directory </span><span class="si">{</span><span class="n">imageDirectory</span><span class="si">}</span><span class="s1"> contains no files!&#39;</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>    <span class="n">imageFiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">img</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imageFiles</span> <span class="k">if</span> <span class="n">img</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageExtension&quot;</span><span class="p">]):]</span> <span class="o">==</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageExtension&quot;</span><span class="p">]])</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>    <span class="c1"># DEBUG:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>    <span class="c1">#imageFiles = imageFiles[::-1]</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>    <span class="c1"># We have to do the end index first, so it doesn&#39;t mess up the start one</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageEndIndex&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>        <span class="n">imageFiles</span> <span class="o">=</span> <span class="n">imageFiles</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageEndIndex&quot;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))]</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageStartIndex&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="n">imageFiles</span> <span class="o">=</span> <span class="n">imageFiles</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageStartIndex&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">):]</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>    <span class="c1"># Make sure we still have some proper images</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: directory </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1"> contains no files with extension </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageExtension&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">!&#39;</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>    <span class="n">xB</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;cropXMin&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;cropXMax&quot;</span><span class="p">]]</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>    <span class="n">imageSize</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">imageFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>    <span class="c1"># This will calculation the light correction across the images </span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="c1"># Convert to absolute paths if they are paths</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">])</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">])</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">])</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="n">cImageProper</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>        <span class="n">vMask</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="n">hMask</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="k">if</span> <span class="n">vMask</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="n">vMask</span> <span class="o">=</span> <span class="n">vMask</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="k">if</span> <span class="n">hMask</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>            <span class="n">hMask</span> <span class="o">=</span> <span class="n">hMask</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>        <span class="n">lightCorrection</span> <span class="o">=</span> <span class="n">lightCorrectionDiff</span><span class="p">(</span><span class="n">cImageProper</span><span class="p">,</span> <span class="n">vMask</span><span class="p">,</span> <span class="n">hMask</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="n">trackCorrection</span> <span class="o">=</span> <span class="n">lightCorrection</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="n">peCorrection</span> <span class="o">=</span> <span class="n">lightCorrection</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">]]</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="c1"># It probably isn&#39;t great hygiene to have this variableflip between a single</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>        <span class="c1"># value and an array, but you can always add a scalar to a numpy array, so</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="c1"># this is the easiest way (since we haven&#39;t loaded any images yet)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="n">trackCorrection</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="n">peCorrection</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>    <span class="c1"># Load up the mask image, which will be used to remove parts of the images</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>    <span class="c1"># that we don&#39;t care about, and also potentially indicate which particles</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>    <span class="c1"># are close to the boundary.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;maskImage&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="n">maskArr</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;maskImage&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="n">ignoreBoundary</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="c1"># Same deal as above: scalar multiplication functions exactly how we want</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="c1"># in the case that we don&#39;t have a mask, so it&#39;s just easier to do this.</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="n">maskArr</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="n">ignoreBoundary</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>    <span class="c1"># Which method we will be using to detect circles</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;convolution&#39;</span><span class="p">:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="n">circFunc</span> <span class="o">=</span> <span class="n">convCircle</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>    <span class="k">elif</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hough&#39;</span><span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="n">circFunc</span> <span class="o">=</span> <span class="n">houghCircle</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: circle detection option </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1"> not recognized!&#39;</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="c1"># Now that we have a circle tracking function, we can carry over any possible kwargs</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="n">possibleCircleKwargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">circFunc</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="k">for</span> <span class="n">pkw</span> <span class="ow">in</span> <span class="n">possibleCircleKwargs</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="k">if</span> <span class="n">pkw</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>            <span class="n">circleTrackingKwargs</span><span class="p">[</span><span class="n">pkw</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">pkw</span><span class="p">]</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>    <span class="c1"># Calculate the lowest g2 value that we care about, so we can throw everything</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>    <span class="c1"># that is below that away when solving (optional)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="n">checkMinG2</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;g2CalibrationImage&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="n">g2CalImage</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;g2CalibrationImage&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="n">g2CalPEImage</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticGain&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">g2CalImage</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">peCorrection</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;peBlurKernel&quot;</span><span class="p">],</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;peBlurKernel&quot;</span><span class="p">]))</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="c1"># Locate particles</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="n">centers</span><span class="p">,</span> <span class="n">radii</span> <span class="o">=</span> <span class="n">circFunc</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingGain&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">g2CalImage</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">trackCorrection</span><span class="p">)</span> <span class="o">*</span> <span class="n">maskArr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">circleTrackingKwargs</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="c1"># There should only be 1 particle in the calibration image</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: Gradient-squared calibration image does not contain any particles! Ignoring...&#39;</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>            <span class="n">particleMask</span> <span class="o">=</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">g2CalPEImage</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">centers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="n">gSqr</span> <span class="o">=</span> <span class="n">gSquared</span><span class="p">(</span><span class="n">g2CalPEImage</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>            <span class="n">minParticleG2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gSqr</span> <span class="o">*</span> <span class="n">particleMask</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">particleMask</span><span class="p">)</span> <span class="o">*</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;g2CalibrationCutoffFactor&quot;</span><span class="p">]</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="n">checkMinG2</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>    <span class="c1"># The arrays that we will be building for each timestep. It is better to just</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>    <span class="c1"># use an untyped list since the arrays are all triangular and whatnot.</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>    <span class="n">centersArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>    <span class="n">radiiArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>    
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>    <span class="n">forceArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>    <span class="n">betaArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>    <span class="n">alphaArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>    <span class="n">imageArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="n">errorArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>    <span class="c1"># For keeping track of time (though will only be display if debug=True)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>    <span class="n">trackingTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>    <span class="n">initialGuessTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>    <span class="n">optimizationTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>    <span class="n">miscTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>    <span class="n">totalFailedParticles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>    <span class="n">errorMsgs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;showProgressBar&quot;</span><span class="p">]:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="n">bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">progressBarOffset</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">progressBarTitle</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>    <span class="c1"># Calculate the gradient-squared-to-force calibration value</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>    <span class="n">g2Cal</span> <span class="o">=</span> <span class="n">g2ForceCalibration</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fSigma&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pxPerMeter&quot;</span><span class="p">])</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>    <span class="c1"># The big loop that iterates over every image</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)):</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">imageFiles</span><span class="p">[</span><span class="n">i</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="c1"># Convert to floats on the domain [0,1], so we can compare to the output of </span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>        <span class="c1"># genSyntheticResponse()</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="n">peImage</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticGain&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">image</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">peCorrection</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;peBlurKernel&quot;</span><span class="p">],</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;peBlurKernel&quot;</span><span class="p">]))</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="c1"># -------------</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="c1"># Track circles</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="c1"># -------------</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="n">centers</span><span class="p">,</span> <span class="n">radii</span> <span class="o">=</span> <span class="n">circFunc</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingGain&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">image</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">trackCorrection</span><span class="p">)</span> <span class="o">*</span> <span class="n">maskArr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">circleTrackingKwargs</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="c1"># We do some indexing using the centers/radii, so it is helpful</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="c1"># to have them as an integer type</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="c1">#centers = centers.astype(np.int64)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="c1">#radii = radii.astype(np.int64)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>        <span class="c1"># We want to keep the order of particles constant, so we make sure</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="c1"># that they are (to whatever extent possible) in the same order</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="c1"># as the previous frame. This involves finding the closest neighbor</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="c1"># from the previous frame.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">centersArr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>            <span class="n">centerOrder</span> <span class="o">=</span> <span class="n">preserveOrderArgsort</span><span class="p">(</span><span class="n">centersArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">centers</span><span class="p">,</span> <span class="n">padMissingValues</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>            <span class="n">centers</span> <span class="o">=</span> <span class="n">centers</span><span class="p">[</span><span class="n">centerOrder</span><span class="p">]</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>            <span class="n">radii</span> <span class="o">=</span> <span class="n">radii</span><span class="p">[</span><span class="n">centerOrder</span><span class="p">]</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="c1"># ----------------------</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="c1"># Generate initial guess</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="c1"># ----------------------</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        <span class="c1"># We run the initial guess regardless of whether we are going to overwrite</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="c1"># with values from the previous frame. This is because the beta values</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="c1"># are caluclated via the contact network, which should not be carried over</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="c1"># (since the particles are moving).</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="n">forceGuessArr</span><span class="p">,</span> <span class="n">alphaGuessArr</span><span class="p">,</span> <span class="n">betaGuessArr</span> <span class="o">=</span> <span class="n">initialForceSolve</span><span class="p">(</span><span class="n">peImage</span><span class="p">,</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>                                                    <span class="n">centers</span><span class="p">,</span> <span class="n">radii</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fSigma&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pxPerMeter&quot;</span><span class="p">],</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>                                                    <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;contactPadding&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;g2MaskPadding&quot;</span><span class="p">],</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>                                                    <span class="n">contactMaskRadius</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;contactMaskRadius&quot;</span><span class="p">],</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                                                    <span class="n">boundaryMask</span><span class="o">=</span><span class="n">maskArr</span><span class="p">,</span> <span class="n">ignoreBoundary</span><span class="o">=</span><span class="n">ignoreBoundary</span><span class="p">,</span> <span class="n">g2Cal</span><span class="o">=</span><span class="n">g2Cal</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">centersArr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="c1"># If we have added/lost particles, we want to carry over the previous values where</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="c1"># possible, and otherwise take the results of initialForceSolve</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>            <span class="c1"># Note that this is the complement to the center order calculated previously:</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="c1"># this orders the old centers according the new ones.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>            <span class="c1"># We make the assumption that a particle cannot travel more than it&#39;s radius in a single frame</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>            <span class="n">oldCenterOrder</span> <span class="o">=</span> <span class="n">preserveOrderArgsort</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">centersArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">padMissingValues</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxDistance</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">])</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="c1"># Now find each new particle&#39;s old counterpart (if it exists), and then</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="c1"># line up the forces using the value of beta, such that we can (optionally)</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="c1"># carry over force magnitudes and alpha values.</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">)):</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                <span class="k">if</span> <span class="n">oldCenterOrder</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                    <span class="k">continue</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                    
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                <span class="c1"># maxBetaDisplacement should be an angle value (in radians) that a force would</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                <span class="c1"># never move in a single frame, but is large enough to not lose a force if it</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="c1"># moves because of noise/small fluctuations.</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                <span class="n">forceOrder</span> <span class="o">=</span> <span class="n">preserveOrderArgsort</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">betaArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">oldCenterOrder</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="n">padMissingValues</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxDistance</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;maxBetaDisplacement&quot;</span><span class="p">])</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                <span class="c1">#print(f&#39;frame {i}, particle {j}: {forceOrder}&#39;)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forceGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                    <span class="k">if</span> <span class="n">forceOrder</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;carryOverForce&quot;</span><span class="p">]:</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                            <span class="n">forceGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">forceArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">oldCenterOrder</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="n">forceOrder</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;carryOverAlpha&quot;</span><span class="p">]:</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                            <span class="n">alphaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">alphaArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">oldCenterOrder</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="n">forceOrder</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="c1"># In this case, we want to add a small randomly generated contribution</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="c1"># so that the algorithm doesn&#39;t get stuck in some incorrect loop and so that it</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="c1"># explores a little more of the parameter space to find a nice minimum at each step</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;forceNoiseWidth&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="n">forceGuessArr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;forceNoiseWidth&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">forceGuessArr</span><span class="p">]</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;alphaNoiseWidth&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>                <span class="n">alphaGuessArr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;alphaNoiseWidth&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alphaGuessArr</span><span class="p">]</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="n">initialGuessTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>        <span class="c1"># -------------------------------</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="c1"># Optimize each particle&#39;s forces</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="c1"># -------------------------------</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        <span class="n">optimizedForceArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>        <span class="n">optimizedBetaArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="n">optimizedAlphaArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>        <span class="n">failed</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">))]</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="c1"># Drop forces on any particles whose g2 is lower than the min value</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="n">skipParticles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">))]</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="k">if</span> <span class="n">checkMinG2</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>            <span class="n">gSqr</span> <span class="o">=</span> <span class="n">gSquared</span><span class="p">(</span><span class="n">peImage</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                <span class="n">cMask</span> <span class="o">=</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">peImage</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>                <span class="n">avgG2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gSqr</span> <span class="o">*</span> <span class="n">cMask</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cMask</span><span class="p">)</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                <span class="n">skipParticles</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">avgG2</span> <span class="o">&lt;</span> <span class="n">minParticleG2</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="c1"># Mostly just a debug option, so we can test particle tracking</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;performOptimization&quot;</span><span class="p">]:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>            <span class="n">optimizedForceArr</span> <span class="o">=</span> <span class="n">forceGuessArr</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="n">optimizedAlphaArr</span> <span class="o">=</span> <span class="n">alphaGuessArr</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="n">optimizedBetaArr</span> <span class="o">=</span> <span class="n">betaGuessArr</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>            <span class="c1"># This is what should run the majority of the time</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">skipParticles</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>                        <span class="c1"># We don&#39;t need to pass fSigma, pxPerMeter, or brightfield to the method</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>                        <span class="c1"># because they will get added to optimizationKwargs automatically.</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                        <span class="n">optForceArr</span><span class="p">,</span> <span class="n">optBetaArr</span><span class="p">,</span> <span class="n">optAlphaArr</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">forceOptimize</span><span class="p">(</span><span class="n">forceGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">alphaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">peImage</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                                                                                  <span class="c1">#settings[&quot;fSigma&quot;], settings[&quot;pxPerMeter&quot;], settings[&quot;brightfield&quot;],</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                                                                                  <span class="o">**</span><span class="n">optimizationKwargs</span><span class="p">)</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                        <span class="n">optimizedForceArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optForceArr</span><span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                        <span class="n">optimizedBetaArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optBetaArr</span><span class="p">)</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                        <span class="n">optimizedAlphaArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optAlphaArr</span><span class="p">)</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                        <span class="n">errorMsgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">imageFiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                        <span class="n">failed</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                        <span class="n">totalFailedParticles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                        <span class="c1"># Append empty lists (ie say there are no forces) </span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                        <span class="c1">#optimizedForceArr.append(forceGuessArr[j])</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>                        <span class="c1">#optimizedBetaArr.append(betaGuessArr[j])</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>                        <span class="c1">#optimizedAlphaArr.append(alphaGuessArr[j])</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                        <span class="n">optimizedForceArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                        <span class="n">optimizedBetaArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>                        <span class="n">optimizedAlphaArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                    <span class="n">optimizedForceArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>                    <span class="n">optimizedBetaArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>                    <span class="n">optimizedAlphaArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        <span class="c1"># If necessary, impose force balance on all particles</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="k">if</span> <span class="n">requireForceBalance</span><span class="p">:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>                <span class="n">optimizedForceArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">optimizedAlphaArr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">singleParticleForceBalance</span><span class="p">(</span><span class="n">optimizedForceArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">optimizedAlphaArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">optimizedBetaArr</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="n">optimizationTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">initialGuessTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>        <span class="c1"># Save all of our values</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="n">forceArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizedForceArr</span><span class="p">)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="n">betaArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizedBetaArr</span><span class="p">)</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="n">alphaArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizedAlphaArr</span><span class="p">)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">centersArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="n">radiiArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radii</span><span class="p">)</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;saveMovie&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;genFitReport&quot;</span><span class="p">]:</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>            <span class="n">estimatedPhotoelasticChannel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">peImage</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>    
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>                <span class="n">estimatedPhotoelasticChannel</span> <span class="o">+=</span> <span class="n">genSyntheticResponse</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forceGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">alphaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>                                                                     <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fSigma&quot;</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>                                                                     <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pxPerMeter&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;brightfield&quot;</span><span class="p">],</span> <span class="n">imageSize</span><span class="o">=</span><span class="n">peImage</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>                                                                     <span class="n">center</span><span class="o">=</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>            
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>            
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>            <span class="n">optimizedPhotoelasticChannel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">peImage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                <span class="n">optimizedPhotoelasticChannel</span> <span class="o">+=</span> <span class="n">genSyntheticResponse</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimizedForceArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimizedAlphaArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimizedBetaArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                                                                     <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fSigma&quot;</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                                                                     <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pxPerMeter&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;brightfield&quot;</span><span class="p">],</span> <span class="n">imageSize</span><span class="o">=</span><span class="n">peImage</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                                                                     <span class="n">center</span><span class="o">=</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>            
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>            <span class="c1"># Just simple mean-squared error</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>            <span class="n">errorArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">optimizedPhotoelasticChannel</span> <span class="o">-</span> <span class="n">peImage</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="n">imgArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">optimizedPhotoelasticChannel</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>            
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">optimizedPhotoelasticChannel</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="n">drawObj</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                <span class="n">leftUpPoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>                <span class="n">rightDownPoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                <span class="n">twoPointList</span> <span class="o">=</span> <span class="p">[</span><span class="n">leftUpPoint</span><span class="p">,</span> <span class="n">rightDownPoint</span><span class="p">]</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;#FF0000&#39;</span> <span class="k">if</span> <span class="n">failed</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;#00AAAA&#39;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                <span class="n">drawObj</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">twoPointList</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">maskArr</span> <span class="o">*</span> <span class="n">image</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Tracked Particles&#39;</span><span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detected particles&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                <span class="c1"># Now add contacts</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                    <span class="n">contactPoint</span> <span class="o">=</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])])</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                    <span class="n">cc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">contactPoint</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                    
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                <span class="c1"># Now plot past center positions</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                <span class="c1">#for k in range(len(centersArr)):</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                <span class="c1">#    if len(centersArr[k]) &gt;= j:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                <span class="c1">#        cc = plt.Circle(centersArr[k][j][::-1], 5, color=centerColors[j], fill=True)</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                <span class="c1">#        ax[0].add_artist(cc)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                    
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">estimatedPhotoelasticChannel</span><span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Initial Guess for Optimizer</span><span class="se">\n</span><span class="s1">(known forces)&#39;</span><span class="p">)</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>            
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Optimized Forces</span><span class="se">\n</span><span class="s1">(known forces)&#39;</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>            
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;saveMovie&quot;</span><span class="p">]:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>            <span class="n">imageArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="n">miscTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">optimizationTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">initialGuessTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span> 
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]:</span> 
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Took </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">:</span><span class="s1">.5</span><span class="si">}</span><span class="s1">s to solve frame:&#39;</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s2">&quot; &quot;</span><span class="si">}</span><span class="s1">Tracking:         </span><span class="si">{</span><span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s2">&quot; &quot;</span><span class="si">}</span><span class="s1">Initial guess:    </span><span class="si">{</span><span class="n">initialGuessTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s2">&quot; &quot;</span><span class="si">}</span><span class="s1">Optimization:     </span><span class="si">{</span><span class="n">optimizationTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s2">&quot; &quot;</span><span class="si">}</span><span class="s1">Misc. processes:  </span><span class="si">{</span><span class="n">miscTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;showProgressBar&quot;</span><span class="p">]:</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>   
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>    
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>    <span class="c1"># Restructure the arrays to make them more friendly, and to track forces/particles across timesteps</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="n">rectForceArr</span><span class="p">,</span> <span class="n">rectAlphaArr</span><span class="p">,</span> <span class="n">rectBetaArr</span><span class="p">,</span> <span class="n">rectCenterArr</span><span class="p">,</span> <span class="n">rectRadiusArr</span> <span class="o">=</span> <span class="n">rectangularizeForceArrays</span><span class="p">(</span><span class="n">forceArr</span><span class="p">,</span> <span class="n">alphaArr</span><span class="p">,</span> <span class="n">betaArr</span><span class="p">,</span> <span class="n">centersArr</span><span class="p">,</span> <span class="n">radiiArr</span><span class="p">)</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="c1"># --------------</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="c1"># Track rotation</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>    <span class="c1"># --------------</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>    <span class="c1"># We choose to do this after the actual solving because it helps</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="c1"># to have the rectangular force arrays.</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>    <span class="n">padding</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>    <span class="c1"># First, we generate our reference images, which are the first</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="c1"># time a particle is completely in frame.</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>    <span class="n">refImages</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">)</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">refImages</span><span class="p">)):</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)):</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                <span class="c1"># Continue to the next frame if this one is partially offscreen</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">((</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">((</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imageSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>                    <span class="k">continue</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>                <span class="c1"># Otherwise, this is a good frame, so we save it</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>                <span class="n">refImageFull</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">imageFiles</span><span class="p">[</span><span class="n">j</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>                <span class="n">refImageFull</span> <span class="o">*=</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">refImageFull</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                <span class="n">refImages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">refImageFull</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)]</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                <span class="c1"># And move onto the next particle</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                <span class="k">break</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="c1"># Same shape as the radius array: 1 value for each timestep, for each particle</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="n">rectAngleArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>    <span class="c1"># Set all values to be np.nan initially</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>    <span class="n">rectAngleArr</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>    <span class="c1"># Now we compare that reference particle to each subsequent frame</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="c1"># (probably not best practice that I&#39;ve switched the indices</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    <span class="c1"># with respect to the previous statements, but :/)</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)):</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="n">currentImageFull</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">imageFiles</span><span class="p">[</span><span class="n">i</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">refImages</span><span class="p">)):</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="c1"># Make sure we have a reference image, and the particle is in full view</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>                <span class="k">continue</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">((</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">((</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imageSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                <span class="k">continue</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            <span class="c1"># Crop out around the particle and mask it</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="n">currImage</span> <span class="o">=</span> <span class="p">(</span><span class="n">circularMask</span><span class="p">(</span><span class="n">currentImageFull</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">currentImageFull</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)]</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>           
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>            <span class="c1"># Which is the kernel and which is the reference image doesn&#39;t really matter</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>            <span class="c1"># (as long as we are consistent)</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="c1"># We can choose our bounds based on the previous value of the rotation</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rectAngleArr</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>                <span class="n">rotationBounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">rectAngleArr</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">.1</span><span class="p">,</span> <span class="n">rectAngleArr</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">.1</span><span class="p">)</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>                <span class="c1"># If either i=0 or the previous rotation value is nan, we should start around 0</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>                <span class="c1"># anyway (since we define 0 arbitrarily)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>                <span class="n">rotationBounds</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.2</span><span class="p">)</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="c1"># .003 was chosen based on the data presented in the wiki</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>            <span class="c1"># https://github.com/Jfeatherstone/pepe/wiki/Angular-Convolution</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="n">thetaArr</span><span class="p">,</span> <span class="n">convArr</span> <span class="o">=</span> <span class="n">angularConvolution</span><span class="p">(</span><span class="n">refImages</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">currImage</span><span class="p">,</span> <span class="n">dTheta</span><span class="o">=</span><span class="mf">.003</span><span class="p">,</span> <span class="n">angleBounds</span><span class="o">=</span><span class="n">rotationBounds</span><span class="p">)</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>            <span class="n">rectAngleArr</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">thetaArr</span><span class="p">[</span><span class="n">findPeaksMulti</span><span class="p">(</span><span class="n">convArr</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>    <span class="c1"># Reuse the name of the folder the images come from as a part of</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>    <span class="c1"># the output folder name</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>    <span class="c1"># [-2] element for something of form &#39;path/to/final/folder/&#39; will be &#39;folder&#39;</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>    <span class="c1"># If we are missing the final /, you have to take just the [-1] element</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="n">outputFolderPath</span> <span class="o">=</span> <span class="n">outputRootFolder</span> <span class="o">+</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_Synthetic</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;outputExtension&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/&#39;</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="n">outputFolderPath</span> <span class="o">=</span> <span class="n">outputRootFolder</span> <span class="o">+</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_Synthetic</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;outputExtension&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/&#39;</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFolderPath</span><span class="p">):</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outputFolderPath</span><span class="p">)</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;saveMovie&quot;</span><span class="p">]:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="n">imageArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;Synthetic.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">imageArr</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>    <span class="c1"># Write a readme file that contains all of the parameters that the solving used</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#####################</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>             <span class="s1">&#39;#    README FILE    #</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>             <span class="s1">&#39;#####################</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Generated: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;Note: this file was autogenerated by the `pepe.auto.forceSolve()` function</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>              <span class="s1">&#39;      and it is not recommended to be manually edited. To reuse the settings</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>              <span class="s1">&#39;      and parameters that were used here, the path of this file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>             <span class="sa">f</span><span class="s1">&#39;      (</span><span class="se">\&#39;</span><span class="si">{</span><span class="n">outputFolderPath</span><span class="si">}</span><span class="s1">readme.txt</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>              <span class="s1">&#39;      can be passed via the </span><span class="se">\&#39;</span><span class="s1">settingsFile</span><span class="se">\&#39;</span><span class="s1"> keyword argument of `pepe.auto.forceSolve()`.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>              <span class="s1">&#39;      In this case, explictly passed arguments will override the values in the settings file.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">## Runtime Information</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>              <span class="sa">f</span><span class="s1">&#39;Version: pepe </span><span class="si">{</span><span class="n">pepe</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>              <span class="sa">f</span><span class="s1">&#39;Total runtime: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">overallStartTime</span><span class="si">:</span><span class="s1">.6</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>              <span class="sa">f</span><span class="s1">&#39;Mean tracking time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trackingTimes</span><span class="p">)</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>              <span class="sa">f</span><span class="s1">&#39;Mean guess generation time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">initialGuessTimes</span><span class="p">)</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>              <span class="sa">f</span><span class="s1">&#39;Mean optimization time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">optimizationTimes</span><span class="p">)</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>              <span class="sa">f</span><span class="s1">&#39;Mean misc. time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">miscTimes</span><span class="p">)</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>              <span class="sa">f</span><span class="s1">&#39;Number of failed particles: </span><span class="si">{</span><span class="n">totalFailedParticles</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>    <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">circleTrackingKwargs</span><span class="p">)</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>    <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optimizationKwargs</span><span class="p">)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">## Settings</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">## Errors</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errorMsgs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>        <span class="n">lines</span> <span class="o">+=</span> <span class="n">errorMsgs</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;None :)&#39;</span><span class="p">]</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;readme.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">readmeFile</span><span class="p">:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="n">readmeFile</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>    <span class="c1"># Save the arrays to pickle files (optional)</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pickleArrays&quot;</span><span class="p">]:</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;forces.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectForceArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;alphas.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectAlphaArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;betas.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectBetaArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;centers.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;radii.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;angles.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectAngleArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>    <span class="c1"># Save the raw arrays too, since I think I have a bug in my rectangularization process</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="c1">#    if settings[&quot;pickleArrays&quot;]:</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="c1">#        with open(outputFolderPath + &#39;forces_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="c1">#            pickle.dump(forceArr, f)</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="c1">#</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="c1">#        with open(outputFolderPath + &#39;alphas_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="c1">#            pickle.dump(alphaArr, f)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="c1">#</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="c1">#        with open(outputFolderPath + &#39;betas_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="c1">#            pickle.dump(betaArr, f)</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="c1">#</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="c1">#        with open(outputFolderPath + &#39;centers_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="c1">#            pickle.dump(centersArr, f)</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="c1">#</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="c1">#        with open(outputFolderPath + &#39;radii_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="c1">#            pickle.dump(radiiArr, f)</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>    <span class="c1"># Generate a fit report (optional)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="c1"># This include informtaion about the error for each frame, all of the forces/alphas/betas/</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>    <span class="c1"># centers/radii for each particle at each timestep, and all settings in a nicely compiled</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>    <span class="c1"># (via latex) pdf.</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;genFitReport&quot;</span><span class="p">]:</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>        <span class="c1"># Make the source directory</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src&#39;</span><span class="p">):</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src&#39;</span><span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>        <span class="c1"># First, generate a plot of the error</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errorArr</span><span class="p">)</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frame&#39;</span><span class="p">)</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mean-squared error&#39;</span><span class="p">)</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Difference Between Optimized Result and Real Image&#39;</span><span class="p">)</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/error.pdf&#39;</span><span class="p">)</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/error.png&#39;</span><span class="p">)</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="c1"># Draw all of the circles, with their labeled numbers</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="c1"># First timestep</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="n">visCircles</span><span class="p">([</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">))],</span> <span class="p">[</span><span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">))],</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">annotations</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">)),</span> <span class="n">setBounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="c1"># Last timestep</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="n">visCircles</span><span class="p">([</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">))],</span> <span class="p">[</span><span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">))],</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">annotations</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">)),</span> <span class="n">setBounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X [px]&#39;</span><span class="p">)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y [px]&#39;</span><span class="p">)</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;First Frame&#39;</span><span class="p">)</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Last Frame&#39;</span><span class="p">)</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/particle_identities.pdf&#39;</span><span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/particle_identities.png&#39;</span><span class="p">)</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>        <span class="c1"># Next, draw the forces/betas/alphas/centers for each particle</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>        <span class="c1"># through time</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectForceArr</span><span class="p">)):</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">visForces</span><span class="p">(</span><span class="n">rectForceArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rectAlphaArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rectBetaArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rectAngleArr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Particle </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;FitReport_src/particle_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_forces.pdf&#39;</span><span class="p">)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;FitReport_src/particle_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_forces.png&#39;</span><span class="p">)</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="c1"># Create a gif of the particle orientation through time, overlaid</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>        <span class="c1"># on the original images</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="n">visRotation</span><span class="p">([</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">imageFiles</span><span class="p">],</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                   <span class="n">rectCenterArr</span><span class="p">,</span> <span class="n">rectRadiusArr</span><span class="p">,</span> <span class="n">rectAngleArr</span><span class="p">,</span> <span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cropXMin</span><span class="p">))</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="c1"># Create gifs of the contacts</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="n">forceColors</span> <span class="o">=</span> <span class="n">genColors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectBetaArr</span><span class="p">))</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="c1"># The list comprehension is to make sure that we index a particle that actually has forces acting</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="c1"># on it.</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>        <span class="n">tSteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)</span><span class="c1">#len([b for b in rectBetaArr if len(b) &gt; 0][0])</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>        <span class="n">contactPointImages</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tSteps</span><span class="p">)]</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="n">contactAngleImages</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tSteps</span><span class="p">)]</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tSteps</span><span class="p">):</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>            <span class="c1"># Have to do this, because the settings variable could be None </span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="n">startI</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageStartIndex&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageStartIndex&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>            <span class="c1"># First, just the contact points</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>            <span class="n">visCircles</span><span class="p">([</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">))],</span> <span class="p">[</span><span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">))],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="k">for</span> <span class="n">particleIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectBetaArr</span><span class="p">)):</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>                <span class="n">visContacts</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                            <span class="n">rectBetaArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">forceColors</span><span class="o">=</span><span class="n">forceColors</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">])</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1280</span><span class="p">])</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">startI</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>            <span class="n">canvas</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_current_fig_manager</span><span class="p">()</span><span class="o">.</span><span class="n">canvas</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>            <span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>            <span class="n">contactPointImages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">(),</span> 
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>                                        <span class="n">canvas</span><span class="o">.</span><span class="n">tostring_rgb</span><span class="p">())</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>       
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>            <span class="c1"># Now the one with angles</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>            <span class="n">visCircles</span><span class="p">([</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">))],</span> <span class="p">[</span><span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">))],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>            <span class="k">for</span> <span class="n">particleIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectBetaArr</span><span class="p">)):</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>                <span class="n">visContacts</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                            <span class="n">rectBetaArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">forceColors</span><span class="o">=</span><span class="n">forceColors</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">],</span> <span class="n">alphaArr</span><span class="o">=</span><span class="n">rectAlphaArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][:,</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                                                
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1280</span><span class="p">])</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">startI</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="n">canvas</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_current_fig_manager</span><span class="p">()</span><span class="o">.</span><span class="n">canvas</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="n">contactAngleImages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">(),</span> 
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                                        <span class="n">canvas</span><span class="o">.</span><span class="n">tostring_rgb</span><span class="p">())</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>        <span class="n">contactPointImages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/contact_points.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                                   <span class="n">append_images</span><span class="o">=</span><span class="n">contactPointImages</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="n">contactAngleImages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/contact_angles.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                                   <span class="n">append_images</span><span class="o">=</span><span class="n">contactAngleImages</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;showProgressBar&quot;</span><span class="p">]:</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="n">bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>    <span class="k">return</span> <span class="n">rectForceArr</span><span class="p">,</span> <span class="n">rectAlphaArr</span><span class="p">,</span> <span class="n">rectBetaArr</span><span class="p">,</span> <span class="n">rectCenterArr</span><span class="p">,</span> <span class="n">rectRadiusArr</span><span class="p">,</span> <span class="n">rectAngleArr</span>
</span></pre></div>


            </section>
                <section id="forceSolveArgDTypes">
                    <div class="attr variable">
            <span class="name">forceSolveArgDTypes</span>        =
<input id="forceSolveArgDTypes-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="forceSolveArgDTypes-view-value"></label><span class="default_value">{&#39;imageDirectory&#39;: &lt;class &#39;str&#39;&gt;, &#39;imageExtension&#39;: &lt;class &#39;str&#39;&gt;, &#39;imageEndIndex&#39;: &lt;class &#39;int&#39;&gt;, &#39;imageStartIndex&#39;: &lt;class &#39;int&#39;&gt;, &#39;carryOverAlpha&#39;: &lt;class &#39;bool&#39;&gt;, &#39;carryOverForce&#39;: &lt;class &#39;bool&#39;&gt;, &#39;showProgressBar&#39;: &lt;class &#39;bool&#39;&gt;, &#39;lightCorrectionImage&#39;: &lt;class &#39;str&#39;&gt;, &#39;lightCorrectionVerticalMask&#39;: &lt;class &#39;str&#39;&gt;, &#39;lightCorrectionHorizontalMask&#39;: &lt;class &#39;str&#39;&gt;, &#39;g2CalibrationImage&#39;: &lt;class &#39;str&#39;&gt;, &#39;g2CalibrationCutoffFactor&#39;: &lt;class &#39;float&#39;&gt;, &#39;maskImage&#39;: &lt;class &#39;str&#39;&gt;, &#39;cropXMin&#39;: &lt;class &#39;int&#39;&gt;, &#39;cropXMax&#39;: &lt;class &#39;int&#39;&gt;, &#39;circleDetectionMethod&#39;: &lt;class &#39;str&#39;&gt;, &#39;guessRadius&#39;: &lt;class &#39;float&#39;&gt;, &#39;fSigma&#39;: &lt;class &#39;float&#39;&gt;, &#39;pxPerMeter&#39;: &lt;class &#39;float&#39;&gt;, &#39;brightfield&#39;: &lt;class &#39;bool&#39;&gt;, &#39;contactPadding&#39;: &lt;class &#39;int&#39;&gt;, &#39;g2MaskPadding&#39;: &lt;class &#39;int&#39;&gt;, &#39;contactMaskRadius&#39;: &lt;class &#39;int&#39;&gt;, &#39;peBlurKernel&#39;: &lt;class &#39;int&#39;&gt;, &#39;requireForceBalance&#39;: &lt;class &#39;bool&#39;&gt;, &#39;circleTrackingChannel&#39;: &lt;class &#39;int&#39;&gt;, &#39;circleTrackingGain&#39;: &lt;class &#39;float&#39;&gt;, &#39;circleTrackingKwargs&#39;: &lt;class &#39;dict&#39;&gt;, &#39;photoelasticChannel&#39;: &lt;class &#39;int&#39;&gt;, &#39;photoelasticGain&#39;: &lt;class &#39;float&#39;&gt;, &#39;optimizationKwargs&#39;: &lt;class &#39;dict&#39;&gt;, &#39;maxBetaDisplacement&#39;: &lt;class &#39;float&#39;&gt;, &#39;forceNoiseWidth&#39;: &lt;class &#39;float&#39;&gt;, &#39;alphaNoiseWidth&#39;: &lt;class &#39;float&#39;&gt;, &#39;saveMovie&#39;: &lt;class &#39;bool&#39;&gt;, &#39;pickleArrays&#39;: &lt;class &#39;bool&#39;&gt;, &#39;outputRootFolder&#39;: &lt;class &#39;str&#39;&gt;, &#39;outputExtension&#39;: &lt;class &#39;str&#39;&gt;, &#39;genFitReport&#39;: &lt;class &#39;bool&#39;&gt;, &#39;performOptimization&#39;: &lt;class &#39;bool&#39;&gt;, &#39;inputSettingsFile&#39;: &lt;class &#39;str&#39;&gt;, &#39;debug&#39;: &lt;class &#39;bool&#39;&gt;}</span>

        
    </div>
    <a class="headerlink" href="#forceSolveArgDTypes"></a>
    
    

                </section>
                <section id="excludedArgs">
                    <div class="attr variable">
            <span class="name">excludedArgs</span>        =
<span class="default_value">[&#39;progressBarOffset&#39;, &#39;progressBarTitle&#39;]</span>

        
    </div>
    <a class="headerlink" href="#excludedArgs"></a>
    
    

                </section>
                <section id="forceSolve">
                            <input id="forceSolve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-explicitKwargs">@explicitKwargs()</div>

        <span class="def">def</span>
        <span class="name">forceSolve</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">imageDirectory</span>,</span><span class="param">	<span class="n">guessRadius</span><span class="o">=</span><span class="mf">0.0</span>,</span><span class="param">	<span class="n">fSigma</span><span class="o">=</span><span class="mf">0.0</span>,</span><span class="param">	<span class="n">pxPerMeter</span><span class="o">=</span><span class="mf">0.0</span>,</span><span class="param">	<span class="n">brightfield</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">contactPadding</span><span class="o">=</span><span class="mi">15</span>,</span><span class="param">	<span class="n">g2MaskPadding</span><span class="o">=</span><span class="mi">2</span>,</span><span class="param">	<span class="n">contactMaskRadius</span><span class="o">=</span><span class="mi">30</span>,</span><span class="param">	<span class="n">lightCorrectionImage</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">lightCorrectionHorizontalMask</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">lightCorrectionVerticalMask</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">g2CalibrationImage</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">g2CalibrationCutoffFactor</span><span class="o">=</span><span class="mf">0.9</span>,</span><span class="param">	<span class="n">maskImage</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">cropXMin</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">cropXMax</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">peBlurKernel</span><span class="o">=</span><span class="mi">3</span>,</span><span class="param">	<span class="n">imageExtension</span><span class="o">=</span><span class="s1">&#39;bmp&#39;</span>,</span><span class="param">	<span class="n">requireForceBalance</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">imageStartIndex</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">imageEndIndex</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">carryOverAlpha</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">carryOverForce</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">circleDetectionMethod</span><span class="o">=</span><span class="s1">&#39;convolution&#39;</span>,</span><span class="param">	<span class="n">circleTrackingKwargs</span><span class="o">=</span><span class="p">{}</span>,</span><span class="param">	<span class="n">circleTrackingChannel</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">circleTrackingGain</span><span class="o">=</span><span class="mf">1.0</span>,</span><span class="param">	<span class="n">maxBetaDisplacement</span><span class="o">=</span><span class="mf">0.5</span>,</span><span class="param">	<span class="n">photoelasticChannel</span><span class="o">=</span><span class="mi">1</span>,</span><span class="param">	<span class="n">photoelasticGain</span><span class="o">=</span><span class="mf">1.0</span>,</span><span class="param">	<span class="n">forceNoiseWidth</span><span class="o">=</span><span class="mf">0.03</span>,</span><span class="param">	<span class="n">alphaNoiseWidth</span><span class="o">=</span><span class="mf">0.01</span>,</span><span class="param">	<span class="n">optimizationKwargs</span><span class="o">=</span><span class="p">{}</span>,</span><span class="param">	<span class="n">performOptimization</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">debug</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">showProgressBar</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">progressBarOffset</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">progressBarTitle</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">saveMovie</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">outputRootFolder</span><span class="o">=</span><span class="s1">&#39;./&#39;</span>,</span><span class="param">	<span class="n">inputSettingsFile</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">pickleArrays</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">genFitReport</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">outputExtension</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="forceSolve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#forceSolve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="forceSolve-84"><a href="#forceSolve-84"><span class="linenos">  84</span></a><span class="nd">@explicitKwargs</span><span class="p">()</span>
</span><span id="forceSolve-85"><a href="#forceSolve-85"><span class="linenos">  85</span></a><span class="k">def</span> <span class="nf">forceSolve</span><span class="p">(</span><span class="n">imageDirectory</span><span class="p">,</span> <span class="n">guessRadius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fSigma</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">pxPerMeter</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">brightfield</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">contactPadding</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">g2MaskPadding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">contactMaskRadius</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">lightCorrectionImage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lightCorrectionHorizontalMask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lightCorrectionVerticalMask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">g2CalibrationImage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">g2CalibrationCutoffFactor</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span> <span class="n">maskImage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cropXMin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cropXMax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">peBlurKernel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">imageExtension</span><span class="o">=</span><span class="s1">&#39;bmp&#39;</span><span class="p">,</span> <span class="n">requireForceBalance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">imageStartIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">imageEndIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">carryOverAlpha</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">carryOverForce</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">circleDetectionMethod</span><span class="o">=</span><span class="s1">&#39;convolution&#39;</span><span class="p">,</span> <span class="n">circleTrackingKwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">circleTrackingChannel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">circleTrackingGain</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">maxBetaDisplacement</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">photoelasticChannel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">photoelasticGain</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">forceNoiseWidth</span><span class="o">=</span><span class="mf">.03</span><span class="p">,</span> <span class="n">alphaNoiseWidth</span><span class="o">=</span><span class="mf">.01</span><span class="p">,</span> <span class="n">optimizationKwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">performOptimization</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showProgressBar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">progressBarOffset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">progressBarTitle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">saveMovie</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">outputRootFolder</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">inputSettingsFile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pickleArrays</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">genFitReport</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outputExtension</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="forceSolve-86"><a href="#forceSolve-86"><span class="linenos">  86</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="forceSolve-87"><a href="#forceSolve-87"><span class="linenos">  87</span></a><span class="sd">    Complete pipeline to solve for forces and particle positions for all image files</span>
</span><span id="forceSolve-88"><a href="#forceSolve-88"><span class="linenos">  88</span></a><span class="sd">    in a directory. Results will be returned and potentially written to various files.</span>
</span><span id="forceSolve-89"><a href="#forceSolve-89"><span class="linenos">  89</span></a><span class="sd">    See `Returns` section for more information</span>
</span><span id="forceSolve-90"><a href="#forceSolve-90"><span class="linenos">  90</span></a>
</span><span id="forceSolve-91"><a href="#forceSolve-91"><span class="linenos">  91</span></a><span class="sd">    Expects all particles to be the same (or very similar) sizes. This assumption is made</span>
</span><span id="forceSolve-92"><a href="#forceSolve-92"><span class="linenos">  92</span></a><span class="sd">    by the calculation of the gradient squared calibration value, which is computed just</span>
</span><span id="forceSolve-93"><a href="#forceSolve-93"><span class="linenos">  93</span></a><span class="sd">    once using the guess of the radii. This should not be a problem if the radii are only</span>
</span><span id="forceSolve-94"><a href="#forceSolve-94"><span class="linenos">  94</span></a><span class="sd">    slightly varied (~10 pixels or something) but any more than that and errors will begin</span>
</span><span id="forceSolve-95"><a href="#forceSolve-95"><span class="linenos">  95</span></a><span class="sd">    to accumulate.</span>
</span><span id="forceSolve-96"><a href="#forceSolve-96"><span class="linenos">  96</span></a>
</span><span id="forceSolve-97"><a href="#forceSolve-97"><span class="linenos">  97</span></a><span class="sd">    This method has **a lot** of arguments; it is intended to be used once reasonable</span>
</span><span id="forceSolve-98"><a href="#forceSolve-98"><span class="linenos">  98</span></a><span class="sd">    values for all of these have already been found. While the `debug` option for this function</span>
</span><span id="forceSolve-99"><a href="#forceSolve-99"><span class="linenos">  99</span></a><span class="sd">    is very helpful, it is recommended to utilize the various notebooks/examples to find good</span>
</span><span id="forceSolve-100"><a href="#forceSolve-100"><span class="linenos"> 100</span></a><span class="sd">    choices for parameters first.</span>
</span><span id="forceSolve-101"><a href="#forceSolve-101"><span class="linenos"> 101</span></a>
</span><span id="forceSolve-102"><a href="#forceSolve-102"><span class="linenos"> 102</span></a><span class="sd">    The output readme file can also serve as a cache of the parameter values/settings, which</span>
</span><span id="forceSolve-103"><a href="#forceSolve-103"><span class="linenos"> 103</span></a><span class="sd">    can be passed back to future calls of this method using the `inputSettingsFile` argument.</span>
</span><span id="forceSolve-104"><a href="#forceSolve-104"><span class="linenos"> 104</span></a>
</span><span id="forceSolve-105"><a href="#forceSolve-105"><span class="linenos"> 105</span></a><span class="sd">    Parameters</span>
</span><span id="forceSolve-106"><a href="#forceSolve-106"><span class="linenos"> 106</span></a><span class="sd">    ----------</span>
</span><span id="forceSolve-107"><a href="#forceSolve-107"><span class="linenos"> 107</span></a>
</span><span id="forceSolve-108"><a href="#forceSolve-108"><span class="linenos"> 108</span></a><span class="sd">    imageDirectory : str</span>
</span><span id="forceSolve-109"><a href="#forceSolve-109"><span class="linenos"> 109</span></a><span class="sd">        An absolute or relative path to the directory containing the images that are</span>
</span><span id="forceSolve-110"><a href="#forceSolve-110"><span class="linenos"> 110</span></a><span class="sd">        to be analyzed. The names of the images need not follow any particular naming</span>
</span><span id="forceSolve-111"><a href="#forceSolve-111"><span class="linenos"> 111</span></a><span class="sd">        scheme, but they should be such that sorting the list alphabetically will give</span>
</span><span id="forceSolve-112"><a href="#forceSolve-112"><span class="linenos"> 112</span></a><span class="sd">        the images in their proper order.</span>
</span><span id="forceSolve-113"><a href="#forceSolve-113"><span class="linenos"> 113</span></a>
</span><span id="forceSolve-114"><a href="#forceSolve-114"><span class="linenos"> 114</span></a><span class="sd">    guessRadius : float</span>
</span><span id="forceSolve-115"><a href="#forceSolve-115"><span class="linenos"> 115</span></a><span class="sd">        The radius of the particles to be detected, in pixels. As of now, this value will</span>
</span><span id="forceSolve-116"><a href="#forceSolve-116"><span class="linenos"> 116</span></a><span class="sd">        be taken as the particle radius, but future versions may be able to vary this to</span>
</span><span id="forceSolve-117"><a href="#forceSolve-117"><span class="linenos"> 117</span></a><span class="sd">        find the optimal value.</span>
</span><span id="forceSolve-118"><a href="#forceSolve-118"><span class="linenos"> 118</span></a>
</span><span id="forceSolve-119"><a href="#forceSolve-119"><span class="linenos"> 119</span></a><span class="sd">        Currently no support for particles of different sizes.</span>
</span><span id="forceSolve-120"><a href="#forceSolve-120"><span class="linenos"> 120</span></a>
</span><span id="forceSolve-121"><a href="#forceSolve-121"><span class="linenos"> 121</span></a><span class="sd">    fSigma : float</span>
</span><span id="forceSolve-122"><a href="#forceSolve-122"><span class="linenos"> 122</span></a><span class="sd">        Stress optic coefficient, relating to material thickness, wavelength of light and</span>
</span><span id="forceSolve-123"><a href="#forceSolve-123"><span class="linenos"> 123</span></a><span class="sd">        other material property (denoted as C in most literature; sometimes also called the</span>
</span><span id="forceSolve-124"><a href="#forceSolve-124"><span class="linenos"> 124</span></a><span class="sd">        &quot;stress optic coefficient&quot;).</span>
</span><span id="forceSolve-125"><a href="#forceSolve-125"><span class="linenos"> 125</span></a>
</span><span id="forceSolve-126"><a href="#forceSolve-126"><span class="linenos"> 126</span></a><span class="sd">    pxPerMeter : float</span>
</span><span id="forceSolve-127"><a href="#forceSolve-127"><span class="linenos"> 127</span></a><span class="sd">        The number of pixels per meter in the images. Depends on the camera, lens, and </span>
</span><span id="forceSolve-128"><a href="#forceSolve-128"><span class="linenos"> 128</span></a><span class="sd">        zoom settings used to capture the images.</span>
</span><span id="forceSolve-129"><a href="#forceSolve-129"><span class="linenos"> 129</span></a>
</span><span id="forceSolve-130"><a href="#forceSolve-130"><span class="linenos"> 130</span></a><span class="sd">        Note that this is **not** the inverse of the number of pixels per meter, as is used</span>
</span><span id="forceSolve-131"><a href="#forceSolve-131"><span class="linenos"> 131</span></a><span class="sd">        in some of the other force solving implementations.</span>
</span><span id="forceSolve-132"><a href="#forceSolve-132"><span class="linenos"> 132</span></a>
</span><span id="forceSolve-133"><a href="#forceSolve-133"><span class="linenos"> 133</span></a><span class="sd">    brightfield : bool</span>
</span><span id="forceSolve-134"><a href="#forceSolve-134"><span class="linenos"> 134</span></a><span class="sd">        Whether the images are captured using a brightfield polariscope (`True`) or</span>
</span><span id="forceSolve-135"><a href="#forceSolve-135"><span class="linenos"> 135</span></a><span class="sd">        a darkfield polariscope (`False`).</span>
</span><span id="forceSolve-136"><a href="#forceSolve-136"><span class="linenos"> 136</span></a>
</span><span id="forceSolve-137"><a href="#forceSolve-137"><span class="linenos"> 137</span></a><span class="sd">    contactPadding : int</span>
</span><span id="forceSolve-138"><a href="#forceSolve-138"><span class="linenos"> 138</span></a><span class="sd">        Maximum distance (in pixels) between a particle&#39;s edge and the wall or the edges of two</span>
</span><span id="forceSolve-139"><a href="#forceSolve-139"><span class="linenos"> 139</span></a><span class="sd">        particles that will still be considered a potential force-bearing contact.</span>
</span><span id="forceSolve-140"><a href="#forceSolve-140"><span class="linenos"> 140</span></a>
</span><span id="forceSolve-141"><a href="#forceSolve-141"><span class="linenos"> 141</span></a><span class="sd">    g2MaskPadding : int or float</span>
</span><span id="forceSolve-142"><a href="#forceSolve-142"><span class="linenos"> 142</span></a><span class="sd">        Number of pixels to ignore at the edge of each particle when calculating the average G^2.</span>
</span><span id="forceSolve-143"><a href="#forceSolve-143"><span class="linenos"> 143</span></a><span class="sd">        If float value &lt; 1 is passed, gradient mask radius will be taken as that percent of the full</span>
</span><span id="forceSolve-144"><a href="#forceSolve-144"><span class="linenos"> 144</span></a><span class="sd">        particle radius. A value of 0 means no padding is included.</span>
</span><span id="forceSolve-145"><a href="#forceSolve-145"><span class="linenos"> 145</span></a>
</span><span id="forceSolve-146"><a href="#forceSolve-146"><span class="linenos"> 146</span></a><span class="sd">    contactMaskRadius : float</span>
</span><span id="forceSolve-147"><a href="#forceSolve-147"><span class="linenos"> 147</span></a><span class="sd">        The radius of the circular mask that will be constructed around each contact to estimate</span>
</span><span id="forceSolve-148"><a href="#forceSolve-148"><span class="linenos"> 148</span></a><span class="sd">        the magnitude of the force using the gradient squared in that region.</span>
</span><span id="forceSolve-149"><a href="#forceSolve-149"><span class="linenos"> 149</span></a>
</span><span id="forceSolve-150"><a href="#forceSolve-150"><span class="linenos"> 150</span></a><span class="sd">    lightCorrectionImage : str or np.ndarray[H,W[,C]]</span>
</span><span id="forceSolve-151"><a href="#forceSolve-151"><span class="linenos"> 151</span></a><span class="sd">        The path to an image (or an array representing an image) that contains no particles, and</span>
</span><span id="forceSolve-152"><a href="#forceSolve-152"><span class="linenos"> 152</span></a><span class="sd">        can be used to correct for any light gradients present in the actual data.</span>
</span><span id="forceSolve-153"><a href="#forceSolve-153"><span class="linenos"> 153</span></a>
</span><span id="forceSolve-154"><a href="#forceSolve-154"><span class="linenos"> 154</span></a><span class="sd">    lightCorrectionHorizontalMask : str or np.ndarray[H,W[,C]]</span>
</span><span id="forceSolve-155"><a href="#forceSolve-155"><span class="linenos"> 155</span></a><span class="sd">        A mask array, containing values of `0` or `1`, with the latter representing areas over which</span>
</span><span id="forceSolve-156"><a href="#forceSolve-156"><span class="linenos"> 156</span></a><span class="sd">        the horizontal light correction should be calculated. Can also be a path to an image.</span>
</span><span id="forceSolve-157"><a href="#forceSolve-157"><span class="linenos"> 157</span></a>
</span><span id="forceSolve-158"><a href="#forceSolve-158"><span class="linenos"> 158</span></a><span class="sd">    lightCorrectionVerticalMask : str or np.ndarray[H,W[,C]]</span>
</span><span id="forceSolve-159"><a href="#forceSolve-159"><span class="linenos"> 159</span></a><span class="sd">        A mask array, containing values of `0` or `1`, with the latter representing areas over which</span>
</span><span id="forceSolve-160"><a href="#forceSolve-160"><span class="linenos"> 160</span></a><span class="sd">        the vertical light correction should be calculated. Can also be a path to an image.</span>
</span><span id="forceSolve-161"><a href="#forceSolve-161"><span class="linenos"> 161</span></a>
</span><span id="forceSolve-162"><a href="#forceSolve-162"><span class="linenos"> 162</span></a><span class="sd">    g2CalibrationImage : str or np.ndarray[H,W,C]</span>
</span><span id="forceSolve-163"><a href="#forceSolve-163"><span class="linenos"> 163</span></a><span class="sd">        An image with a single particle (or at least one particle) that has no force acting on it.</span>
</span><span id="forceSolve-164"><a href="#forceSolve-164"><span class="linenos"> 164</span></a><span class="sd">        Used to determine the base level of gradient squared (due to noise) for a free particle. Can</span>
</span><span id="forceSolve-165"><a href="#forceSolve-165"><span class="linenos"> 165</span></a><span class="sd">        also be a path to an image.</span>
</span><span id="forceSolve-166"><a href="#forceSolve-166"><span class="linenos"> 166</span></a>
</span><span id="forceSolve-167"><a href="#forceSolve-167"><span class="linenos"> 167</span></a><span class="sd">    g2CalibrationCutoffFactor : float</span>
</span><span id="forceSolve-168"><a href="#forceSolve-168"><span class="linenos"> 168</span></a><span class="sd">        The factor that is multipled by the mean gradient squared value of the particles in the </span>
</span><span id="forceSolve-169"><a href="#forceSolve-169"><span class="linenos"> 169</span></a><span class="sd">        calibration image. Any particle that has an average gradient squared value below the </span>
</span><span id="forceSolve-170"><a href="#forceSolve-170"><span class="linenos"> 170</span></a><span class="sd">        calibration value multipled by this factor will be assumed to have no forces acting on it.</span>
</span><span id="forceSolve-171"><a href="#forceSolve-171"><span class="linenos"> 171</span></a>
</span><span id="forceSolve-172"><a href="#forceSolve-172"><span class="linenos"> 172</span></a><span class="sd">    maskImage : str or np.ndarray[H,W,C]</span>
</span><span id="forceSolve-173"><a href="#forceSolve-173"><span class="linenos"> 173</span></a><span class="sd">        A mask array, containing values of `0` or `1`, with the latter representing the regions of</span>
</span><span id="forceSolve-174"><a href="#forceSolve-174"><span class="linenos"> 174</span></a><span class="sd">        importance for the image. Used in detecting particles, generating initial guesses, and</span>
</span><span id="forceSolve-175"><a href="#forceSolve-175"><span class="linenos"> 175</span></a><span class="sd">        calculating error during non-linear optimization. can also be a path to an image.</span>
</span><span id="forceSolve-176"><a href="#forceSolve-176"><span class="linenos"> 176</span></a>
</span><span id="forceSolve-177"><a href="#forceSolve-177"><span class="linenos"> 177</span></a><span class="sd">    cropXMin : int or None</span>
</span><span id="forceSolve-178"><a href="#forceSolve-178"><span class="linenos"> 178</span></a><span class="sd">        Left bound to crop down the image in the x direction.</span>
</span><span id="forceSolve-179"><a href="#forceSolve-179"><span class="linenos"> 179</span></a>
</span><span id="forceSolve-180"><a href="#forceSolve-180"><span class="linenos"> 180</span></a><span class="sd">    cropXMax : int or None</span>
</span><span id="forceSolve-181"><a href="#forceSolve-181"><span class="linenos"> 181</span></a><span class="sd">        Right bound to crop down the image in the x direction.</span>
</span><span id="forceSolve-182"><a href="#forceSolve-182"><span class="linenos"> 182</span></a>
</span><span id="forceSolve-183"><a href="#forceSolve-183"><span class="linenos"> 183</span></a><span class="sd">    peBlurKernel : int</span>
</span><span id="forceSolve-184"><a href="#forceSolve-184"><span class="linenos"> 184</span></a><span class="sd">        The kernel size that will be used for bluring the photoelastic channel of each image, to</span>
</span><span id="forceSolve-185"><a href="#forceSolve-185"><span class="linenos"> 185</span></a><span class="sd">        reduce noise. Should be an odd integer.</span>
</span><span id="forceSolve-186"><a href="#forceSolve-186"><span class="linenos"> 186</span></a>
</span><span id="forceSolve-187"><a href="#forceSolve-187"><span class="linenos"> 187</span></a><span class="sd">    imageExtension : str</span>
</span><span id="forceSolve-188"><a href="#forceSolve-188"><span class="linenos"> 188</span></a><span class="sd">        The extension of the image files that will be read in from `imageDirectory`. Should not include</span>
</span><span id="forceSolve-189"><a href="#forceSolve-189"><span class="linenos"> 189</span></a><span class="sd">        the &#39;.&#39; before the extension.</span>
</span><span id="forceSolve-190"><a href="#forceSolve-190"><span class="linenos"> 190</span></a>
</span><span id="forceSolve-191"><a href="#forceSolve-191"><span class="linenos"> 191</span></a><span class="sd">    requireForceBalance : bool</span>
</span><span id="forceSolve-192"><a href="#forceSolve-192"><span class="linenos"> 192</span></a><span class="sd">        Whether to impose particle-wise force balance at each step (`True`) or to take the results of</span>
</span><span id="forceSolve-193"><a href="#forceSolve-193"><span class="linenos"> 193</span></a><span class="sd">        the optimization process as they are (`False`).</span>
</span><span id="forceSolve-194"><a href="#forceSolve-194"><span class="linenos"> 194</span></a>
</span><span id="forceSolve-195"><a href="#forceSolve-195"><span class="linenos"> 195</span></a><span class="sd">        Currently WIP, and does not do anything.</span>
</span><span id="forceSolve-196"><a href="#forceSolve-196"><span class="linenos"> 196</span></a>
</span><span id="forceSolve-197"><a href="#forceSolve-197"><span class="linenos"> 197</span></a><span class="sd">    forceBalanceWeighting : float</span>
</span><span id="forceSolve-198"><a href="#forceSolve-198"><span class="linenos"> 198</span></a><span class="sd">        If a non-zero positive value, adds a contribution to the optimization cost</span>
</span><span id="forceSolve-199"><a href="#forceSolve-199"><span class="linenos"> 199</span></a><span class="sd">        pertaining to how well the ensemble of forces satisfy force balance.</span>
</span><span id="forceSolve-200"><a href="#forceSolve-200"><span class="linenos"> 200</span></a>
</span><span id="forceSolve-201"><a href="#forceSolve-201"><span class="linenos"> 201</span></a><span class="sd">    imageStartIndex : int or None</span>
</span><span id="forceSolve-202"><a href="#forceSolve-202"><span class="linenos"> 202</span></a><span class="sd">        The index of which image to start at when analyzing the files in `imageDirectory`. Value</span>
</span><span id="forceSolve-203"><a href="#forceSolve-203"><span class="linenos"> 203</span></a><span class="sd">        of `None` will start at the first (alphabetically sorted) image.</span>
</span><span id="forceSolve-204"><a href="#forceSolve-204"><span class="linenos"> 204</span></a>
</span><span id="forceSolve-205"><a href="#forceSolve-205"><span class="linenos"> 205</span></a><span class="sd">    imageEndIndex : int or None</span>
</span><span id="forceSolve-206"><a href="#forceSolve-206"><span class="linenos"> 206</span></a><span class="sd">        The index of which image to end at when analyzing the files in `imageDirectory`. Value</span>
</span><span id="forceSolve-207"><a href="#forceSolve-207"><span class="linenos"> 207</span></a><span class="sd">        of `None` will end at the last (alphabetically sorted) image.</span>
</span><span id="forceSolve-208"><a href="#forceSolve-208"><span class="linenos"> 208</span></a>
</span><span id="forceSolve-209"><a href="#forceSolve-209"><span class="linenos"> 209</span></a><span class="sd">    circleDetectionMethod : [&#39;convolution&#39; or &#39;hough&#39;]</span>
</span><span id="forceSolve-210"><a href="#forceSolve-210"><span class="linenos"> 210</span></a><span class="sd">        Whether to use the convolution or hough circle detection method to identify particles.</span>
</span><span id="forceSolve-211"><a href="#forceSolve-211"><span class="linenos"> 211</span></a>
</span><span id="forceSolve-212"><a href="#forceSolve-212"><span class="linenos"> 212</span></a><span class="sd">        See `pepe.tracking.convCircle()` and `pepe.tracking.houghCircle()` for more information.</span>
</span><span id="forceSolve-213"><a href="#forceSolve-213"><span class="linenos"> 213</span></a>
</span><span id="forceSolve-214"><a href="#forceSolve-214"><span class="linenos"> 214</span></a><span class="sd">    circleTrackingKwargs : **kwargs</span>
</span><span id="forceSolve-215"><a href="#forceSolve-215"><span class="linenos"> 215</span></a><span class="sd">        Keyword arguments to be passed to the selected circle tracking function.</span>
</span><span id="forceSolve-216"><a href="#forceSolve-216"><span class="linenos"> 216</span></a>
</span><span id="forceSolve-217"><a href="#forceSolve-217"><span class="linenos"> 217</span></a><span class="sd">        See `pepe.tracking.convCircle()` and `pepe.tracking.houghCircle()` for more information.</span>
</span><span id="forceSolve-218"><a href="#forceSolve-218"><span class="linenos"> 218</span></a>
</span><span id="forceSolve-219"><a href="#forceSolve-219"><span class="linenos"> 219</span></a><span class="sd">    circleTrackingChannel : int</span>
</span><span id="forceSolve-220"><a href="#forceSolve-220"><span class="linenos"> 220</span></a><span class="sd">        The channel of the image that will be used to track the particles. `0` for red, `1` for</span>
</span><span id="forceSolve-221"><a href="#forceSolve-221"><span class="linenos"> 221</span></a><span class="sd">        green, and `2` for blue.</span>
</span><span id="forceSolve-222"><a href="#forceSolve-222"><span class="linenos"> 222</span></a>
</span><span id="forceSolve-223"><a href="#forceSolve-223"><span class="linenos"> 223</span></a><span class="sd">    circleTrackingGain : float</span>
</span><span id="forceSolve-224"><a href="#forceSolve-224"><span class="linenos"> 224</span></a><span class="sd">        The gain applied to the intensity in the circle tracking channel.</span>
</span><span id="forceSolve-225"><a href="#forceSolve-225"><span class="linenos"> 225</span></a>
</span><span id="forceSolve-226"><a href="#forceSolve-226"><span class="linenos"> 226</span></a><span class="sd">    maxBetaDisplacement : float</span>
</span><span id="forceSolve-227"><a href="#forceSolve-227"><span class="linenos"> 227</span></a><span class="sd">        The maximum distance (angle) that a force can move between frames and still be identified</span>
</span><span id="forceSolve-228"><a href="#forceSolve-228"><span class="linenos"> 228</span></a><span class="sd">        as the same force. If a force moves more than this value, it will still be recorded as a force,</span>
</span><span id="forceSolve-229"><a href="#forceSolve-229"><span class="linenos"> 229</span></a><span class="sd">        but will be considered a new and independent force from any of the ones in the previous frame.</span>
</span><span id="forceSolve-230"><a href="#forceSolve-230"><span class="linenos"> 230</span></a>
</span><span id="forceSolve-231"><a href="#forceSolve-231"><span class="linenos"> 231</span></a><span class="sd">    photoelasticChannel : int</span>
</span><span id="forceSolve-232"><a href="#forceSolve-232"><span class="linenos"> 232</span></a><span class="sd">        The channel of the image that will be used to gauge the photoelastic response. `0` for red, `1` for</span>
</span><span id="forceSolve-233"><a href="#forceSolve-233"><span class="linenos"> 233</span></a><span class="sd">        green, and `2` for blue.</span>
</span><span id="forceSolve-234"><a href="#forceSolve-234"><span class="linenos"> 234</span></a>
</span><span id="forceSolve-235"><a href="#forceSolve-235"><span class="linenos"> 235</span></a><span class="sd">    photoelasticGain : float</span>
</span><span id="forceSolve-236"><a href="#forceSolve-236"><span class="linenos"> 236</span></a><span class="sd">        The gain applied to the intensity in the photoelastic channel.</span>
</span><span id="forceSolve-237"><a href="#forceSolve-237"><span class="linenos"> 237</span></a>
</span><span id="forceSolve-238"><a href="#forceSolve-238"><span class="linenos"> 238</span></a><span class="sd">    forceNoiseWidth : float or None</span>
</span><span id="forceSolve-239"><a href="#forceSolve-239"><span class="linenos"> 239</span></a><span class="sd">        The width of the gaussian distribution (centered at 0) that noise is sampled from to add to the</span>
</span><span id="forceSolve-240"><a href="#forceSolve-240"><span class="linenos"> 240</span></a><span class="sd">        force guesses (potentially from the previous frame). This is done to avoid getting stuck in a local</span>
</span><span id="forceSolve-241"><a href="#forceSolve-241"><span class="linenos"> 241</span></a><span class="sd">        minimum for too long (adds some Monte-Carlo-esque behavior to the solving).</span>
</span><span id="forceSolve-242"><a href="#forceSolve-242"><span class="linenos"> 242</span></a>
</span><span id="forceSolve-243"><a href="#forceSolve-243"><span class="linenos"> 243</span></a><span class="sd">    alphaNoiseWidth : float or None</span>
</span><span id="forceSolve-244"><a href="#forceSolve-244"><span class="linenos"> 244</span></a><span class="sd">        The width of the gaussian distribution (centered at 0) that noise is sampled from to add to the</span>
</span><span id="forceSolve-245"><a href="#forceSolve-245"><span class="linenos"> 245</span></a><span class="sd">        alpha guesses (potentially from the previous frame). This is done to avoid getting stuck in a local</span>
</span><span id="forceSolve-246"><a href="#forceSolve-246"><span class="linenos"> 246</span></a><span class="sd">        minimum for too long (adds some Monte-Carlo-esque behavior to the solving).</span>
</span><span id="forceSolve-247"><a href="#forceSolve-247"><span class="linenos"> 247</span></a>
</span><span id="forceSolve-248"><a href="#forceSolve-248"><span class="linenos"> 248</span></a><span class="sd">    optimizationKwargs : **kwargs</span>
</span><span id="forceSolve-249"><a href="#forceSolve-249"><span class="linenos"> 249</span></a><span class="sd">        Keyword arguments to be passed to the optimization process.</span>
</span><span id="forceSolve-250"><a href="#forceSolve-250"><span class="linenos"> 250</span></a>
</span><span id="forceSolve-251"><a href="#forceSolve-251"><span class="linenos"> 251</span></a><span class="sd">        For more information, see `pepe.analysis.forceOptimize()`.</span>
</span><span id="forceSolve-252"><a href="#forceSolve-252"><span class="linenos"> 252</span></a>
</span><span id="forceSolve-253"><a href="#forceSolve-253"><span class="linenos"> 253</span></a><span class="sd">    performOptimization : bool</span>
</span><span id="forceSolve-254"><a href="#forceSolve-254"><span class="linenos"> 254</span></a><span class="sd">        Whether or not to perform optimization on the particles.</span>
</span><span id="forceSolve-255"><a href="#forceSolve-255"><span class="linenos"> 255</span></a>
</span><span id="forceSolve-256"><a href="#forceSolve-256"><span class="linenos"> 256</span></a><span class="sd">        Mostly included as a debug option, but any real data analysis should</span>
</span><span id="forceSolve-257"><a href="#forceSolve-257"><span class="linenos"> 257</span></a><span class="sd">        utilize the optimization, as the initial guessing is often not nearly</span>
</span><span id="forceSolve-258"><a href="#forceSolve-258"><span class="linenos"> 258</span></a><span class="sd">        accurate enough to get any real results.</span>
</span><span id="forceSolve-259"><a href="#forceSolve-259"><span class="linenos"> 259</span></a>
</span><span id="forceSolve-260"><a href="#forceSolve-260"><span class="linenos"> 260</span></a><span class="sd">    debug : bool</span>
</span><span id="forceSolve-261"><a href="#forceSolve-261"><span class="linenos"> 261</span></a><span class="sd">        Whether to print progress updates for each frame to the screen (`True`) or not (`False`).</span>
</span><span id="forceSolve-262"><a href="#forceSolve-262"><span class="linenos"> 262</span></a>
</span><span id="forceSolve-263"><a href="#forceSolve-263"><span class="linenos"> 263</span></a><span class="sd">    showProgressBar : bool</span>
</span><span id="forceSolve-264"><a href="#forceSolve-264"><span class="linenos"> 264</span></a><span class="sd">        Whether to show a progress bar throughout the analysis (`True`) or not (`False`). Uses</span>
</span><span id="forceSolve-265"><a href="#forceSolve-265"><span class="linenos"> 265</span></a><span class="sd">        `tqdm` library.</span>
</span><span id="forceSolve-266"><a href="#forceSolve-266"><span class="linenos"> 266</span></a>
</span><span id="forceSolve-267"><a href="#forceSolve-267"><span class="linenos"> 267</span></a><span class="sd">    progressBarOffset : int</span>
</span><span id="forceSolve-268"><a href="#forceSolve-268"><span class="linenos"> 268</span></a><span class="sd">        The number of lines to offset the progress bar by. Generally an internal variable</span>
</span><span id="forceSolve-269"><a href="#forceSolve-269"><span class="linenos"> 269</span></a><span class="sd">        used when multiple threads are active.</span>
</span><span id="forceSolve-270"><a href="#forceSolve-270"><span class="linenos"> 270</span></a>
</span><span id="forceSolve-271"><a href="#forceSolve-271"><span class="linenos"> 271</span></a><span class="sd">    progressBarTitle : str</span>
</span><span id="forceSolve-272"><a href="#forceSolve-272"><span class="linenos"> 272</span></a><span class="sd">        The text to be written to the left of the progress bar. Generally an internal variable</span>
</span><span id="forceSolve-273"><a href="#forceSolve-273"><span class="linenos"> 273</span></a><span class="sd">        controlled by some solving script.</span>
</span><span id="forceSolve-274"><a href="#forceSolve-274"><span class="linenos"> 274</span></a>
</span><span id="forceSolve-275"><a href="#forceSolve-275"><span class="linenos"> 275</span></a><span class="sd">    saveMovie : bool</span>
</span><span id="forceSolve-276"><a href="#forceSolve-276"><span class="linenos"> 276</span></a><span class="sd">        Whether to save a compiled gif of the reconstructed forces at each frame at the end (`True`)</span>
</span><span id="forceSolve-277"><a href="#forceSolve-277"><span class="linenos"> 277</span></a><span class="sd">        or not (`False`).</span>
</span><span id="forceSolve-278"><a href="#forceSolve-278"><span class="linenos"> 278</span></a>
</span><span id="forceSolve-279"><a href="#forceSolve-279"><span class="linenos"> 279</span></a><span class="sd">    outputRootFolder : str</span>
</span><span id="forceSolve-280"><a href="#forceSolve-280"><span class="linenos"> 280</span></a><span class="sd">        The location where the output folder (potentially containg the movie, pickle files, readme, etc.)</span>
</span><span id="forceSolve-281"><a href="#forceSolve-281"><span class="linenos"> 281</span></a><span class="sd">        will be created. Output folder itself will be named after the `imageDirectory`, with &#39;_Synthetic&#39;</span>
</span><span id="forceSolve-282"><a href="#forceSolve-282"><span class="linenos"> 282</span></a><span class="sd">        appended to the end.</span>
</span><span id="forceSolve-283"><a href="#forceSolve-283"><span class="linenos"> 283</span></a>
</span><span id="forceSolve-284"><a href="#forceSolve-284"><span class="linenos"> 284</span></a><span class="sd">    pickleArrays : bool</span>
</span><span id="forceSolve-285"><a href="#forceSolve-285"><span class="linenos"> 285</span></a><span class="sd">        Whether to save the forces, betas, alphas, centers, and radii as pickle files (`True`) or not (`False`).</span>
</span><span id="forceSolve-286"><a href="#forceSolve-286"><span class="linenos"> 286</span></a><span class="sd">        Files will be located in the output folder (see `outputRootFolder`).</span>
</span><span id="forceSolve-287"><a href="#forceSolve-287"><span class="linenos"> 287</span></a>
</span><span id="forceSolve-288"><a href="#forceSolve-288"><span class="linenos"> 288</span></a><span class="sd">    inputSettingsFile : str</span>
</span><span id="forceSolve-289"><a href="#forceSolve-289"><span class="linenos"> 289</span></a><span class="sd">        Path to a readme file containg parameters for the solving process, likely generated from</span>
</span><span id="forceSolve-290"><a href="#forceSolve-290"><span class="linenos"> 290</span></a><span class="sd">        a previous iteration of the program. Explicitly passed arguments will override those that</span>
</span><span id="forceSolve-291"><a href="#forceSolve-291"><span class="linenos"> 291</span></a><span class="sd">        are included in the settings file.</span>
</span><span id="forceSolve-292"><a href="#forceSolve-292"><span class="linenos"> 292</span></a>
</span><span id="forceSolve-293"><a href="#forceSolve-293"><span class="linenos"> 293</span></a><span class="sd">        Currently WIP and does not do anything.</span>
</span><span id="forceSolve-294"><a href="#forceSolve-294"><span class="linenos"> 294</span></a>
</span><span id="forceSolve-295"><a href="#forceSolve-295"><span class="linenos"> 295</span></a><span class="sd">    genFitReport : bool</span>
</span><span id="forceSolve-296"><a href="#forceSolve-296"><span class="linenos"> 296</span></a><span class="sd">        Whether or not to generate a fit report of the results, including errors per frame,</span>
</span><span id="forceSolve-297"><a href="#forceSolve-297"><span class="linenos"> 297</span></a><span class="sd">        examinations of all particles/forces, and settings, compiled in a latex pdf.</span>
</span><span id="forceSolve-298"><a href="#forceSolve-298"><span class="linenos"> 298</span></a>
</span><span id="forceSolve-299"><a href="#forceSolve-299"><span class="linenos"> 299</span></a><span class="sd">        Will generate both the compiled file &#39;FitReport.pdf&#39; and the source directory</span>
</span><span id="forceSolve-300"><a href="#forceSolve-300"><span class="linenos"> 300</span></a><span class="sd">        &#39;FitReport_src/&#39;.</span>
</span><span id="forceSolve-301"><a href="#forceSolve-301"><span class="linenos"> 301</span></a><span class="sd">    </span>
</span><span id="forceSolve-302"><a href="#forceSolve-302"><span class="linenos"> 302</span></a><span class="sd">    Returns</span>
</span><span id="forceSolve-303"><a href="#forceSolve-303"><span class="linenos"> 303</span></a><span class="sd">    -------</span>
</span><span id="forceSolve-304"><a href="#forceSolve-304"><span class="linenos"> 304</span></a>
</span><span id="forceSolve-305"><a href="#forceSolve-305"><span class="linenos"> 305</span></a><span class="sd">    rectForceArr : list[P](np.ndarray[F,T])</span>
</span><span id="forceSolve-306"><a href="#forceSolve-306"><span class="linenos"> 306</span></a><span class="sd">        A list of arrays representing the force magnitude for each force on each particle.</span>
</span><span id="forceSolve-307"><a href="#forceSolve-307"><span class="linenos"> 307</span></a>
</span><span id="forceSolve-308"><a href="#forceSolve-308"><span class="linenos"> 308</span></a><span class="sd">    rectAlphaArr : list[P](np.ndarray[F,T])</span>
</span><span id="forceSolve-309"><a href="#forceSolve-309"><span class="linenos"> 309</span></a><span class="sd">        A list of arrays representing the alpha angle for each force on each particle.</span>
</span><span id="forceSolve-310"><a href="#forceSolve-310"><span class="linenos"> 310</span></a>
</span><span id="forceSolve-311"><a href="#forceSolve-311"><span class="linenos"> 311</span></a><span class="sd">    rectBetaArr : list[P](np.ndarray[F,T])</span>
</span><span id="forceSolve-312"><a href="#forceSolve-312"><span class="linenos"> 312</span></a><span class="sd">        A list of arrays representing the beta angle for force on each particle.</span>
</span><span id="forceSolve-313"><a href="#forceSolve-313"><span class="linenos"> 313</span></a>
</span><span id="forceSolve-314"><a href="#forceSolve-314"><span class="linenos"> 314</span></a><span class="sd">    rectCenterArr : np.ndarray[P,T,2]</span>
</span><span id="forceSolve-315"><a href="#forceSolve-315"><span class="linenos"> 315</span></a><span class="sd">        Particle centers for each timestep. Elements take on a value of `[np.nan, np.nan]`</span>
</span><span id="forceSolve-316"><a href="#forceSolve-316"><span class="linenos"> 316</span></a><span class="sd">        if the particle does not exist for a given timestep.</span>
</span><span id="forceSolve-317"><a href="#forceSolve-317"><span class="linenos"> 317</span></a>
</span><span id="forceSolve-318"><a href="#forceSolve-318"><span class="linenos"> 318</span></a><span class="sd">    rectRadiusArr : np.ndarray[P,T]</span>
</span><span id="forceSolve-319"><a href="#forceSolve-319"><span class="linenos"> 319</span></a><span class="sd">        Particle radii for each timestep. Elements take on a value of `np.nan` if the particle</span>
</span><span id="forceSolve-320"><a href="#forceSolve-320"><span class="linenos"> 320</span></a><span class="sd">        does not exist for a given timestep.</span>
</span><span id="forceSolve-321"><a href="#forceSolve-321"><span class="linenos"> 321</span></a>
</span><span id="forceSolve-322"><a href="#forceSolve-322"><span class="linenos"> 322</span></a>
</span><span id="forceSolve-323"><a href="#forceSolve-323"><span class="linenos"> 323</span></a><span class="sd">    Depending on kwarg values, several files may be written created in the output</span>
</span><span id="forceSolve-324"><a href="#forceSolve-324"><span class="linenos"> 324</span></a><span class="sd">    folder, which will be located in `outputRootFolder` and named according</span>
</span><span id="forceSolve-325"><a href="#forceSolve-325"><span class="linenos"> 325</span></a><span class="sd">    to:  &#39;&lt;`imageDirectory`&gt;_Synthetic/&#39;.</span>
</span><span id="forceSolve-326"><a href="#forceSolve-326"><span class="linenos"> 326</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="forceSolve-327"><a href="#forceSolve-327"><span class="linenos"> 327</span></a>   
</span><span id="forceSolve-328"><a href="#forceSolve-328"><span class="linenos"> 328</span></a>    <span class="n">overallStartTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="forceSolve-329"><a href="#forceSolve-329"><span class="linenos"> 329</span></a>
</span><span id="forceSolve-330"><a href="#forceSolve-330"><span class="linenos"> 330</span></a>    <span class="c1"># For the sake of saving the options to a readme file (and potentially)</span>
</span><span id="forceSolve-331"><a href="#forceSolve-331"><span class="linenos"> 331</span></a>    <span class="c1"># reading them back out, it is easiest to keep all of the settings in a</span>
</span><span id="forceSolve-332"><a href="#forceSolve-332"><span class="linenos"> 332</span></a>    <span class="c1"># dictionary</span>
</span><span id="forceSolve-333"><a href="#forceSolve-333"><span class="linenos"> 333</span></a>
</span><span id="forceSolve-334"><a href="#forceSolve-334"><span class="linenos"> 334</span></a>    <span class="c1"># We have 3 layers of precedence for reading in settings:</span>
</span><span id="forceSolve-335"><a href="#forceSolve-335"><span class="linenos"> 335</span></a>    <span class="c1"># 1. Explicitly passed kwarg</span>
</span><span id="forceSolve-336"><a href="#forceSolve-336"><span class="linenos"> 336</span></a>    <span class="c1"># 2. Read in from settings file</span>
</span><span id="forceSolve-337"><a href="#forceSolve-337"><span class="linenos"> 337</span></a>    <span class="c1"># 3. Default value of a kwarg</span>
</span><span id="forceSolve-338"><a href="#forceSolve-338"><span class="linenos"> 338</span></a>    <span class="c1"># So we assign the elements of our settings dict in opposite order</span>
</span><span id="forceSolve-339"><a href="#forceSolve-339"><span class="linenos"> 339</span></a>
</span><span id="forceSolve-340"><a href="#forceSolve-340"><span class="linenos"> 340</span></a>    <span class="c1"># 3. All of the default values</span>
</span><span id="forceSolve-341"><a href="#forceSolve-341"><span class="linenos"> 341</span></a>    <span class="c1"># The following variables are not present:</span>
</span><span id="forceSolve-342"><a href="#forceSolve-342"><span class="linenos"> 342</span></a>    <span class="c1"># progressBarOffset, progressBarTitle</span>
</span><span id="forceSolve-343"><a href="#forceSolve-343"><span class="linenos"> 343</span></a>    <span class="c1"># This is because we don&#39;t care about saving them</span>
</span><span id="forceSolve-344"><a href="#forceSolve-344"><span class="linenos"> 344</span></a>    <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">imageDirectory</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="c1"># Convert to absolute path</span>
</span><span id="forceSolve-345"><a href="#forceSolve-345"><span class="linenos"> 345</span></a>                <span class="s2">&quot;imageExtension&quot;</span><span class="p">:</span> <span class="n">imageExtension</span><span class="p">,</span>
</span><span id="forceSolve-346"><a href="#forceSolve-346"><span class="linenos"> 346</span></a>                <span class="s2">&quot;imageEndIndex&quot;</span><span class="p">:</span> <span class="n">imageEndIndex</span><span class="p">,</span>
</span><span id="forceSolve-347"><a href="#forceSolve-347"><span class="linenos"> 347</span></a>                <span class="s2">&quot;imageStartIndex&quot;</span><span class="p">:</span> <span class="n">imageStartIndex</span><span class="p">,</span>
</span><span id="forceSolve-348"><a href="#forceSolve-348"><span class="linenos"> 348</span></a>                <span class="s2">&quot;carryOverAlpha&quot;</span><span class="p">:</span> <span class="n">carryOverAlpha</span><span class="p">,</span>
</span><span id="forceSolve-349"><a href="#forceSolve-349"><span class="linenos"> 349</span></a>                <span class="s2">&quot;carryOverForce&quot;</span><span class="p">:</span> <span class="n">carryOverForce</span><span class="p">,</span>
</span><span id="forceSolve-350"><a href="#forceSolve-350"><span class="linenos"> 350</span></a>                <span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">:</span> <span class="n">lightCorrectionImage</span><span class="p">,</span>
</span><span id="forceSolve-351"><a href="#forceSolve-351"><span class="linenos"> 351</span></a>                <span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">:</span> <span class="n">lightCorrectionVerticalMask</span><span class="p">,</span>
</span><span id="forceSolve-352"><a href="#forceSolve-352"><span class="linenos"> 352</span></a>                <span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">:</span> <span class="n">lightCorrectionHorizontalMask</span><span class="p">,</span>
</span><span id="forceSolve-353"><a href="#forceSolve-353"><span class="linenos"> 353</span></a>                <span class="s2">&quot;g2CalibrationImage&quot;</span><span class="p">:</span> <span class="n">g2CalibrationImage</span><span class="p">,</span>
</span><span id="forceSolve-354"><a href="#forceSolve-354"><span class="linenos"> 354</span></a>                <span class="s2">&quot;g2CalibrationCutoffFactor&quot;</span><span class="p">:</span> <span class="n">g2CalibrationCutoffFactor</span><span class="p">,</span>
</span><span id="forceSolve-355"><a href="#forceSolve-355"><span class="linenos"> 355</span></a>                <span class="s2">&quot;maskImage&quot;</span><span class="p">:</span> <span class="n">maskImage</span><span class="p">,</span>
</span><span id="forceSolve-356"><a href="#forceSolve-356"><span class="linenos"> 356</span></a>                <span class="s2">&quot;cropXMin&quot;</span><span class="p">:</span> <span class="n">cropXMin</span><span class="p">,</span>
</span><span id="forceSolve-357"><a href="#forceSolve-357"><span class="linenos"> 357</span></a>                <span class="s2">&quot;cropXMax&quot;</span><span class="p">:</span> <span class="n">cropXMax</span><span class="p">,</span>
</span><span id="forceSolve-358"><a href="#forceSolve-358"><span class="linenos"> 358</span></a>                <span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">:</span> <span class="n">circleDetectionMethod</span><span class="p">,</span>
</span><span id="forceSolve-359"><a href="#forceSolve-359"><span class="linenos"> 359</span></a>                <span class="s2">&quot;guessRadius&quot;</span><span class="p">:</span> <span class="n">guessRadius</span><span class="p">,</span>
</span><span id="forceSolve-360"><a href="#forceSolve-360"><span class="linenos"> 360</span></a>                <span class="s2">&quot;fSigma&quot;</span><span class="p">:</span> <span class="n">fSigma</span><span class="p">,</span>
</span><span id="forceSolve-361"><a href="#forceSolve-361"><span class="linenos"> 361</span></a>                <span class="s2">&quot;pxPerMeter&quot;</span><span class="p">:</span> <span class="n">pxPerMeter</span><span class="p">,</span>
</span><span id="forceSolve-362"><a href="#forceSolve-362"><span class="linenos"> 362</span></a>                <span class="s2">&quot;brightfield&quot;</span><span class="p">:</span> <span class="n">brightfield</span><span class="p">,</span>
</span><span id="forceSolve-363"><a href="#forceSolve-363"><span class="linenos"> 363</span></a>                <span class="s2">&quot;contactPadding&quot;</span><span class="p">:</span> <span class="n">contactPadding</span><span class="p">,</span>
</span><span id="forceSolve-364"><a href="#forceSolve-364"><span class="linenos"> 364</span></a>                <span class="s2">&quot;g2MaskPadding&quot;</span><span class="p">:</span> <span class="n">g2MaskPadding</span><span class="p">,</span>
</span><span id="forceSolve-365"><a href="#forceSolve-365"><span class="linenos"> 365</span></a>                <span class="s2">&quot;contactMaskRadius&quot;</span><span class="p">:</span> <span class="n">contactMaskRadius</span><span class="p">,</span>
</span><span id="forceSolve-366"><a href="#forceSolve-366"><span class="linenos"> 366</span></a>                <span class="s2">&quot;peBlurKernel&quot;</span><span class="p">:</span> <span class="n">peBlurKernel</span><span class="p">,</span>
</span><span id="forceSolve-367"><a href="#forceSolve-367"><span class="linenos"> 367</span></a>                <span class="s2">&quot;requireForceBalance&quot;</span><span class="p">:</span> <span class="n">requireForceBalance</span><span class="p">,</span>
</span><span id="forceSolve-368"><a href="#forceSolve-368"><span class="linenos"> 368</span></a>                <span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">:</span> <span class="n">circleTrackingChannel</span><span class="p">,</span>
</span><span id="forceSolve-369"><a href="#forceSolve-369"><span class="linenos"> 369</span></a>                <span class="s2">&quot;circleTrackingGain&quot;</span><span class="p">:</span> <span class="n">circleTrackingGain</span><span class="p">,</span>
</span><span id="forceSolve-370"><a href="#forceSolve-370"><span class="linenos"> 370</span></a>                <span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">:</span> <span class="n">photoelasticChannel</span><span class="p">,</span>
</span><span id="forceSolve-371"><a href="#forceSolve-371"><span class="linenos"> 371</span></a>                <span class="s2">&quot;photoelasticGain&quot;</span><span class="p">:</span> <span class="n">photoelasticGain</span><span class="p">,</span>
</span><span id="forceSolve-372"><a href="#forceSolve-372"><span class="linenos"> 372</span></a>                <span class="s2">&quot;maxBetaDisplacement&quot;</span><span class="p">:</span> <span class="n">maxBetaDisplacement</span><span class="p">,</span>
</span><span id="forceSolve-373"><a href="#forceSolve-373"><span class="linenos"> 373</span></a>                <span class="s2">&quot;forceNoiseWidth&quot;</span><span class="p">:</span> <span class="n">forceNoiseWidth</span><span class="p">,</span>
</span><span id="forceSolve-374"><a href="#forceSolve-374"><span class="linenos"> 374</span></a>                <span class="s2">&quot;alphaNoiseWidth&quot;</span><span class="p">:</span> <span class="n">alphaNoiseWidth</span><span class="p">,</span>
</span><span id="forceSolve-375"><a href="#forceSolve-375"><span class="linenos"> 375</span></a>                <span class="s2">&quot;showProgressBar&quot;</span><span class="p">:</span> <span class="n">showProgressBar</span><span class="p">,</span>
</span><span id="forceSolve-376"><a href="#forceSolve-376"><span class="linenos"> 376</span></a>                <span class="s2">&quot;saveMovie&quot;</span><span class="p">:</span> <span class="n">saveMovie</span><span class="p">,</span>
</span><span id="forceSolve-377"><a href="#forceSolve-377"><span class="linenos"> 377</span></a>                <span class="s2">&quot;pickleArrays&quot;</span><span class="p">:</span> <span class="n">pickleArrays</span><span class="p">,</span>
</span><span id="forceSolve-378"><a href="#forceSolve-378"><span class="linenos"> 378</span></a>                <span class="s2">&quot;outputRootFolder&quot;</span><span class="p">:</span> <span class="n">outputRootFolder</span><span class="p">,</span>
</span><span id="forceSolve-379"><a href="#forceSolve-379"><span class="linenos"> 379</span></a>                <span class="s2">&quot;outputExtension&quot;</span><span class="p">:</span> <span class="n">outputExtension</span><span class="p">,</span>
</span><span id="forceSolve-380"><a href="#forceSolve-380"><span class="linenos"> 380</span></a>                <span class="s2">&quot;genFitReport&quot;</span><span class="p">:</span> <span class="n">genFitReport</span><span class="p">,</span>
</span><span id="forceSolve-381"><a href="#forceSolve-381"><span class="linenos"> 381</span></a>                <span class="s2">&quot;performOptimization&quot;</span><span class="p">:</span> <span class="n">performOptimization</span><span class="p">,</span>
</span><span id="forceSolve-382"><a href="#forceSolve-382"><span class="linenos"> 382</span></a>                <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="n">debug</span><span class="p">}</span>
</span><span id="forceSolve-383"><a href="#forceSolve-383"><span class="linenos"> 383</span></a>
</span><span id="forceSolve-384"><a href="#forceSolve-384"><span class="linenos"> 384</span></a>    <span class="c1"># For the next step, we will need to know all of the data types of each</span>
</span><span id="forceSolve-385"><a href="#forceSolve-385"><span class="linenos"> 385</span></a>    <span class="c1"># argument (to properly cast). Because certain arguments have None as a default</span>
</span><span id="forceSolve-386"><a href="#forceSolve-386"><span class="linenos"> 386</span></a>    <span class="c1"># value, we can&#39;t automatically generate this information.</span>
</span><span id="forceSolve-387"><a href="#forceSolve-387"><span class="linenos"> 387</span></a>    <span class="c1"># See above this method for the list of these, since they are also used</span>
</span><span id="forceSolve-388"><a href="#forceSolve-388"><span class="linenos"> 388</span></a>    <span class="c1"># in the TrialObject file</span>
</span><span id="forceSolve-389"><a href="#forceSolve-389"><span class="linenos"> 389</span></a>
</span><span id="forceSolve-390"><a href="#forceSolve-390"><span class="linenos"> 390</span></a>    <span class="c1"># We need to do the same thing for the kwargs for both</span>
</span><span id="forceSolve-391"><a href="#forceSolve-391"><span class="linenos"> 391</span></a>    <span class="c1"># circle tracking and optimization</span>
</span><span id="forceSolve-392"><a href="#forceSolve-392"><span class="linenos"> 392</span></a>
</span><span id="forceSolve-393"><a href="#forceSolve-393"><span class="linenos"> 393</span></a>    <span class="c1"># These have both been moved to either the tracking/DTypes.py</span>
</span><span id="forceSolve-394"><a href="#forceSolve-394"><span class="linenos"> 394</span></a>    <span class="c1"># or the analysis/ForceSolve.py files, respectively</span>
</span><span id="forceSolve-395"><a href="#forceSolve-395"><span class="linenos"> 395</span></a>
</span><span id="forceSolve-396"><a href="#forceSolve-396"><span class="linenos"> 396</span></a>    <span class="c1"># Now add all the dictionaries together</span>
</span><span id="forceSolve-397"><a href="#forceSolve-397"><span class="linenos"> 397</span></a>    <span class="n">argDTypes</span> <span class="o">=</span> <span class="n">forceSolveArgDTypes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="forceSolve-398"><a href="#forceSolve-398"><span class="linenos"> 398</span></a>
</span><span id="forceSolve-399"><a href="#forceSolve-399"><span class="linenos"> 399</span></a>    <span class="n">argDTypes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">circleTrackArgDTypes</span><span class="p">)</span>
</span><span id="forceSolve-400"><a href="#forceSolve-400"><span class="linenos"> 400</span></a>    <span class="n">argDTypes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">forceOptimizeArgDTypes</span><span class="p">)</span>
</span><span id="forceSolve-401"><a href="#forceSolve-401"><span class="linenos"> 401</span></a>
</span><span id="forceSolve-402"><a href="#forceSolve-402"><span class="linenos"> 402</span></a>    <span class="c1"># 2. Anything read in from a settings file</span>
</span><span id="forceSolve-403"><a href="#forceSolve-403"><span class="linenos"> 403</span></a>    <span class="c1"># Note that it works to our advantage that we already have values for most entries,</span>
</span><span id="forceSolve-404"><a href="#forceSolve-404"><span class="linenos"> 404</span></a>    <span class="c1"># since the settings file doesn&#39;t include type information, so we need the old</span>
</span><span id="forceSolve-405"><a href="#forceSolve-405"><span class="linenos"> 405</span></a>    <span class="c1"># values to cast properly. 1. is actually contained in here as well, because</span>
</span><span id="forceSolve-406"><a href="#forceSolve-406"><span class="linenos"> 406</span></a>    <span class="c1"># we can just check to see if that variable was explicitly passed before overwriting it.</span>
</span><span id="forceSolve-407"><a href="#forceSolve-407"><span class="linenos"> 407</span></a>
</span><span id="forceSolve-408"><a href="#forceSolve-408"><span class="linenos"> 408</span></a>    <span class="c1"># 1. The kwargs that are explicitly passed</span>
</span><span id="forceSolve-409"><a href="#forceSolve-409"><span class="linenos"> 409</span></a>    <span class="c1"># This one is a little tricky, because there isn&#39;t a super great way by default</span>
</span><span id="forceSolve-410"><a href="#forceSolve-410"><span class="linenos"> 410</span></a>    <span class="c1"># to differentiate whether a kwarg is explicitly passed or is its default value</span>
</span><span id="forceSolve-411"><a href="#forceSolve-411"><span class="linenos"> 411</span></a>    <span class="c1"># (without just keeping a list of default values). I also don&#39;t want to</span>
</span><span id="forceSolve-412"><a href="#forceSolve-412"><span class="linenos"> 412</span></a>    <span class="c1"># replace the entire function signature with (*args, **kwargs) because then the</span>
</span><span id="forceSolve-413"><a href="#forceSolve-413"><span class="linenos"> 413</span></a>    <span class="c1"># documentation would not be as good (I think). So the solution here is to define</span>
</span><span id="forceSolve-414"><a href="#forceSolve-414"><span class="linenos"> 414</span></a>    <span class="c1"># a decorator that has the (*args, **kwargs) signature, and to create an attribute</span>
</span><span id="forceSolve-415"><a href="#forceSolve-415"><span class="linenos"> 415</span></a>    <span class="c1"># of this method that is a list of the kwargs that are explicitly passed to the</span>
</span><span id="forceSolve-416"><a href="#forceSolve-416"><span class="linenos"> 416</span></a>    <span class="c1"># decorator. See `pepe.utils.explicitKwargs()` for more info.</span>
</span><span id="forceSolve-417"><a href="#forceSolve-417"><span class="linenos"> 417</span></a>    <span class="k">if</span> <span class="n">inputSettingsFile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-418"><a href="#forceSolve-418"><span class="linenos"> 418</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">inputSettingsFile</span><span class="p">):</span>
</span><span id="forceSolve-419"><a href="#forceSolve-419"><span class="linenos"> 419</span></a>            <span class="n">fileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">inputSettingsFile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span><span id="forceSolve-420"><a href="#forceSolve-420"><span class="linenos"> 420</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileObj</span><span class="p">:</span>
</span><span id="forceSolve-421"><a href="#forceSolve-421"><span class="linenos"> 421</span></a>                <span class="c1"># Check each line and see if it looks like a dictionary value</span>
</span><span id="forceSolve-422"><a href="#forceSolve-422"><span class="linenos"> 422</span></a>                <span class="n">split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="forceSolve-423"><a href="#forceSolve-423"><span class="linenos"> 423</span></a>                <span class="c1"># Read settings into the master settings file</span>
</span><span id="forceSolve-424"><a href="#forceSolve-424"><span class="linenos"> 424</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">argDTypes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">forceSolve</span><span class="o">.</span><span class="n">explicit_kwargs</span><span class="p">:</span>
</span><span id="forceSolve-425"><a href="#forceSolve-425"><span class="linenos"> 425</span></a>                    <span class="c1"># Cast to the type of the value already in the dict</span>
</span><span id="forceSolve-426"><a href="#forceSolve-426"><span class="linenos"> 426</span></a>                    <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
</span><span id="forceSolve-427"><a href="#forceSolve-427"><span class="linenos"> 427</span></a>                        <span class="n">settings</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="forceSolve-428"><a href="#forceSolve-428"><span class="linenos"> 428</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-429"><a href="#forceSolve-429"><span class="linenos"> 429</span></a>                        <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="forceSolve-430"><a href="#forceSolve-430"><span class="linenos"> 430</span></a>                            <span class="n">settings</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">parseList</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">argDTypes</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()])</span>
</span><span id="forceSolve-431"><a href="#forceSolve-431"><span class="linenos"> 431</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-432"><a href="#forceSolve-432"><span class="linenos"> 432</span></a>                            <span class="c1"># Bools need a special condition</span>
</span><span id="forceSolve-433"><a href="#forceSolve-433"><span class="linenos"> 433</span></a>                            <span class="k">if</span> <span class="n">argDTypes</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="forceSolve-434"><a href="#forceSolve-434"><span class="linenos"> 434</span></a>                                <span class="n">val</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span>
</span><span id="forceSolve-435"><a href="#forceSolve-435"><span class="linenos"> 435</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-436"><a href="#forceSolve-436"><span class="linenos"> 436</span></a>                                <span class="n">val</span> <span class="o">=</span> <span class="n">argDTypes</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()](</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="forceSolve-437"><a href="#forceSolve-437"><span class="linenos"> 437</span></a>
</span><span id="forceSolve-438"><a href="#forceSolve-438"><span class="linenos"> 438</span></a>                            <span class="n">settings</span><span class="p">[</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">val</span>
</span><span id="forceSolve-439"><a href="#forceSolve-439"><span class="linenos"> 439</span></a>
</span><span id="forceSolve-440"><a href="#forceSolve-440"><span class="linenos"> 440</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-441"><a href="#forceSolve-441"><span class="linenos"> 441</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: provided settings file does not exist! Attempting to run regardless...&#39;</span><span class="p">)</span>
</span><span id="forceSolve-442"><a href="#forceSolve-442"><span class="linenos"> 442</span></a>
</span><span id="forceSolve-443"><a href="#forceSolve-443"><span class="linenos"> 443</span></a>    <span class="c1"># While the following variables all have a default value of 0, they cannot actually</span>
</span><span id="forceSolve-444"><a href="#forceSolve-444"><span class="linenos"> 444</span></a>    <span class="c1"># be left as this value. The reason they have a default value is so that if these</span>
</span><span id="forceSolve-445"><a href="#forceSolve-445"><span class="linenos"> 445</span></a>    <span class="c1"># values are indicated by a settings file, we don&#39;t want to have to enter them again.</span>
</span><span id="forceSolve-446"><a href="#forceSolve-446"><span class="linenos"> 446</span></a>    <span class="c1"># So here, we make sure we have values for them all, either explicitly passed or read in.</span>
</span><span id="forceSolve-447"><a href="#forceSolve-447"><span class="linenos"> 447</span></a>    <span class="n">requiredVars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">,</span> <span class="s2">&quot;fSigma&quot;</span><span class="p">,</span> <span class="s2">&quot;pxPerMeter&quot;</span><span class="p">]</span>
</span><span id="forceSolve-448"><a href="#forceSolve-448"><span class="linenos"> 448</span></a>    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requiredVars</span><span class="p">:</span>
</span><span id="forceSolve-449"><a href="#forceSolve-449"><span class="linenos"> 449</span></a>        <span class="k">assert</span> <span class="n">settings</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1"> value not supplied explicitly or implicitly!&#39;</span>
</span><span id="forceSolve-450"><a href="#forceSolve-450"><span class="linenos"> 450</span></a>
</span><span id="forceSolve-451"><a href="#forceSolve-451"><span class="linenos"> 451</span></a>    <span class="c1"># Now carry over the kwargs that are sent to the optimization procedure into that</span>
</span><span id="forceSolve-452"><a href="#forceSolve-452"><span class="linenos"> 452</span></a>    <span class="c1"># dictionary. We can find the names of arguments by using the `inspect` library</span>
</span><span id="forceSolve-453"><a href="#forceSolve-453"><span class="linenos"> 453</span></a>    <span class="n">possibleOptimKwargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">forceOptimize</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="forceSolve-454"><a href="#forceSolve-454"><span class="linenos"> 454</span></a>    <span class="k">for</span> <span class="n">pkw</span> <span class="ow">in</span> <span class="n">possibleOptimKwargs</span><span class="p">:</span>
</span><span id="forceSolve-455"><a href="#forceSolve-455"><span class="linenos"> 455</span></a>        <span class="k">if</span> <span class="n">pkw</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="forceSolve-456"><a href="#forceSolve-456"><span class="linenos"> 456</span></a>            <span class="n">optimizationKwargs</span><span class="p">[</span><span class="n">pkw</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">pkw</span><span class="p">]</span>
</span><span id="forceSolve-457"><a href="#forceSolve-457"><span class="linenos"> 457</span></a>
</span><span id="forceSolve-458"><a href="#forceSolve-458"><span class="linenos"> 458</span></a>    <span class="c1"># We want to do the same thing for the circle tracking function, but we don&#39;t</span>
</span><span id="forceSolve-459"><a href="#forceSolve-459"><span class="linenos"> 459</span></a>    <span class="c1"># yet know which circle tracking function we are using yet, so we&#39;ll carry</span>
</span><span id="forceSolve-460"><a href="#forceSolve-460"><span class="linenos"> 460</span></a>    <span class="c1"># that over a bit later.</span>
</span><span id="forceSolve-461"><a href="#forceSolve-461"><span class="linenos"> 461</span></a>
</span><span id="forceSolve-462"><a href="#forceSolve-462"><span class="linenos"> 462</span></a>    <span class="c1"># Find all images in the directory</span>
</span><span id="forceSolve-463"><a href="#forceSolve-463"><span class="linenos"> 463</span></a>    <span class="n">imageFiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">])</span>
</span><span id="forceSolve-464"><a href="#forceSolve-464"><span class="linenos"> 464</span></a>
</span><span id="forceSolve-465"><a href="#forceSolve-465"><span class="linenos"> 465</span></a>    <span class="c1"># This goes before the sorting/extension filtering so we can get more specific</span>
</span><span id="forceSolve-466"><a href="#forceSolve-466"><span class="linenos"> 466</span></a>    <span class="c1"># error messages (and we have another one of these below)</span>
</span><span id="forceSolve-467"><a href="#forceSolve-467"><span class="linenos"> 467</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="forceSolve-468"><a href="#forceSolve-468"><span class="linenos"> 468</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: directory </span><span class="si">{</span><span class="n">imageDirectory</span><span class="si">}</span><span class="s1"> contains no files!&#39;</span><span class="p">)</span>
</span><span id="forceSolve-469"><a href="#forceSolve-469"><span class="linenos"> 469</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="forceSolve-470"><a href="#forceSolve-470"><span class="linenos"> 470</span></a>
</span><span id="forceSolve-471"><a href="#forceSolve-471"><span class="linenos"> 471</span></a>    <span class="n">imageFiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="n">img</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imageFiles</span> <span class="k">if</span> <span class="n">img</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageExtension&quot;</span><span class="p">]):]</span> <span class="o">==</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageExtension&quot;</span><span class="p">]])</span>
</span><span id="forceSolve-472"><a href="#forceSolve-472"><span class="linenos"> 472</span></a>
</span><span id="forceSolve-473"><a href="#forceSolve-473"><span class="linenos"> 473</span></a>    <span class="c1"># DEBUG:</span>
</span><span id="forceSolve-474"><a href="#forceSolve-474"><span class="linenos"> 474</span></a>    <span class="c1">#imageFiles = imageFiles[::-1]</span>
</span><span id="forceSolve-475"><a href="#forceSolve-475"><span class="linenos"> 475</span></a>
</span><span id="forceSolve-476"><a href="#forceSolve-476"><span class="linenos"> 476</span></a>    <span class="c1"># We have to do the end index first, so it doesn&#39;t mess up the start one</span>
</span><span id="forceSolve-477"><a href="#forceSolve-477"><span class="linenos"> 477</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageEndIndex&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-478"><a href="#forceSolve-478"><span class="linenos"> 478</span></a>        <span class="n">imageFiles</span> <span class="o">=</span> <span class="n">imageFiles</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageEndIndex&quot;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))]</span>
</span><span id="forceSolve-479"><a href="#forceSolve-479"><span class="linenos"> 479</span></a>
</span><span id="forceSolve-480"><a href="#forceSolve-480"><span class="linenos"> 480</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageStartIndex&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-481"><a href="#forceSolve-481"><span class="linenos"> 481</span></a>        <span class="n">imageFiles</span> <span class="o">=</span> <span class="n">imageFiles</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageStartIndex&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">):]</span>
</span><span id="forceSolve-482"><a href="#forceSolve-482"><span class="linenos"> 482</span></a>
</span><span id="forceSolve-483"><a href="#forceSolve-483"><span class="linenos"> 483</span></a>    <span class="c1"># Make sure we still have some proper images</span>
</span><span id="forceSolve-484"><a href="#forceSolve-484"><span class="linenos"> 484</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="forceSolve-485"><a href="#forceSolve-485"><span class="linenos"> 485</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: directory </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1"> contains no files with extension </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageExtension&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1">!&#39;</span><span class="p">)</span>
</span><span id="forceSolve-486"><a href="#forceSolve-486"><span class="linenos"> 486</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="forceSolve-487"><a href="#forceSolve-487"><span class="linenos"> 487</span></a>
</span><span id="forceSolve-488"><a href="#forceSolve-488"><span class="linenos"> 488</span></a>    <span class="n">xB</span> <span class="o">=</span> <span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;cropXMin&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;cropXMax&quot;</span><span class="p">]]</span>
</span><span id="forceSolve-489"><a href="#forceSolve-489"><span class="linenos"> 489</span></a>
</span><span id="forceSolve-490"><a href="#forceSolve-490"><span class="linenos"> 490</span></a>    <span class="n">imageSize</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">imageFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</span><span id="forceSolve-491"><a href="#forceSolve-491"><span class="linenos"> 491</span></a>
</span><span id="forceSolve-492"><a href="#forceSolve-492"><span class="linenos"> 492</span></a>    <span class="c1"># This will calculation the light correction across the images </span>
</span><span id="forceSolve-493"><a href="#forceSolve-493"><span class="linenos"> 493</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-494"><a href="#forceSolve-494"><span class="linenos"> 494</span></a>        <span class="c1"># Convert to absolute paths if they are paths</span>
</span><span id="forceSolve-495"><a href="#forceSolve-495"><span class="linenos"> 495</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="forceSolve-496"><a href="#forceSolve-496"><span class="linenos"> 496</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">])</span>
</span><span id="forceSolve-497"><a href="#forceSolve-497"><span class="linenos"> 497</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="forceSolve-498"><a href="#forceSolve-498"><span class="linenos"> 498</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">])</span>
</span><span id="forceSolve-499"><a href="#forceSolve-499"><span class="linenos"> 499</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="forceSolve-500"><a href="#forceSolve-500"><span class="linenos"> 500</span></a>            <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">])</span>
</span><span id="forceSolve-501"><a href="#forceSolve-501"><span class="linenos"> 501</span></a>            
</span><span id="forceSolve-502"><a href="#forceSolve-502"><span class="linenos"> 502</span></a>        <span class="n">cImageProper</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionImage&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="forceSolve-503"><a href="#forceSolve-503"><span class="linenos"> 503</span></a>        <span class="n">vMask</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionVerticalMask&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="forceSolve-504"><a href="#forceSolve-504"><span class="linenos"> 504</span></a>        <span class="n">hMask</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;lightCorrectionHorizontalMask&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="forceSolve-505"><a href="#forceSolve-505"><span class="linenos"> 505</span></a>
</span><span id="forceSolve-506"><a href="#forceSolve-506"><span class="linenos"> 506</span></a>        <span class="k">if</span> <span class="n">vMask</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="forceSolve-507"><a href="#forceSolve-507"><span class="linenos"> 507</span></a>            <span class="n">vMask</span> <span class="o">=</span> <span class="n">vMask</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="forceSolve-508"><a href="#forceSolve-508"><span class="linenos"> 508</span></a>        <span class="k">if</span> <span class="n">hMask</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="forceSolve-509"><a href="#forceSolve-509"><span class="linenos"> 509</span></a>            <span class="n">hMask</span> <span class="o">=</span> <span class="n">hMask</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="forceSolve-510"><a href="#forceSolve-510"><span class="linenos"> 510</span></a>        <span class="n">lightCorrection</span> <span class="o">=</span> <span class="n">lightCorrectionDiff</span><span class="p">(</span><span class="n">cImageProper</span><span class="p">,</span> <span class="n">vMask</span><span class="p">,</span> <span class="n">hMask</span><span class="p">)</span>
</span><span id="forceSolve-511"><a href="#forceSolve-511"><span class="linenos"> 511</span></a>        
</span><span id="forceSolve-512"><a href="#forceSolve-512"><span class="linenos"> 512</span></a>        <span class="n">trackCorrection</span> <span class="o">=</span> <span class="n">lightCorrection</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span>
</span><span id="forceSolve-513"><a href="#forceSolve-513"><span class="linenos"> 513</span></a>        <span class="n">peCorrection</span> <span class="o">=</span> <span class="n">lightCorrection</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">]]</span>
</span><span id="forceSolve-514"><a href="#forceSolve-514"><span class="linenos"> 514</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-515"><a href="#forceSolve-515"><span class="linenos"> 515</span></a>        <span class="c1"># It probably isn&#39;t great hygiene to have this variableflip between a single</span>
</span><span id="forceSolve-516"><a href="#forceSolve-516"><span class="linenos"> 516</span></a>        <span class="c1"># value and an array, but you can always add a scalar to a numpy array, so</span>
</span><span id="forceSolve-517"><a href="#forceSolve-517"><span class="linenos"> 517</span></a>        <span class="c1"># this is the easiest way (since we haven&#39;t loaded any images yet)</span>
</span><span id="forceSolve-518"><a href="#forceSolve-518"><span class="linenos"> 518</span></a>        <span class="n">trackCorrection</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="forceSolve-519"><a href="#forceSolve-519"><span class="linenos"> 519</span></a>        <span class="n">peCorrection</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="forceSolve-520"><a href="#forceSolve-520"><span class="linenos"> 520</span></a>
</span><span id="forceSolve-521"><a href="#forceSolve-521"><span class="linenos"> 521</span></a>    <span class="c1"># Load up the mask image, which will be used to remove parts of the images</span>
</span><span id="forceSolve-522"><a href="#forceSolve-522"><span class="linenos"> 522</span></a>    <span class="c1"># that we don&#39;t care about, and also potentially indicate which particles</span>
</span><span id="forceSolve-523"><a href="#forceSolve-523"><span class="linenos"> 523</span></a>    <span class="c1"># are close to the boundary.</span>
</span><span id="forceSolve-524"><a href="#forceSolve-524"><span class="linenos"> 524</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;maskImage&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-525"><a href="#forceSolve-525"><span class="linenos"> 525</span></a>        <span class="n">maskArr</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;maskImage&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="forceSolve-526"><a href="#forceSolve-526"><span class="linenos"> 526</span></a>        <span class="n">ignoreBoundary</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="forceSolve-527"><a href="#forceSolve-527"><span class="linenos"> 527</span></a>
</span><span id="forceSolve-528"><a href="#forceSolve-528"><span class="linenos"> 528</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-529"><a href="#forceSolve-529"><span class="linenos"> 529</span></a>        <span class="c1"># Same deal as above: scalar multiplication functions exactly how we want</span>
</span><span id="forceSolve-530"><a href="#forceSolve-530"><span class="linenos"> 530</span></a>        <span class="c1"># in the case that we don&#39;t have a mask, so it&#39;s just easier to do this.</span>
</span><span id="forceSolve-531"><a href="#forceSolve-531"><span class="linenos"> 531</span></a>        <span class="n">maskArr</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="forceSolve-532"><a href="#forceSolve-532"><span class="linenos"> 532</span></a>        <span class="n">ignoreBoundary</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="forceSolve-533"><a href="#forceSolve-533"><span class="linenos"> 533</span></a>
</span><span id="forceSolve-534"><a href="#forceSolve-534"><span class="linenos"> 534</span></a>    <span class="c1"># Which method we will be using to detect circles</span>
</span><span id="forceSolve-535"><a href="#forceSolve-535"><span class="linenos"> 535</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;convolution&#39;</span><span class="p">:</span>
</span><span id="forceSolve-536"><a href="#forceSolve-536"><span class="linenos"> 536</span></a>        <span class="n">circFunc</span> <span class="o">=</span> <span class="n">convCircle</span>
</span><span id="forceSolve-537"><a href="#forceSolve-537"><span class="linenos"> 537</span></a>    <span class="k">elif</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;hough&#39;</span><span class="p">:</span>
</span><span id="forceSolve-538"><a href="#forceSolve-538"><span class="linenos"> 538</span></a>        <span class="n">circFunc</span> <span class="o">=</span> <span class="n">houghCircle</span>
</span><span id="forceSolve-539"><a href="#forceSolve-539"><span class="linenos"> 539</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-540"><a href="#forceSolve-540"><span class="linenos"> 540</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: circle detection option </span><span class="se">\&#39;</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleDetectionMethod&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\&#39;</span><span class="s1"> not recognized!&#39;</span><span class="p">)</span>
</span><span id="forceSolve-541"><a href="#forceSolve-541"><span class="linenos"> 541</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="forceSolve-542"><a href="#forceSolve-542"><span class="linenos"> 542</span></a>
</span><span id="forceSolve-543"><a href="#forceSolve-543"><span class="linenos"> 543</span></a>    <span class="c1"># Now that we have a circle tracking function, we can carry over any possible kwargs</span>
</span><span id="forceSolve-544"><a href="#forceSolve-544"><span class="linenos"> 544</span></a>    <span class="n">possibleCircleKwargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">circFunc</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="forceSolve-545"><a href="#forceSolve-545"><span class="linenos"> 545</span></a>    <span class="k">for</span> <span class="n">pkw</span> <span class="ow">in</span> <span class="n">possibleCircleKwargs</span><span class="p">:</span>
</span><span id="forceSolve-546"><a href="#forceSolve-546"><span class="linenos"> 546</span></a>        <span class="k">if</span> <span class="n">pkw</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="forceSolve-547"><a href="#forceSolve-547"><span class="linenos"> 547</span></a>            <span class="n">circleTrackingKwargs</span><span class="p">[</span><span class="n">pkw</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="n">pkw</span><span class="p">]</span>
</span><span id="forceSolve-548"><a href="#forceSolve-548"><span class="linenos"> 548</span></a>
</span><span id="forceSolve-549"><a href="#forceSolve-549"><span class="linenos"> 549</span></a>    <span class="c1"># Calculate the lowest g2 value that we care about, so we can throw everything</span>
</span><span id="forceSolve-550"><a href="#forceSolve-550"><span class="linenos"> 550</span></a>    <span class="c1"># that is below that away when solving (optional)</span>
</span><span id="forceSolve-551"><a href="#forceSolve-551"><span class="linenos"> 551</span></a>    <span class="n">checkMinG2</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="forceSolve-552"><a href="#forceSolve-552"><span class="linenos"> 552</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;g2CalibrationImage&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-553"><a href="#forceSolve-553"><span class="linenos"> 553</span></a>        <span class="n">g2CalImage</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;g2CalibrationImage&quot;</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="forceSolve-554"><a href="#forceSolve-554"><span class="linenos"> 554</span></a>
</span><span id="forceSolve-555"><a href="#forceSolve-555"><span class="linenos"> 555</span></a>        <span class="n">g2CalPEImage</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticGain&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">g2CalImage</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">peCorrection</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;peBlurKernel&quot;</span><span class="p">],</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;peBlurKernel&quot;</span><span class="p">]))</span>
</span><span id="forceSolve-556"><a href="#forceSolve-556"><span class="linenos"> 556</span></a>        <span class="c1"># Locate particles</span>
</span><span id="forceSolve-557"><a href="#forceSolve-557"><span class="linenos"> 557</span></a>        <span class="n">centers</span><span class="p">,</span> <span class="n">radii</span> <span class="o">=</span> <span class="n">circFunc</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingGain&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">g2CalImage</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">trackCorrection</span><span class="p">)</span> <span class="o">*</span> <span class="n">maskArr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">circleTrackingKwargs</span><span class="p">)</span>
</span><span id="forceSolve-558"><a href="#forceSolve-558"><span class="linenos"> 558</span></a>        <span class="c1"># There should only be 1 particle in the calibration image</span>
</span><span id="forceSolve-559"><a href="#forceSolve-559"><span class="linenos"> 559</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="forceSolve-560"><a href="#forceSolve-560"><span class="linenos"> 560</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Warning: Gradient-squared calibration image does not contain any particles! Ignoring...&#39;</span><span class="p">)</span>
</span><span id="forceSolve-561"><a href="#forceSolve-561"><span class="linenos"> 561</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-562"><a href="#forceSolve-562"><span class="linenos"> 562</span></a>            <span class="n">particleMask</span> <span class="o">=</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">g2CalPEImage</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">centers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="forceSolve-563"><a href="#forceSolve-563"><span class="linenos"> 563</span></a>            <span class="n">gSqr</span> <span class="o">=</span> <span class="n">gSquared</span><span class="p">(</span><span class="n">g2CalPEImage</span><span class="p">)</span>
</span><span id="forceSolve-564"><a href="#forceSolve-564"><span class="linenos"> 564</span></a>            <span class="n">minParticleG2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gSqr</span> <span class="o">*</span> <span class="n">particleMask</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">particleMask</span><span class="p">)</span> <span class="o">*</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;g2CalibrationCutoffFactor&quot;</span><span class="p">]</span>
</span><span id="forceSolve-565"><a href="#forceSolve-565"><span class="linenos"> 565</span></a>            <span class="n">checkMinG2</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="forceSolve-566"><a href="#forceSolve-566"><span class="linenos"> 566</span></a>
</span><span id="forceSolve-567"><a href="#forceSolve-567"><span class="linenos"> 567</span></a>
</span><span id="forceSolve-568"><a href="#forceSolve-568"><span class="linenos"> 568</span></a>    <span class="c1"># The arrays that we will be building for each timestep. It is better to just</span>
</span><span id="forceSolve-569"><a href="#forceSolve-569"><span class="linenos"> 569</span></a>    <span class="c1"># use an untyped list since the arrays are all triangular and whatnot.</span>
</span><span id="forceSolve-570"><a href="#forceSolve-570"><span class="linenos"> 570</span></a>    <span class="n">centersArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-571"><a href="#forceSolve-571"><span class="linenos"> 571</span></a>    <span class="n">radiiArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-572"><a href="#forceSolve-572"><span class="linenos"> 572</span></a>    
</span><span id="forceSolve-573"><a href="#forceSolve-573"><span class="linenos"> 573</span></a>    <span class="n">forceArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-574"><a href="#forceSolve-574"><span class="linenos"> 574</span></a>    <span class="n">betaArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-575"><a href="#forceSolve-575"><span class="linenos"> 575</span></a>    <span class="n">alphaArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-576"><a href="#forceSolve-576"><span class="linenos"> 576</span></a>
</span><span id="forceSolve-577"><a href="#forceSolve-577"><span class="linenos"> 577</span></a>    <span class="n">imageArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-578"><a href="#forceSolve-578"><span class="linenos"> 578</span></a>    <span class="n">errorArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-579"><a href="#forceSolve-579"><span class="linenos"> 579</span></a>
</span><span id="forceSolve-580"><a href="#forceSolve-580"><span class="linenos"> 580</span></a>    <span class="c1"># For keeping track of time (though will only be display if debug=True)</span>
</span><span id="forceSolve-581"><a href="#forceSolve-581"><span class="linenos"> 581</span></a>    <span class="n">trackingTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))</span>
</span><span id="forceSolve-582"><a href="#forceSolve-582"><span class="linenos"> 582</span></a>    <span class="n">initialGuessTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))</span>
</span><span id="forceSolve-583"><a href="#forceSolve-583"><span class="linenos"> 583</span></a>    <span class="n">optimizationTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))</span>
</span><span id="forceSolve-584"><a href="#forceSolve-584"><span class="linenos"> 584</span></a>    <span class="n">miscTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">))</span>
</span><span id="forceSolve-585"><a href="#forceSolve-585"><span class="linenos"> 585</span></a>    <span class="n">totalFailedParticles</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="forceSolve-586"><a href="#forceSolve-586"><span class="linenos"> 586</span></a>
</span><span id="forceSolve-587"><a href="#forceSolve-587"><span class="linenos"> 587</span></a>    <span class="n">errorMsgs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-588"><a href="#forceSolve-588"><span class="linenos"> 588</span></a>
</span><span id="forceSolve-589"><a href="#forceSolve-589"><span class="linenos"> 589</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;showProgressBar&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-590"><a href="#forceSolve-590"><span class="linenos"> 590</span></a>        <span class="n">bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">progressBarOffset</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="n">progressBarTitle</span><span class="p">)</span>
</span><span id="forceSolve-591"><a href="#forceSolve-591"><span class="linenos"> 591</span></a>
</span><span id="forceSolve-592"><a href="#forceSolve-592"><span class="linenos"> 592</span></a>    <span class="c1"># Calculate the gradient-squared-to-force calibration value</span>
</span><span id="forceSolve-593"><a href="#forceSolve-593"><span class="linenos"> 593</span></a>    <span class="n">g2Cal</span> <span class="o">=</span> <span class="n">g2ForceCalibration</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fSigma&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pxPerMeter&quot;</span><span class="p">])</span>
</span><span id="forceSolve-594"><a href="#forceSolve-594"><span class="linenos"> 594</span></a>
</span><span id="forceSolve-595"><a href="#forceSolve-595"><span class="linenos"> 595</span></a>    <span class="c1"># The big loop that iterates over every image</span>
</span><span id="forceSolve-596"><a href="#forceSolve-596"><span class="linenos"> 596</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)):</span>
</span><span id="forceSolve-597"><a href="#forceSolve-597"><span class="linenos"> 597</span></a>
</span><span id="forceSolve-598"><a href="#forceSolve-598"><span class="linenos"> 598</span></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">imageFiles</span><span class="p">[</span><span class="n">i</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="forceSolve-599"><a href="#forceSolve-599"><span class="linenos"> 599</span></a>        <span class="c1"># Convert to floats on the domain [0,1], so we can compare to the output of </span>
</span><span id="forceSolve-600"><a href="#forceSolve-600"><span class="linenos"> 600</span></a>        <span class="c1"># genSyntheticResponse()</span>
</span><span id="forceSolve-601"><a href="#forceSolve-601"><span class="linenos"> 601</span></a>        <span class="n">peImage</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticGain&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">image</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;photoelasticChannel&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">peCorrection</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;peBlurKernel&quot;</span><span class="p">],</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;peBlurKernel&quot;</span><span class="p">]))</span>
</span><span id="forceSolve-602"><a href="#forceSolve-602"><span class="linenos"> 602</span></a>
</span><span id="forceSolve-603"><a href="#forceSolve-603"><span class="linenos"> 603</span></a>        <span class="c1"># -------------</span>
</span><span id="forceSolve-604"><a href="#forceSolve-604"><span class="linenos"> 604</span></a>        <span class="c1"># Track circles</span>
</span><span id="forceSolve-605"><a href="#forceSolve-605"><span class="linenos"> 605</span></a>        <span class="c1"># -------------</span>
</span><span id="forceSolve-606"><a href="#forceSolve-606"><span class="linenos"> 606</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="forceSolve-607"><a href="#forceSolve-607"><span class="linenos"> 607</span></a>        <span class="n">centers</span><span class="p">,</span> <span class="n">radii</span> <span class="o">=</span> <span class="n">circFunc</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingGain&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">image</span><span class="p">[:,:,</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="n">trackCorrection</span><span class="p">)</span> <span class="o">*</span> <span class="n">maskArr</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">circleTrackingKwargs</span><span class="p">)</span>
</span><span id="forceSolve-608"><a href="#forceSolve-608"><span class="linenos"> 608</span></a>
</span><span id="forceSolve-609"><a href="#forceSolve-609"><span class="linenos"> 609</span></a>        <span class="c1"># We do some indexing using the centers/radii, so it is helpful</span>
</span><span id="forceSolve-610"><a href="#forceSolve-610"><span class="linenos"> 610</span></a>        <span class="c1"># to have them as an integer type</span>
</span><span id="forceSolve-611"><a href="#forceSolve-611"><span class="linenos"> 611</span></a>        <span class="c1">#centers = centers.astype(np.int64)</span>
</span><span id="forceSolve-612"><a href="#forceSolve-612"><span class="linenos"> 612</span></a>        <span class="c1">#radii = radii.astype(np.int64)</span>
</span><span id="forceSolve-613"><a href="#forceSolve-613"><span class="linenos"> 613</span></a>
</span><span id="forceSolve-614"><a href="#forceSolve-614"><span class="linenos"> 614</span></a>        <span class="c1"># We want to keep the order of particles constant, so we make sure</span>
</span><span id="forceSolve-615"><a href="#forceSolve-615"><span class="linenos"> 615</span></a>        <span class="c1"># that they are (to whatever extent possible) in the same order</span>
</span><span id="forceSolve-616"><a href="#forceSolve-616"><span class="linenos"> 616</span></a>        <span class="c1"># as the previous frame. This involves finding the closest neighbor</span>
</span><span id="forceSolve-617"><a href="#forceSolve-617"><span class="linenos"> 617</span></a>        <span class="c1"># from the previous frame.</span>
</span><span id="forceSolve-618"><a href="#forceSolve-618"><span class="linenos"> 618</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">centersArr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="forceSolve-619"><a href="#forceSolve-619"><span class="linenos"> 619</span></a>            <span class="n">centerOrder</span> <span class="o">=</span> <span class="n">preserveOrderArgsort</span><span class="p">(</span><span class="n">centersArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">centers</span><span class="p">,</span> <span class="n">padMissingValues</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="forceSolve-620"><a href="#forceSolve-620"><span class="linenos"> 620</span></a>            <span class="n">centers</span> <span class="o">=</span> <span class="n">centers</span><span class="p">[</span><span class="n">centerOrder</span><span class="p">]</span>
</span><span id="forceSolve-621"><a href="#forceSolve-621"><span class="linenos"> 621</span></a>            <span class="n">radii</span> <span class="o">=</span> <span class="n">radii</span><span class="p">[</span><span class="n">centerOrder</span><span class="p">]</span>
</span><span id="forceSolve-622"><a href="#forceSolve-622"><span class="linenos"> 622</span></a>
</span><span id="forceSolve-623"><a href="#forceSolve-623"><span class="linenos"> 623</span></a>        
</span><span id="forceSolve-624"><a href="#forceSolve-624"><span class="linenos"> 624</span></a>        <span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="forceSolve-625"><a href="#forceSolve-625"><span class="linenos"> 625</span></a>
</span><span id="forceSolve-626"><a href="#forceSolve-626"><span class="linenos"> 626</span></a>        <span class="c1"># ----------------------</span>
</span><span id="forceSolve-627"><a href="#forceSolve-627"><span class="linenos"> 627</span></a>        <span class="c1"># Generate initial guess</span>
</span><span id="forceSolve-628"><a href="#forceSolve-628"><span class="linenos"> 628</span></a>        <span class="c1"># ----------------------</span>
</span><span id="forceSolve-629"><a href="#forceSolve-629"><span class="linenos"> 629</span></a>        <span class="c1"># We run the initial guess regardless of whether we are going to overwrite</span>
</span><span id="forceSolve-630"><a href="#forceSolve-630"><span class="linenos"> 630</span></a>        <span class="c1"># with values from the previous frame. This is because the beta values</span>
</span><span id="forceSolve-631"><a href="#forceSolve-631"><span class="linenos"> 631</span></a>        <span class="c1"># are caluclated via the contact network, which should not be carried over</span>
</span><span id="forceSolve-632"><a href="#forceSolve-632"><span class="linenos"> 632</span></a>        <span class="c1"># (since the particles are moving).</span>
</span><span id="forceSolve-633"><a href="#forceSolve-633"><span class="linenos"> 633</span></a>        <span class="n">forceGuessArr</span><span class="p">,</span> <span class="n">alphaGuessArr</span><span class="p">,</span> <span class="n">betaGuessArr</span> <span class="o">=</span> <span class="n">initialForceSolve</span><span class="p">(</span><span class="n">peImage</span><span class="p">,</span>
</span><span id="forceSolve-634"><a href="#forceSolve-634"><span class="linenos"> 634</span></a>                                                    <span class="n">centers</span><span class="p">,</span> <span class="n">radii</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fSigma&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pxPerMeter&quot;</span><span class="p">],</span>
</span><span id="forceSolve-635"><a href="#forceSolve-635"><span class="linenos"> 635</span></a>                                                    <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;contactPadding&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;g2MaskPadding&quot;</span><span class="p">],</span>
</span><span id="forceSolve-636"><a href="#forceSolve-636"><span class="linenos"> 636</span></a>                                                    <span class="n">contactMaskRadius</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;contactMaskRadius&quot;</span><span class="p">],</span>
</span><span id="forceSolve-637"><a href="#forceSolve-637"><span class="linenos"> 637</span></a>                                                    <span class="n">boundaryMask</span><span class="o">=</span><span class="n">maskArr</span><span class="p">,</span> <span class="n">ignoreBoundary</span><span class="o">=</span><span class="n">ignoreBoundary</span><span class="p">,</span> <span class="n">g2Cal</span><span class="o">=</span><span class="n">g2Cal</span><span class="p">)</span>
</span><span id="forceSolve-638"><a href="#forceSolve-638"><span class="linenos"> 638</span></a>
</span><span id="forceSolve-639"><a href="#forceSolve-639"><span class="linenos"> 639</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">centersArr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="forceSolve-640"><a href="#forceSolve-640"><span class="linenos"> 640</span></a>            <span class="c1"># If we have added/lost particles, we want to carry over the previous values where</span>
</span><span id="forceSolve-641"><a href="#forceSolve-641"><span class="linenos"> 641</span></a>            <span class="c1"># possible, and otherwise take the results of initialForceSolve</span>
</span><span id="forceSolve-642"><a href="#forceSolve-642"><span class="linenos"> 642</span></a>
</span><span id="forceSolve-643"><a href="#forceSolve-643"><span class="linenos"> 643</span></a>            <span class="c1"># Note that this is the complement to the center order calculated previously:</span>
</span><span id="forceSolve-644"><a href="#forceSolve-644"><span class="linenos"> 644</span></a>            <span class="c1"># this orders the old centers according the new ones.</span>
</span><span id="forceSolve-645"><a href="#forceSolve-645"><span class="linenos"> 645</span></a>            <span class="c1"># We make the assumption that a particle cannot travel more than it&#39;s radius in a single frame</span>
</span><span id="forceSolve-646"><a href="#forceSolve-646"><span class="linenos"> 646</span></a>            <span class="n">oldCenterOrder</span> <span class="o">=</span> <span class="n">preserveOrderArgsort</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">centersArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">padMissingValues</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxDistance</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">])</span>
</span><span id="forceSolve-647"><a href="#forceSolve-647"><span class="linenos"> 647</span></a>
</span><span id="forceSolve-648"><a href="#forceSolve-648"><span class="linenos"> 648</span></a>            <span class="c1"># Now find each new particle&#39;s old counterpart (if it exists), and then</span>
</span><span id="forceSolve-649"><a href="#forceSolve-649"><span class="linenos"> 649</span></a>            <span class="c1"># line up the forces using the value of beta, such that we can (optionally)</span>
</span><span id="forceSolve-650"><a href="#forceSolve-650"><span class="linenos"> 650</span></a>            <span class="c1"># carry over force magnitudes and alpha values.</span>
</span><span id="forceSolve-651"><a href="#forceSolve-651"><span class="linenos"> 651</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">)):</span>
</span><span id="forceSolve-652"><a href="#forceSolve-652"><span class="linenos"> 652</span></a>                <span class="k">if</span> <span class="n">oldCenterOrder</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-653"><a href="#forceSolve-653"><span class="linenos"> 653</span></a>                    <span class="k">continue</span>
</span><span id="forceSolve-654"><a href="#forceSolve-654"><span class="linenos"> 654</span></a>                    
</span><span id="forceSolve-655"><a href="#forceSolve-655"><span class="linenos"> 655</span></a>                <span class="c1"># maxBetaDisplacement should be an angle value (in radians) that a force would</span>
</span><span id="forceSolve-656"><a href="#forceSolve-656"><span class="linenos"> 656</span></a>                <span class="c1"># never move in a single frame, but is large enough to not lose a force if it</span>
</span><span id="forceSolve-657"><a href="#forceSolve-657"><span class="linenos"> 657</span></a>                <span class="c1"># moves because of noise/small fluctuations.</span>
</span><span id="forceSolve-658"><a href="#forceSolve-658"><span class="linenos"> 658</span></a>                <span class="n">forceOrder</span> <span class="o">=</span> <span class="n">preserveOrderArgsort</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">betaArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">oldCenterOrder</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="n">padMissingValues</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxDistance</span><span class="o">=</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;maxBetaDisplacement&quot;</span><span class="p">])</span>
</span><span id="forceSolve-659"><a href="#forceSolve-659"><span class="linenos"> 659</span></a>
</span><span id="forceSolve-660"><a href="#forceSolve-660"><span class="linenos"> 660</span></a>                <span class="c1">#print(f&#39;frame {i}, particle {j}: {forceOrder}&#39;)</span>
</span><span id="forceSolve-661"><a href="#forceSolve-661"><span class="linenos"> 661</span></a>
</span><span id="forceSolve-662"><a href="#forceSolve-662"><span class="linenos"> 662</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forceGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
</span><span id="forceSolve-663"><a href="#forceSolve-663"><span class="linenos"> 663</span></a>                    <span class="k">if</span> <span class="n">forceOrder</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-664"><a href="#forceSolve-664"><span class="linenos"> 664</span></a>                        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;carryOverForce&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-665"><a href="#forceSolve-665"><span class="linenos"> 665</span></a>                            <span class="n">forceGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">forceArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">oldCenterOrder</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="n">forceOrder</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
</span><span id="forceSolve-666"><a href="#forceSolve-666"><span class="linenos"> 666</span></a>                        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;carryOverAlpha&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-667"><a href="#forceSolve-667"><span class="linenos"> 667</span></a>                            <span class="n">alphaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">alphaArr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">oldCenterOrder</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="n">forceOrder</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
</span><span id="forceSolve-668"><a href="#forceSolve-668"><span class="linenos"> 668</span></a>
</span><span id="forceSolve-669"><a href="#forceSolve-669"><span class="linenos"> 669</span></a>
</span><span id="forceSolve-670"><a href="#forceSolve-670"><span class="linenos"> 670</span></a>            <span class="c1"># In this case, we want to add a small randomly generated contribution</span>
</span><span id="forceSolve-671"><a href="#forceSolve-671"><span class="linenos"> 671</span></a>            <span class="c1"># so that the algorithm doesn&#39;t get stuck in some incorrect loop and so that it</span>
</span><span id="forceSolve-672"><a href="#forceSolve-672"><span class="linenos"> 672</span></a>            <span class="c1"># explores a little more of the parameter space to find a nice minimum at each step</span>
</span><span id="forceSolve-673"><a href="#forceSolve-673"><span class="linenos"> 673</span></a>            <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;forceNoiseWidth&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-674"><a href="#forceSolve-674"><span class="linenos"> 674</span></a>                <span class="n">forceGuessArr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;forceNoiseWidth&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">forceGuessArr</span><span class="p">]</span>
</span><span id="forceSolve-675"><a href="#forceSolve-675"><span class="linenos"> 675</span></a>            <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;alphaNoiseWidth&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="forceSolve-676"><a href="#forceSolve-676"><span class="linenos"> 676</span></a>                <span class="n">alphaGuessArr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;alphaNoiseWidth&quot;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alphaGuessArr</span><span class="p">]</span>
</span><span id="forceSolve-677"><a href="#forceSolve-677"><span class="linenos"> 677</span></a>
</span><span id="forceSolve-678"><a href="#forceSolve-678"><span class="linenos"> 678</span></a>
</span><span id="forceSolve-679"><a href="#forceSolve-679"><span class="linenos"> 679</span></a>        <span class="n">initialGuessTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="forceSolve-680"><a href="#forceSolve-680"><span class="linenos"> 680</span></a>
</span><span id="forceSolve-681"><a href="#forceSolve-681"><span class="linenos"> 681</span></a>        <span class="c1"># -------------------------------</span>
</span><span id="forceSolve-682"><a href="#forceSolve-682"><span class="linenos"> 682</span></a>        <span class="c1"># Optimize each particle&#39;s forces</span>
</span><span id="forceSolve-683"><a href="#forceSolve-683"><span class="linenos"> 683</span></a>        <span class="c1"># -------------------------------</span>
</span><span id="forceSolve-684"><a href="#forceSolve-684"><span class="linenos"> 684</span></a>        <span class="n">optimizedForceArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-685"><a href="#forceSolve-685"><span class="linenos"> 685</span></a>        <span class="n">optimizedBetaArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-686"><a href="#forceSolve-686"><span class="linenos"> 686</span></a>        <span class="n">optimizedAlphaArr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="forceSolve-687"><a href="#forceSolve-687"><span class="linenos"> 687</span></a>        <span class="n">failed</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">))]</span>
</span><span id="forceSolve-688"><a href="#forceSolve-688"><span class="linenos"> 688</span></a>
</span><span id="forceSolve-689"><a href="#forceSolve-689"><span class="linenos"> 689</span></a>        <span class="c1"># Drop forces on any particles whose g2 is lower than the min value</span>
</span><span id="forceSolve-690"><a href="#forceSolve-690"><span class="linenos"> 690</span></a>        <span class="n">skipParticles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">))]</span>
</span><span id="forceSolve-691"><a href="#forceSolve-691"><span class="linenos"> 691</span></a>        <span class="k">if</span> <span class="n">checkMinG2</span><span class="p">:</span>
</span><span id="forceSolve-692"><a href="#forceSolve-692"><span class="linenos"> 692</span></a>            <span class="n">gSqr</span> <span class="o">=</span> <span class="n">gSquared</span><span class="p">(</span><span class="n">peImage</span><span class="p">)</span>
</span><span id="forceSolve-693"><a href="#forceSolve-693"><span class="linenos"> 693</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="forceSolve-694"><a href="#forceSolve-694"><span class="linenos"> 694</span></a>                <span class="n">cMask</span> <span class="o">=</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">peImage</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="forceSolve-695"><a href="#forceSolve-695"><span class="linenos"> 695</span></a>                <span class="n">avgG2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gSqr</span> <span class="o">*</span> <span class="n">cMask</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cMask</span><span class="p">)</span>
</span><span id="forceSolve-696"><a href="#forceSolve-696"><span class="linenos"> 696</span></a>                <span class="n">skipParticles</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">avgG2</span> <span class="o">&lt;</span> <span class="n">minParticleG2</span>
</span><span id="forceSolve-697"><a href="#forceSolve-697"><span class="linenos"> 697</span></a>
</span><span id="forceSolve-698"><a href="#forceSolve-698"><span class="linenos"> 698</span></a>        <span class="c1"># Mostly just a debug option, so we can test particle tracking</span>
</span><span id="forceSolve-699"><a href="#forceSolve-699"><span class="linenos"> 699</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;performOptimization&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-700"><a href="#forceSolve-700"><span class="linenos"> 700</span></a>            <span class="n">optimizedForceArr</span> <span class="o">=</span> <span class="n">forceGuessArr</span>
</span><span id="forceSolve-701"><a href="#forceSolve-701"><span class="linenos"> 701</span></a>            <span class="n">optimizedAlphaArr</span> <span class="o">=</span> <span class="n">alphaGuessArr</span>
</span><span id="forceSolve-702"><a href="#forceSolve-702"><span class="linenos"> 702</span></a>            <span class="n">optimizedBetaArr</span> <span class="o">=</span> <span class="n">betaGuessArr</span>
</span><span id="forceSolve-703"><a href="#forceSolve-703"><span class="linenos"> 703</span></a>
</span><span id="forceSolve-704"><a href="#forceSolve-704"><span class="linenos"> 704</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-705"><a href="#forceSolve-705"><span class="linenos"> 705</span></a>            <span class="c1"># This is what should run the majority of the time</span>
</span><span id="forceSolve-706"><a href="#forceSolve-706"><span class="linenos"> 706</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="forceSolve-707"><a href="#forceSolve-707"><span class="linenos"> 707</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">skipParticles</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
</span><span id="forceSolve-708"><a href="#forceSolve-708"><span class="linenos"> 708</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="forceSolve-709"><a href="#forceSolve-709"><span class="linenos"> 709</span></a>                        <span class="c1"># We don&#39;t need to pass fSigma, pxPerMeter, or brightfield to the method</span>
</span><span id="forceSolve-710"><a href="#forceSolve-710"><span class="linenos"> 710</span></a>                        <span class="c1"># because they will get added to optimizationKwargs automatically.</span>
</span><span id="forceSolve-711"><a href="#forceSolve-711"><span class="linenos"> 711</span></a>                        <span class="n">optForceArr</span><span class="p">,</span> <span class="n">optBetaArr</span><span class="p">,</span> <span class="n">optAlphaArr</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">forceOptimize</span><span class="p">(</span><span class="n">forceGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">alphaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">peImage</span><span class="p">,</span>
</span><span id="forceSolve-712"><a href="#forceSolve-712"><span class="linenos"> 712</span></a>                                                                                  <span class="c1">#settings[&quot;fSigma&quot;], settings[&quot;pxPerMeter&quot;], settings[&quot;brightfield&quot;],</span>
</span><span id="forceSolve-713"><a href="#forceSolve-713"><span class="linenos"> 713</span></a>                                                                                  <span class="o">**</span><span class="n">optimizationKwargs</span><span class="p">)</span>
</span><span id="forceSolve-714"><a href="#forceSolve-714"><span class="linenos"> 714</span></a>                        <span class="n">optimizedForceArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optForceArr</span><span class="p">)</span>
</span><span id="forceSolve-715"><a href="#forceSolve-715"><span class="linenos"> 715</span></a>                        <span class="n">optimizedBetaArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optBetaArr</span><span class="p">)</span>
</span><span id="forceSolve-716"><a href="#forceSolve-716"><span class="linenos"> 716</span></a>                        <span class="n">optimizedAlphaArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optAlphaArr</span><span class="p">)</span>
</span><span id="forceSolve-717"><a href="#forceSolve-717"><span class="linenos"> 717</span></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span id="forceSolve-718"><a href="#forceSolve-718"><span class="linenos"> 718</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
</span><span id="forceSolve-719"><a href="#forceSolve-719"><span class="linenos"> 719</span></a>                        <span class="n">errorMsgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">imageFiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="forceSolve-720"><a href="#forceSolve-720"><span class="linenos"> 720</span></a>                        <span class="n">failed</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="forceSolve-721"><a href="#forceSolve-721"><span class="linenos"> 721</span></a>                        <span class="n">totalFailedParticles</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="forceSolve-722"><a href="#forceSolve-722"><span class="linenos"> 722</span></a>                        <span class="c1"># Append empty lists (ie say there are no forces) </span>
</span><span id="forceSolve-723"><a href="#forceSolve-723"><span class="linenos"> 723</span></a>                        <span class="c1">#optimizedForceArr.append(forceGuessArr[j])</span>
</span><span id="forceSolve-724"><a href="#forceSolve-724"><span class="linenos"> 724</span></a>                        <span class="c1">#optimizedBetaArr.append(betaGuessArr[j])</span>
</span><span id="forceSolve-725"><a href="#forceSolve-725"><span class="linenos"> 725</span></a>                        <span class="c1">#optimizedAlphaArr.append(alphaGuessArr[j])</span>
</span><span id="forceSolve-726"><a href="#forceSolve-726"><span class="linenos"> 726</span></a>                        <span class="n">optimizedForceArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="forceSolve-727"><a href="#forceSolve-727"><span class="linenos"> 727</span></a>                        <span class="n">optimizedBetaArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="forceSolve-728"><a href="#forceSolve-728"><span class="linenos"> 728</span></a>                        <span class="n">optimizedAlphaArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="forceSolve-729"><a href="#forceSolve-729"><span class="linenos"> 729</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-730"><a href="#forceSolve-730"><span class="linenos"> 730</span></a>                    <span class="n">optimizedForceArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="forceSolve-731"><a href="#forceSolve-731"><span class="linenos"> 731</span></a>                    <span class="n">optimizedBetaArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="forceSolve-732"><a href="#forceSolve-732"><span class="linenos"> 732</span></a>                    <span class="n">optimizedAlphaArr</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="forceSolve-733"><a href="#forceSolve-733"><span class="linenos"> 733</span></a>
</span><span id="forceSolve-734"><a href="#forceSolve-734"><span class="linenos"> 734</span></a>        <span class="c1"># If necessary, impose force balance on all particles</span>
</span><span id="forceSolve-735"><a href="#forceSolve-735"><span class="linenos"> 735</span></a>        <span class="k">if</span> <span class="n">requireForceBalance</span><span class="p">:</span>
</span><span id="forceSolve-736"><a href="#forceSolve-736"><span class="linenos"> 736</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="forceSolve-737"><a href="#forceSolve-737"><span class="linenos"> 737</span></a>                <span class="n">optimizedForceArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">optimizedAlphaArr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">singleParticleForceBalance</span><span class="p">(</span><span class="n">optimizedForceArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">optimizedAlphaArr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">optimizedBetaArr</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="forceSolve-738"><a href="#forceSolve-738"><span class="linenos"> 738</span></a>
</span><span id="forceSolve-739"><a href="#forceSolve-739"><span class="linenos"> 739</span></a>        <span class="n">optimizationTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">initialGuessTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="forceSolve-740"><a href="#forceSolve-740"><span class="linenos"> 740</span></a>
</span><span id="forceSolve-741"><a href="#forceSolve-741"><span class="linenos"> 741</span></a>        <span class="c1"># Save all of our values</span>
</span><span id="forceSolve-742"><a href="#forceSolve-742"><span class="linenos"> 742</span></a>        <span class="n">forceArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizedForceArr</span><span class="p">)</span>
</span><span id="forceSolve-743"><a href="#forceSolve-743"><span class="linenos"> 743</span></a>        <span class="n">betaArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizedBetaArr</span><span class="p">)</span>
</span><span id="forceSolve-744"><a href="#forceSolve-744"><span class="linenos"> 744</span></a>        <span class="n">alphaArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizedAlphaArr</span><span class="p">)</span>
</span><span id="forceSolve-745"><a href="#forceSolve-745"><span class="linenos"> 745</span></a>        <span class="n">centersArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span>
</span><span id="forceSolve-746"><a href="#forceSolve-746"><span class="linenos"> 746</span></a>        <span class="n">radiiArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radii</span><span class="p">)</span>
</span><span id="forceSolve-747"><a href="#forceSolve-747"><span class="linenos"> 747</span></a>
</span><span id="forceSolve-748"><a href="#forceSolve-748"><span class="linenos"> 748</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;saveMovie&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;genFitReport&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-749"><a href="#forceSolve-749"><span class="linenos"> 749</span></a>            <span class="n">estimatedPhotoelasticChannel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">peImage</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>    
</span><span id="forceSolve-750"><a href="#forceSolve-750"><span class="linenos"> 750</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="forceSolve-751"><a href="#forceSolve-751"><span class="linenos"> 751</span></a>                <span class="n">estimatedPhotoelasticChannel</span> <span class="o">+=</span> <span class="n">genSyntheticResponse</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forceGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="forceSolve-752"><a href="#forceSolve-752"><span class="linenos"> 752</span></a>                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">alphaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="forceSolve-753"><a href="#forceSolve-753"><span class="linenos"> 753</span></a>                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="forceSolve-754"><a href="#forceSolve-754"><span class="linenos"> 754</span></a>                                                                     <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fSigma&quot;</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
</span><span id="forceSolve-755"><a href="#forceSolve-755"><span class="linenos"> 755</span></a>                                                                     <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pxPerMeter&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;brightfield&quot;</span><span class="p">],</span> <span class="n">imageSize</span><span class="o">=</span><span class="n">peImage</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="forceSolve-756"><a href="#forceSolve-756"><span class="linenos"> 756</span></a>                                                                     <span class="n">center</span><span class="o">=</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="forceSolve-757"><a href="#forceSolve-757"><span class="linenos"> 757</span></a>            
</span><span id="forceSolve-758"><a href="#forceSolve-758"><span class="linenos"> 758</span></a>            
</span><span id="forceSolve-759"><a href="#forceSolve-759"><span class="linenos"> 759</span></a>
</span><span id="forceSolve-760"><a href="#forceSolve-760"><span class="linenos"> 760</span></a>            <span class="n">optimizedPhotoelasticChannel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">peImage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="forceSolve-761"><a href="#forceSolve-761"><span class="linenos"> 761</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="forceSolve-762"><a href="#forceSolve-762"><span class="linenos"> 762</span></a>                <span class="n">optimizedPhotoelasticChannel</span> <span class="o">+=</span> <span class="n">genSyntheticResponse</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimizedForceArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="forceSolve-763"><a href="#forceSolve-763"><span class="linenos"> 763</span></a>                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimizedAlphaArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="forceSolve-764"><a href="#forceSolve-764"><span class="linenos"> 764</span></a>                                                                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimizedBetaArr</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
</span><span id="forceSolve-765"><a href="#forceSolve-765"><span class="linenos"> 765</span></a>                                                                     <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;fSigma&quot;</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
</span><span id="forceSolve-766"><a href="#forceSolve-766"><span class="linenos"> 766</span></a>                                                                     <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pxPerMeter&quot;</span><span class="p">],</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;brightfield&quot;</span><span class="p">],</span> <span class="n">imageSize</span><span class="o">=</span><span class="n">peImage</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="forceSolve-767"><a href="#forceSolve-767"><span class="linenos"> 767</span></a>                                                                     <span class="n">center</span><span class="o">=</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="forceSolve-768"><a href="#forceSolve-768"><span class="linenos"> 768</span></a>            
</span><span id="forceSolve-769"><a href="#forceSolve-769"><span class="linenos"> 769</span></a>
</span><span id="forceSolve-770"><a href="#forceSolve-770"><span class="linenos"> 770</span></a>            <span class="c1"># Just simple mean-squared error</span>
</span><span id="forceSolve-771"><a href="#forceSolve-771"><span class="linenos"> 771</span></a>            <span class="n">errorArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">optimizedPhotoelasticChannel</span> <span class="o">-</span> <span class="n">peImage</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
</span><span id="forceSolve-772"><a href="#forceSolve-772"><span class="linenos"> 772</span></a>
</span><span id="forceSolve-773"><a href="#forceSolve-773"><span class="linenos"> 773</span></a>            <span class="n">imgArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="o">*</span><span class="n">optimizedPhotoelasticChannel</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="forceSolve-774"><a href="#forceSolve-774"><span class="linenos"> 774</span></a>            
</span><span id="forceSolve-775"><a href="#forceSolve-775"><span class="linenos"> 775</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">optimizedPhotoelasticChannel</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span>
</span><span id="forceSolve-776"><a href="#forceSolve-776"><span class="linenos"> 776</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
</span><span id="forceSolve-777"><a href="#forceSolve-777"><span class="linenos"> 777</span></a>            <span class="n">drawObj</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="forceSolve-778"><a href="#forceSolve-778"><span class="linenos"> 778</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="forceSolve-779"><a href="#forceSolve-779"><span class="linenos"> 779</span></a>                <span class="n">leftUpPoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="forceSolve-780"><a href="#forceSolve-780"><span class="linenos"> 780</span></a>                <span class="n">rightDownPoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="forceSolve-781"><a href="#forceSolve-781"><span class="linenos"> 781</span></a>                <span class="n">twoPointList</span> <span class="o">=</span> <span class="p">[</span><span class="n">leftUpPoint</span><span class="p">,</span> <span class="n">rightDownPoint</span><span class="p">]</span>
</span><span id="forceSolve-782"><a href="#forceSolve-782"><span class="linenos"> 782</span></a>                <span class="n">color</span> <span class="o">=</span>  <span class="s1">&#39;#FF0000&#39;</span> <span class="k">if</span> <span class="n">failed</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;#00AAAA&#39;</span>
</span><span id="forceSolve-783"><a href="#forceSolve-783"><span class="linenos"> 783</span></a>                <span class="n">drawObj</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">twoPointList</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="forceSolve-784"><a href="#forceSolve-784"><span class="linenos"> 784</span></a>
</span><span id="forceSolve-785"><a href="#forceSolve-785"><span class="linenos"> 785</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-786"><a href="#forceSolve-786"><span class="linenos"> 786</span></a>
</span><span id="forceSolve-787"><a href="#forceSolve-787"><span class="linenos"> 787</span></a>            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="forceSolve-788"><a href="#forceSolve-788"><span class="linenos"> 788</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><span id="forceSolve-789"><a href="#forceSolve-789"><span class="linenos"> 789</span></a>            
</span><span id="forceSolve-790"><a href="#forceSolve-790"><span class="linenos"> 790</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">maskArr</span> <span class="o">*</span> <span class="n">image</span><span class="p">)</span>
</span><span id="forceSolve-791"><a href="#forceSolve-791"><span class="linenos"> 791</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Tracked Particles&#39;</span><span class="p">)</span>
</span><span id="forceSolve-792"><a href="#forceSolve-792"><span class="linenos"> 792</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centers</span><span class="p">)):</span>
</span><span id="forceSolve-793"><a href="#forceSolve-793"><span class="linenos"> 793</span></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Detected particles&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;teal&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="forceSolve-794"><a href="#forceSolve-794"><span class="linenos"> 794</span></a>                <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="forceSolve-795"><a href="#forceSolve-795"><span class="linenos"> 795</span></a>                <span class="c1"># Now add contacts</span>
</span><span id="forceSolve-796"><a href="#forceSolve-796"><span class="linenos"> 796</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">])):</span>
</span><span id="forceSolve-797"><a href="#forceSolve-797"><span class="linenos"> 797</span></a>                    <span class="n">contactPoint</span> <span class="o">=</span> <span class="n">centers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">radii</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">betaGuessArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])])</span>
</span><span id="forceSolve-798"><a href="#forceSolve-798"><span class="linenos"> 798</span></a>                    <span class="n">cc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">contactPoint</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="forceSolve-799"><a href="#forceSolve-799"><span class="linenos"> 799</span></a>                    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
</span><span id="forceSolve-800"><a href="#forceSolve-800"><span class="linenos"> 800</span></a>                    
</span><span id="forceSolve-801"><a href="#forceSolve-801"><span class="linenos"> 801</span></a>                <span class="c1"># Now plot past center positions</span>
</span><span id="forceSolve-802"><a href="#forceSolve-802"><span class="linenos"> 802</span></a>                <span class="c1">#for k in range(len(centersArr)):</span>
</span><span id="forceSolve-803"><a href="#forceSolve-803"><span class="linenos"> 803</span></a>                <span class="c1">#    if len(centersArr[k]) &gt;= j:</span>
</span><span id="forceSolve-804"><a href="#forceSolve-804"><span class="linenos"> 804</span></a>                <span class="c1">#        cc = plt.Circle(centersArr[k][j][::-1], 5, color=centerColors[j], fill=True)</span>
</span><span id="forceSolve-805"><a href="#forceSolve-805"><span class="linenos"> 805</span></a>                <span class="c1">#        ax[0].add_artist(cc)</span>
</span><span id="forceSolve-806"><a href="#forceSolve-806"><span class="linenos"> 806</span></a>                    
</span><span id="forceSolve-807"><a href="#forceSolve-807"><span class="linenos"> 807</span></a>
</span><span id="forceSolve-808"><a href="#forceSolve-808"><span class="linenos"> 808</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">estimatedPhotoelasticChannel</span><span class="p">)</span>
</span><span id="forceSolve-809"><a href="#forceSolve-809"><span class="linenos"> 809</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Initial Guess for Optimizer</span><span class="se">\n</span><span class="s1">(known forces)&#39;</span><span class="p">)</span>
</span><span id="forceSolve-810"><a href="#forceSolve-810"><span class="linenos"> 810</span></a>            
</span><span id="forceSolve-811"><a href="#forceSolve-811"><span class="linenos"> 811</span></a>            
</span><span id="forceSolve-812"><a href="#forceSolve-812"><span class="linenos"> 812</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="forceSolve-813"><a href="#forceSolve-813"><span class="linenos"> 813</span></a>            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Optimized Forces</span><span class="se">\n</span><span class="s1">(known forces)&#39;</span><span class="p">)</span>
</span><span id="forceSolve-814"><a href="#forceSolve-814"><span class="linenos"> 814</span></a>            
</span><span id="forceSolve-815"><a href="#forceSolve-815"><span class="linenos"> 815</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="forceSolve-816"><a href="#forceSolve-816"><span class="linenos"> 816</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="forceSolve-817"><a href="#forceSolve-817"><span class="linenos"> 817</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="forceSolve-818"><a href="#forceSolve-818"><span class="linenos"> 818</span></a>
</span><span id="forceSolve-819"><a href="#forceSolve-819"><span class="linenos"> 819</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;saveMovie&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-820"><a href="#forceSolve-820"><span class="linenos"> 820</span></a>            <span class="n">imageArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="forceSolve-821"><a href="#forceSolve-821"><span class="linenos"> 821</span></a>
</span><span id="forceSolve-822"><a href="#forceSolve-822"><span class="linenos"> 822</span></a>        <span class="n">miscTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">optimizationTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">initialGuessTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">start</span> 
</span><span id="forceSolve-823"><a href="#forceSolve-823"><span class="linenos"> 823</span></a>
</span><span id="forceSolve-824"><a href="#forceSolve-824"><span class="linenos"> 824</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]:</span> 
</span><span id="forceSolve-825"><a href="#forceSolve-825"><span class="linenos"> 825</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Took </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">:</span><span class="s1">.5</span><span class="si">}</span><span class="s1">s to solve frame:&#39;</span><span class="p">)</span>
</span><span id="forceSolve-826"><a href="#forceSolve-826"><span class="linenos"> 826</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s2">&quot; &quot;</span><span class="si">}</span><span class="s1">Tracking:         </span><span class="si">{</span><span class="n">trackingTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</span><span id="forceSolve-827"><a href="#forceSolve-827"><span class="linenos"> 827</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s2">&quot; &quot;</span><span class="si">}</span><span class="s1">Initial guess:    </span><span class="si">{</span><span class="n">initialGuessTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</span><span id="forceSolve-828"><a href="#forceSolve-828"><span class="linenos"> 828</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s2">&quot; &quot;</span><span class="si">}</span><span class="s1">Optimization:     </span><span class="si">{</span><span class="n">optimizationTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</span><span id="forceSolve-829"><a href="#forceSolve-829"><span class="linenos"> 829</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">5</span><span class="o">*</span><span class="s2">&quot; &quot;</span><span class="si">}</span><span class="s1">Misc. processes:  </span><span class="si">{</span><span class="n">miscTimes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">.3</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</span><span id="forceSolve-830"><a href="#forceSolve-830"><span class="linenos"> 830</span></a>
</span><span id="forceSolve-831"><a href="#forceSolve-831"><span class="linenos"> 831</span></a>        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;showProgressBar&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-832"><a href="#forceSolve-832"><span class="linenos"> 832</span></a>            <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="forceSolve-833"><a href="#forceSolve-833"><span class="linenos"> 833</span></a>   
</span><span id="forceSolve-834"><a href="#forceSolve-834"><span class="linenos"> 834</span></a>    
</span><span id="forceSolve-835"><a href="#forceSolve-835"><span class="linenos"> 835</span></a>    <span class="c1"># Restructure the arrays to make them more friendly, and to track forces/particles across timesteps</span>
</span><span id="forceSolve-836"><a href="#forceSolve-836"><span class="linenos"> 836</span></a>    <span class="n">rectForceArr</span><span class="p">,</span> <span class="n">rectAlphaArr</span><span class="p">,</span> <span class="n">rectBetaArr</span><span class="p">,</span> <span class="n">rectCenterArr</span><span class="p">,</span> <span class="n">rectRadiusArr</span> <span class="o">=</span> <span class="n">rectangularizeForceArrays</span><span class="p">(</span><span class="n">forceArr</span><span class="p">,</span> <span class="n">alphaArr</span><span class="p">,</span> <span class="n">betaArr</span><span class="p">,</span> <span class="n">centersArr</span><span class="p">,</span> <span class="n">radiiArr</span><span class="p">)</span>
</span><span id="forceSolve-837"><a href="#forceSolve-837"><span class="linenos"> 837</span></a>
</span><span id="forceSolve-838"><a href="#forceSolve-838"><span class="linenos"> 838</span></a>    <span class="c1"># --------------</span>
</span><span id="forceSolve-839"><a href="#forceSolve-839"><span class="linenos"> 839</span></a>    <span class="c1"># Track rotation</span>
</span><span id="forceSolve-840"><a href="#forceSolve-840"><span class="linenos"> 840</span></a>    <span class="c1"># --------------</span>
</span><span id="forceSolve-841"><a href="#forceSolve-841"><span class="linenos"> 841</span></a>    <span class="c1"># We choose to do this after the actual solving because it helps</span>
</span><span id="forceSolve-842"><a href="#forceSolve-842"><span class="linenos"> 842</span></a>    <span class="c1"># to have the rectangular force arrays.</span>
</span><span id="forceSolve-843"><a href="#forceSolve-843"><span class="linenos"> 843</span></a>    <span class="n">padding</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;guessRadius&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span>
</span><span id="forceSolve-844"><a href="#forceSolve-844"><span class="linenos"> 844</span></a>
</span><span id="forceSolve-845"><a href="#forceSolve-845"><span class="linenos"> 845</span></a>    <span class="c1"># First, we generate our reference images, which are the first</span>
</span><span id="forceSolve-846"><a href="#forceSolve-846"><span class="linenos"> 846</span></a>    <span class="c1"># time a particle is completely in frame.</span>
</span><span id="forceSolve-847"><a href="#forceSolve-847"><span class="linenos"> 847</span></a>    <span class="n">refImages</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">)</span>
</span><span id="forceSolve-848"><a href="#forceSolve-848"><span class="linenos"> 848</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">refImages</span><span class="p">)):</span>
</span><span id="forceSolve-849"><a href="#forceSolve-849"><span class="linenos"> 849</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)):</span>
</span><span id="forceSolve-850"><a href="#forceSolve-850"><span class="linenos"> 850</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="forceSolve-851"><a href="#forceSolve-851"><span class="linenos"> 851</span></a>                <span class="c1"># Continue to the next frame if this one is partially offscreen</span>
</span><span id="forceSolve-852"><a href="#forceSolve-852"><span class="linenos"> 852</span></a>                <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">((</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">((</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imageSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="forceSolve-853"><a href="#forceSolve-853"><span class="linenos"> 853</span></a>                    <span class="k">continue</span>
</span><span id="forceSolve-854"><a href="#forceSolve-854"><span class="linenos"> 854</span></a>
</span><span id="forceSolve-855"><a href="#forceSolve-855"><span class="linenos"> 855</span></a>                <span class="c1"># Otherwise, this is a good frame, so we save it</span>
</span><span id="forceSolve-856"><a href="#forceSolve-856"><span class="linenos"> 856</span></a>                <span class="n">refImageFull</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">imageFiles</span><span class="p">[</span><span class="n">j</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span>
</span><span id="forceSolve-857"><a href="#forceSolve-857"><span class="linenos"> 857</span></a>                <span class="n">refImageFull</span> <span class="o">*=</span> <span class="n">circularMask</span><span class="p">(</span><span class="n">refImageFull</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span>
</span><span id="forceSolve-858"><a href="#forceSolve-858"><span class="linenos"> 858</span></a>
</span><span id="forceSolve-859"><a href="#forceSolve-859"><span class="linenos"> 859</span></a>                <span class="n">refImages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">refImageFull</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)]</span>
</span><span id="forceSolve-860"><a href="#forceSolve-860"><span class="linenos"> 860</span></a>                <span class="c1"># And move onto the next particle</span>
</span><span id="forceSolve-861"><a href="#forceSolve-861"><span class="linenos"> 861</span></a>                <span class="k">break</span>
</span><span id="forceSolve-862"><a href="#forceSolve-862"><span class="linenos"> 862</span></a>
</span><span id="forceSolve-863"><a href="#forceSolve-863"><span class="linenos"> 863</span></a>    <span class="c1"># Same shape as the radius array: 1 value for each timestep, for each particle</span>
</span><span id="forceSolve-864"><a href="#forceSolve-864"><span class="linenos"> 864</span></a>    <span class="n">rectAngleArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="forceSolve-865"><a href="#forceSolve-865"><span class="linenos"> 865</span></a>    <span class="c1"># Set all values to be np.nan initially</span>
</span><span id="forceSolve-866"><a href="#forceSolve-866"><span class="linenos"> 866</span></a>    <span class="n">rectAngleArr</span><span class="p">[:,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="forceSolve-867"><a href="#forceSolve-867"><span class="linenos"> 867</span></a>    
</span><span id="forceSolve-868"><a href="#forceSolve-868"><span class="linenos"> 868</span></a>    <span class="c1"># Now we compare that reference particle to each subsequent frame</span>
</span><span id="forceSolve-869"><a href="#forceSolve-869"><span class="linenos"> 869</span></a>    <span class="c1"># (probably not best practice that I&#39;ve switched the indices</span>
</span><span id="forceSolve-870"><a href="#forceSolve-870"><span class="linenos"> 870</span></a>    <span class="c1"># with respect to the previous statements, but :/)</span>
</span><span id="forceSolve-871"><a href="#forceSolve-871"><span class="linenos"> 871</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)):</span>
</span><span id="forceSolve-872"><a href="#forceSolve-872"><span class="linenos"> 872</span></a>        <span class="n">currentImageFull</span> <span class="o">=</span> <span class="n">checkImageType</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">imageFiles</span><span class="p">[</span><span class="n">i</span><span class="p">])[:,</span><span class="n">xB</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;circleTrackingChannel&quot;</span><span class="p">]]</span>
</span><span id="forceSolve-873"><a href="#forceSolve-873"><span class="linenos"> 873</span></a>
</span><span id="forceSolve-874"><a href="#forceSolve-874"><span class="linenos"> 874</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">refImages</span><span class="p">)):</span>
</span><span id="forceSolve-875"><a href="#forceSolve-875"><span class="linenos"> 875</span></a>            <span class="c1"># Make sure we have a reference image, and the particle is in full view</span>
</span><span id="forceSolve-876"><a href="#forceSolve-876"><span class="linenos"> 876</span></a>            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="forceSolve-877"><a href="#forceSolve-877"><span class="linenos"> 877</span></a>                <span class="k">continue</span>
</span><span id="forceSolve-878"><a href="#forceSolve-878"><span class="linenos"> 878</span></a>
</span><span id="forceSolve-879"><a href="#forceSolve-879"><span class="linenos"> 879</span></a>            <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">((</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">((</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">imageSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="forceSolve-880"><a href="#forceSolve-880"><span class="linenos"> 880</span></a>                <span class="k">continue</span>
</span><span id="forceSolve-881"><a href="#forceSolve-881"><span class="linenos"> 881</span></a>
</span><span id="forceSolve-882"><a href="#forceSolve-882"><span class="linenos"> 882</span></a>            <span class="c1"># Crop out around the particle and mask it</span>
</span><span id="forceSolve-883"><a href="#forceSolve-883"><span class="linenos"> 883</span></a>            <span class="n">currImage</span> <span class="o">=</span> <span class="p">(</span><span class="n">circularMask</span><span class="p">(</span><span class="n">currentImageFull</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">currentImageFull</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)]</span>
</span><span id="forceSolve-884"><a href="#forceSolve-884"><span class="linenos"> 884</span></a>           
</span><span id="forceSolve-885"><a href="#forceSolve-885"><span class="linenos"> 885</span></a>            <span class="c1"># Which is the kernel and which is the reference image doesn&#39;t really matter</span>
</span><span id="forceSolve-886"><a href="#forceSolve-886"><span class="linenos"> 886</span></a>            <span class="c1"># (as long as we are consistent)</span>
</span><span id="forceSolve-887"><a href="#forceSolve-887"><span class="linenos"> 887</span></a>            <span class="c1"># We can choose our bounds based on the previous value of the rotation</span>
</span><span id="forceSolve-888"><a href="#forceSolve-888"><span class="linenos"> 888</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rectAngleArr</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="forceSolve-889"><a href="#forceSolve-889"><span class="linenos"> 889</span></a>                <span class="n">rotationBounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">rectAngleArr</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">.1</span><span class="p">,</span> <span class="n">rectAngleArr</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">.1</span><span class="p">)</span>
</span><span id="forceSolve-890"><a href="#forceSolve-890"><span class="linenos"> 890</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-891"><a href="#forceSolve-891"><span class="linenos"> 891</span></a>                <span class="c1"># If either i=0 or the previous rotation value is nan, we should start around 0</span>
</span><span id="forceSolve-892"><a href="#forceSolve-892"><span class="linenos"> 892</span></a>                <span class="c1"># anyway (since we define 0 arbitrarily)</span>
</span><span id="forceSolve-893"><a href="#forceSolve-893"><span class="linenos"> 893</span></a>                <span class="n">rotationBounds</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.2</span><span class="p">)</span>
</span><span id="forceSolve-894"><a href="#forceSolve-894"><span class="linenos"> 894</span></a>
</span><span id="forceSolve-895"><a href="#forceSolve-895"><span class="linenos"> 895</span></a>            <span class="c1"># .003 was chosen based on the data presented in the wiki</span>
</span><span id="forceSolve-896"><a href="#forceSolve-896"><span class="linenos"> 896</span></a>            <span class="c1"># https://github.com/Jfeatherstone/pepe/wiki/Angular-Convolution</span>
</span><span id="forceSolve-897"><a href="#forceSolve-897"><span class="linenos"> 897</span></a>            <span class="n">thetaArr</span><span class="p">,</span> <span class="n">convArr</span> <span class="o">=</span> <span class="n">angularConvolution</span><span class="p">(</span><span class="n">refImages</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">currImage</span><span class="p">,</span> <span class="n">dTheta</span><span class="o">=</span><span class="mf">.003</span><span class="p">,</span> <span class="n">angleBounds</span><span class="o">=</span><span class="n">rotationBounds</span><span class="p">)</span>
</span><span id="forceSolve-898"><a href="#forceSolve-898"><span class="linenos"> 898</span></a>            <span class="n">rectAngleArr</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">thetaArr</span><span class="p">[</span><span class="n">findPeaksMulti</span><span class="p">(</span><span class="n">convArr</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="forceSolve-899"><a href="#forceSolve-899"><span class="linenos"> 899</span></a>
</span><span id="forceSolve-900"><a href="#forceSolve-900"><span class="linenos"> 900</span></a>
</span><span id="forceSolve-901"><a href="#forceSolve-901"><span class="linenos"> 901</span></a>    <span class="c1"># Reuse the name of the folder the images come from as a part of</span>
</span><span id="forceSolve-902"><a href="#forceSolve-902"><span class="linenos"> 902</span></a>    <span class="c1"># the output folder name</span>
</span><span id="forceSolve-903"><a href="#forceSolve-903"><span class="linenos"> 903</span></a>    <span class="c1"># [-2] element for something of form &#39;path/to/final/folder/&#39; will be &#39;folder&#39;</span>
</span><span id="forceSolve-904"><a href="#forceSolve-904"><span class="linenos"> 904</span></a>    <span class="c1"># If we are missing the final /, you have to take just the [-1] element</span>
</span><span id="forceSolve-905"><a href="#forceSolve-905"><span class="linenos"> 905</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
</span><span id="forceSolve-906"><a href="#forceSolve-906"><span class="linenos"> 906</span></a>        <span class="n">outputFolderPath</span> <span class="o">=</span> <span class="n">outputRootFolder</span> <span class="o">+</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_Synthetic</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;outputExtension&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/&#39;</span>
</span><span id="forceSolve-907"><a href="#forceSolve-907"><span class="linenos"> 907</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-908"><a href="#forceSolve-908"><span class="linenos"> 908</span></a>        <span class="n">outputFolderPath</span> <span class="o">=</span> <span class="n">outputRootFolder</span> <span class="o">+</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_Synthetic</span><span class="si">{</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;outputExtension&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">/&#39;</span>
</span><span id="forceSolve-909"><a href="#forceSolve-909"><span class="linenos"> 909</span></a>
</span><span id="forceSolve-910"><a href="#forceSolve-910"><span class="linenos"> 910</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFolderPath</span><span class="p">):</span>
</span><span id="forceSolve-911"><a href="#forceSolve-911"><span class="linenos"> 911</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outputFolderPath</span><span class="p">)</span>
</span><span id="forceSolve-912"><a href="#forceSolve-912"><span class="linenos"> 912</span></a>
</span><span id="forceSolve-913"><a href="#forceSolve-913"><span class="linenos"> 913</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;saveMovie&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-914"><a href="#forceSolve-914"><span class="linenos"> 914</span></a>        <span class="n">imageArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;Synthetic.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">imageArr</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="forceSolve-915"><a href="#forceSolve-915"><span class="linenos"> 915</span></a>
</span><span id="forceSolve-916"><a href="#forceSolve-916"><span class="linenos"> 916</span></a>    <span class="c1"># Write a readme file that contains all of the parameters that the solving used</span>
</span><span id="forceSolve-917"><a href="#forceSolve-917"><span class="linenos"> 917</span></a>    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#####################</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-918"><a href="#forceSolve-918"><span class="linenos"> 918</span></a>             <span class="s1">&#39;#    README FILE    #</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-919"><a href="#forceSolve-919"><span class="linenos"> 919</span></a>             <span class="s1">&#39;#####################</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="forceSolve-920"><a href="#forceSolve-920"><span class="linenos"> 920</span></a>
</span><span id="forceSolve-921"><a href="#forceSolve-921"><span class="linenos"> 921</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Generated: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="forceSolve-922"><a href="#forceSolve-922"><span class="linenos"> 922</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;Note: this file was autogenerated by the `pepe.auto.forceSolve()` function</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-923"><a href="#forceSolve-923"><span class="linenos"> 923</span></a>              <span class="s1">&#39;      and it is not recommended to be manually edited. To reuse the settings</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-924"><a href="#forceSolve-924"><span class="linenos"> 924</span></a>              <span class="s1">&#39;      and parameters that were used here, the path of this file</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-925"><a href="#forceSolve-925"><span class="linenos"> 925</span></a>             <span class="sa">f</span><span class="s1">&#39;      (</span><span class="se">\&#39;</span><span class="si">{</span><span class="n">outputFolderPath</span><span class="si">}</span><span class="s1">readme.txt</span><span class="se">\&#39;</span><span class="s1">) </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-926"><a href="#forceSolve-926"><span class="linenos"> 926</span></a>              <span class="s1">&#39;      can be passed via the </span><span class="se">\&#39;</span><span class="s1">settingsFile</span><span class="se">\&#39;</span><span class="s1"> keyword argument of `pepe.auto.forceSolve()`.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-927"><a href="#forceSolve-927"><span class="linenos"> 927</span></a>              <span class="s1">&#39;      In this case, explictly passed arguments will override the values in the settings file.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="forceSolve-928"><a href="#forceSolve-928"><span class="linenos"> 928</span></a>
</span><span id="forceSolve-929"><a href="#forceSolve-929"><span class="linenos"> 929</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">## Runtime Information</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-930"><a href="#forceSolve-930"><span class="linenos"> 930</span></a>              <span class="sa">f</span><span class="s1">&#39;Version: pepe </span><span class="si">{</span><span class="n">pepe</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-931"><a href="#forceSolve-931"><span class="linenos"> 931</span></a>              <span class="sa">f</span><span class="s1">&#39;Total runtime: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">overallStartTime</span><span class="si">:</span><span class="s1">.6</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-932"><a href="#forceSolve-932"><span class="linenos"> 932</span></a>              <span class="sa">f</span><span class="s1">&#39;Mean tracking time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trackingTimes</span><span class="p">)</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-933"><a href="#forceSolve-933"><span class="linenos"> 933</span></a>              <span class="sa">f</span><span class="s1">&#39;Mean guess generation time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">initialGuessTimes</span><span class="p">)</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-934"><a href="#forceSolve-934"><span class="linenos"> 934</span></a>              <span class="sa">f</span><span class="s1">&#39;Mean optimization time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">optimizationTimes</span><span class="p">)</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-935"><a href="#forceSolve-935"><span class="linenos"> 935</span></a>              <span class="sa">f</span><span class="s1">&#39;Mean misc. time: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">miscTimes</span><span class="p">)</span><span class="si">:</span><span class="s1">.4</span><span class="si">}</span><span class="s1">s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="forceSolve-936"><a href="#forceSolve-936"><span class="linenos"> 936</span></a>              <span class="sa">f</span><span class="s1">&#39;Number of failed particles: </span><span class="si">{</span><span class="n">totalFailedParticles</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="forceSolve-937"><a href="#forceSolve-937"><span class="linenos"> 937</span></a>
</span><span id="forceSolve-938"><a href="#forceSolve-938"><span class="linenos"> 938</span></a>    <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">circleTrackingKwargs</span><span class="p">)</span>
</span><span id="forceSolve-939"><a href="#forceSolve-939"><span class="linenos"> 939</span></a>    <span class="n">settings</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">optimizationKwargs</span><span class="p">)</span>
</span><span id="forceSolve-940"><a href="#forceSolve-940"><span class="linenos"> 940</span></a>
</span><span id="forceSolve-941"><a href="#forceSolve-941"><span class="linenos"> 941</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">## Settings</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="forceSolve-942"><a href="#forceSolve-942"><span class="linenos"> 942</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="forceSolve-943"><a href="#forceSolve-943"><span class="linenos"> 943</span></a>        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="forceSolve-944"><a href="#forceSolve-944"><span class="linenos"> 944</span></a>
</span><span id="forceSolve-945"><a href="#forceSolve-945"><span class="linenos"> 945</span></a>    <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">## Errors</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="forceSolve-946"><a href="#forceSolve-946"><span class="linenos"> 946</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errorMsgs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="forceSolve-947"><a href="#forceSolve-947"><span class="linenos"> 947</span></a>        <span class="n">lines</span> <span class="o">+=</span> <span class="n">errorMsgs</span>
</span><span id="forceSolve-948"><a href="#forceSolve-948"><span class="linenos"> 948</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="forceSolve-949"><a href="#forceSolve-949"><span class="linenos"> 949</span></a>        <span class="n">lines</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;None :)&#39;</span><span class="p">]</span>
</span><span id="forceSolve-950"><a href="#forceSolve-950"><span class="linenos"> 950</span></a>
</span><span id="forceSolve-951"><a href="#forceSolve-951"><span class="linenos"> 951</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;readme.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">readmeFile</span><span class="p">:</span>
</span><span id="forceSolve-952"><a href="#forceSolve-952"><span class="linenos"> 952</span></a>        <span class="n">readmeFile</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="forceSolve-953"><a href="#forceSolve-953"><span class="linenos"> 953</span></a>
</span><span id="forceSolve-954"><a href="#forceSolve-954"><span class="linenos"> 954</span></a>    <span class="c1"># Save the arrays to pickle files (optional)</span>
</span><span id="forceSolve-955"><a href="#forceSolve-955"><span class="linenos"> 955</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;pickleArrays&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-956"><a href="#forceSolve-956"><span class="linenos"> 956</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;forces.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="forceSolve-957"><a href="#forceSolve-957"><span class="linenos"> 957</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectForceArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="forceSolve-958"><a href="#forceSolve-958"><span class="linenos"> 958</span></a>
</span><span id="forceSolve-959"><a href="#forceSolve-959"><span class="linenos"> 959</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;alphas.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="forceSolve-960"><a href="#forceSolve-960"><span class="linenos"> 960</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectAlphaArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="forceSolve-961"><a href="#forceSolve-961"><span class="linenos"> 961</span></a>
</span><span id="forceSolve-962"><a href="#forceSolve-962"><span class="linenos"> 962</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;betas.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="forceSolve-963"><a href="#forceSolve-963"><span class="linenos"> 963</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectBetaArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="forceSolve-964"><a href="#forceSolve-964"><span class="linenos"> 964</span></a>
</span><span id="forceSolve-965"><a href="#forceSolve-965"><span class="linenos"> 965</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;centers.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="forceSolve-966"><a href="#forceSolve-966"><span class="linenos"> 966</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="forceSolve-967"><a href="#forceSolve-967"><span class="linenos"> 967</span></a>
</span><span id="forceSolve-968"><a href="#forceSolve-968"><span class="linenos"> 968</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;radii.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="forceSolve-969"><a href="#forceSolve-969"><span class="linenos"> 969</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="forceSolve-970"><a href="#forceSolve-970"><span class="linenos"> 970</span></a>
</span><span id="forceSolve-971"><a href="#forceSolve-971"><span class="linenos"> 971</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;angles.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="forceSolve-972"><a href="#forceSolve-972"><span class="linenos"> 972</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rectAngleArr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="forceSolve-973"><a href="#forceSolve-973"><span class="linenos"> 973</span></a>
</span><span id="forceSolve-974"><a href="#forceSolve-974"><span class="linenos"> 974</span></a>    <span class="c1"># Save the raw arrays too, since I think I have a bug in my rectangularization process</span>
</span><span id="forceSolve-975"><a href="#forceSolve-975"><span class="linenos"> 975</span></a><span class="c1">#    if settings[&quot;pickleArrays&quot;]:</span>
</span><span id="forceSolve-976"><a href="#forceSolve-976"><span class="linenos"> 976</span></a><span class="c1">#        with open(outputFolderPath + &#39;forces_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="forceSolve-977"><a href="#forceSolve-977"><span class="linenos"> 977</span></a><span class="c1">#            pickle.dump(forceArr, f)</span>
</span><span id="forceSolve-978"><a href="#forceSolve-978"><span class="linenos"> 978</span></a><span class="c1">#</span>
</span><span id="forceSolve-979"><a href="#forceSolve-979"><span class="linenos"> 979</span></a><span class="c1">#        with open(outputFolderPath + &#39;alphas_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="forceSolve-980"><a href="#forceSolve-980"><span class="linenos"> 980</span></a><span class="c1">#            pickle.dump(alphaArr, f)</span>
</span><span id="forceSolve-981"><a href="#forceSolve-981"><span class="linenos"> 981</span></a><span class="c1">#</span>
</span><span id="forceSolve-982"><a href="#forceSolve-982"><span class="linenos"> 982</span></a><span class="c1">#        with open(outputFolderPath + &#39;betas_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="forceSolve-983"><a href="#forceSolve-983"><span class="linenos"> 983</span></a><span class="c1">#            pickle.dump(betaArr, f)</span>
</span><span id="forceSolve-984"><a href="#forceSolve-984"><span class="linenos"> 984</span></a><span class="c1">#</span>
</span><span id="forceSolve-985"><a href="#forceSolve-985"><span class="linenos"> 985</span></a><span class="c1">#        with open(outputFolderPath + &#39;centers_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="forceSolve-986"><a href="#forceSolve-986"><span class="linenos"> 986</span></a><span class="c1">#            pickle.dump(centersArr, f)</span>
</span><span id="forceSolve-987"><a href="#forceSolve-987"><span class="linenos"> 987</span></a><span class="c1">#</span>
</span><span id="forceSolve-988"><a href="#forceSolve-988"><span class="linenos"> 988</span></a><span class="c1">#        with open(outputFolderPath + &#39;radii_raw.pickle&#39;, &#39;wb&#39;) as f:</span>
</span><span id="forceSolve-989"><a href="#forceSolve-989"><span class="linenos"> 989</span></a><span class="c1">#            pickle.dump(radiiArr, f)</span>
</span><span id="forceSolve-990"><a href="#forceSolve-990"><span class="linenos"> 990</span></a>
</span><span id="forceSolve-991"><a href="#forceSolve-991"><span class="linenos"> 991</span></a>    <span class="c1"># Generate a fit report (optional)</span>
</span><span id="forceSolve-992"><a href="#forceSolve-992"><span class="linenos"> 992</span></a>    <span class="c1"># This include informtaion about the error for each frame, all of the forces/alphas/betas/</span>
</span><span id="forceSolve-993"><a href="#forceSolve-993"><span class="linenos"> 993</span></a>    <span class="c1"># centers/radii for each particle at each timestep, and all settings in a nicely compiled</span>
</span><span id="forceSolve-994"><a href="#forceSolve-994"><span class="linenos"> 994</span></a>    <span class="c1"># (via latex) pdf.</span>
</span><span id="forceSolve-995"><a href="#forceSolve-995"><span class="linenos"> 995</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;genFitReport&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-996"><a href="#forceSolve-996"><span class="linenos"> 996</span></a>        <span class="c1"># Make the source directory</span>
</span><span id="forceSolve-997"><a href="#forceSolve-997"><span class="linenos"> 997</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src&#39;</span><span class="p">):</span>
</span><span id="forceSolve-998"><a href="#forceSolve-998"><span class="linenos"> 998</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src&#39;</span><span class="p">)</span>
</span><span id="forceSolve-999"><a href="#forceSolve-999"><span class="linenos"> 999</span></a>
</span><span id="forceSolve-1000"><a href="#forceSolve-1000"><span class="linenos">1000</span></a>        <span class="c1"># First, generate a plot of the error</span>
</span><span id="forceSolve-1001"><a href="#forceSolve-1001"><span class="linenos">1001</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="forceSolve-1002"><a href="#forceSolve-1002"><span class="linenos">1002</span></a>
</span><span id="forceSolve-1003"><a href="#forceSolve-1003"><span class="linenos">1003</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">errorArr</span><span class="p">)</span>
</span><span id="forceSolve-1004"><a href="#forceSolve-1004"><span class="linenos">1004</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frame&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1005"><a href="#forceSolve-1005"><span class="linenos">1005</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mean-squared error&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1006"><a href="#forceSolve-1006"><span class="linenos">1006</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Difference Between Optimized Result and Real Image&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1007"><a href="#forceSolve-1007"><span class="linenos">1007</span></a>
</span><span id="forceSolve-1008"><a href="#forceSolve-1008"><span class="linenos">1008</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/error.pdf&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1009"><a href="#forceSolve-1009"><span class="linenos">1009</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/error.png&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1010"><a href="#forceSolve-1010"><span class="linenos">1010</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="forceSolve-1011"><a href="#forceSolve-1011"><span class="linenos">1011</span></a>
</span><span id="forceSolve-1012"><a href="#forceSolve-1012"><span class="linenos">1012</span></a>        <span class="c1"># Draw all of the circles, with their labeled numbers</span>
</span><span id="forceSolve-1013"><a href="#forceSolve-1013"><span class="linenos">1013</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</span><span id="forceSolve-1014"><a href="#forceSolve-1014"><span class="linenos">1014</span></a>        <span class="c1"># First timestep</span>
</span><span id="forceSolve-1015"><a href="#forceSolve-1015"><span class="linenos">1015</span></a>        <span class="n">visCircles</span><span class="p">([</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">))],</span> <span class="p">[</span><span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">))],</span>
</span><span id="forceSolve-1016"><a href="#forceSolve-1016"><span class="linenos">1016</span></a>                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">annotations</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">)),</span> <span class="n">setBounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</span><span id="forceSolve-1017"><a href="#forceSolve-1017"><span class="linenos">1017</span></a>        <span class="c1"># Last timestep</span>
</span><span id="forceSolve-1018"><a href="#forceSolve-1018"><span class="linenos">1018</span></a>        <span class="n">visCircles</span><span class="p">([</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">))],</span> <span class="p">[</span><span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">))],</span>
</span><span id="forceSolve-1019"><a href="#forceSolve-1019"><span class="linenos">1019</span></a>                   <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">annotations</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">)),</span> <span class="n">setBounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</span><span id="forceSolve-1020"><a href="#forceSolve-1020"><span class="linenos">1020</span></a>
</span><span id="forceSolve-1021"><a href="#forceSolve-1021"><span class="linenos">1021</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="forceSolve-1022"><a href="#forceSolve-1022"><span class="linenos">1022</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X [px]&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1023"><a href="#forceSolve-1023"><span class="linenos">1023</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y [px]&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1024"><a href="#forceSolve-1024"><span class="linenos">1024</span></a>            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="forceSolve-1025"><a href="#forceSolve-1025"><span class="linenos">1025</span></a>
</span><span id="forceSolve-1026"><a href="#forceSolve-1026"><span class="linenos">1026</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;First Frame&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1027"><a href="#forceSolve-1027"><span class="linenos">1027</span></a>        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Last Frame&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1028"><a href="#forceSolve-1028"><span class="linenos">1028</span></a>
</span><span id="forceSolve-1029"><a href="#forceSolve-1029"><span class="linenos">1029</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/particle_identities.pdf&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1030"><a href="#forceSolve-1030"><span class="linenos">1030</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/particle_identities.png&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1031"><a href="#forceSolve-1031"><span class="linenos">1031</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="forceSolve-1032"><a href="#forceSolve-1032"><span class="linenos">1032</span></a>
</span><span id="forceSolve-1033"><a href="#forceSolve-1033"><span class="linenos">1033</span></a>        <span class="c1"># Next, draw the forces/betas/alphas/centers for each particle</span>
</span><span id="forceSolve-1034"><a href="#forceSolve-1034"><span class="linenos">1034</span></a>        <span class="c1"># through time</span>
</span><span id="forceSolve-1035"><a href="#forceSolve-1035"><span class="linenos">1035</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectForceArr</span><span class="p">)):</span>
</span><span id="forceSolve-1036"><a href="#forceSolve-1036"><span class="linenos">1036</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">visForces</span><span class="p">(</span><span class="n">rectForceArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rectAlphaArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rectBetaArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rectCenterArr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rectAngleArr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="forceSolve-1037"><a href="#forceSolve-1037"><span class="linenos">1037</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Particle </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1038"><a href="#forceSolve-1038"><span class="linenos">1038</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;FitReport_src/particle_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_forces.pdf&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1039"><a href="#forceSolve-1039"><span class="linenos">1039</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;FitReport_src/particle_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_forces.png&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1040"><a href="#forceSolve-1040"><span class="linenos">1040</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="forceSolve-1041"><a href="#forceSolve-1041"><span class="linenos">1041</span></a>
</span><span id="forceSolve-1042"><a href="#forceSolve-1042"><span class="linenos">1042</span></a>        <span class="c1"># Create a gif of the particle orientation through time, overlaid</span>
</span><span id="forceSolve-1043"><a href="#forceSolve-1043"><span class="linenos">1043</span></a>        <span class="c1"># on the original images</span>
</span><span id="forceSolve-1044"><a href="#forceSolve-1044"><span class="linenos">1044</span></a>        <span class="n">visRotation</span><span class="p">([</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageDirectory&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">imageFiles</span><span class="p">],</span>
</span><span id="forceSolve-1045"><a href="#forceSolve-1045"><span class="linenos">1045</span></a>                   <span class="n">rectCenterArr</span><span class="p">,</span> <span class="n">rectRadiusArr</span><span class="p">,</span> <span class="n">rectAngleArr</span><span class="p">,</span> <span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cropXMin</span><span class="p">))</span>
</span><span id="forceSolve-1046"><a href="#forceSolve-1046"><span class="linenos">1046</span></a>
</span><span id="forceSolve-1047"><a href="#forceSolve-1047"><span class="linenos">1047</span></a>        <span class="c1"># Create gifs of the contacts</span>
</span><span id="forceSolve-1048"><a href="#forceSolve-1048"><span class="linenos">1048</span></a>        <span class="n">forceColors</span> <span class="o">=</span> <span class="n">genColors</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectBetaArr</span><span class="p">))</span>
</span><span id="forceSolve-1049"><a href="#forceSolve-1049"><span class="linenos">1049</span></a>        <span class="c1"># The list comprehension is to make sure that we index a particle that actually has forces acting</span>
</span><span id="forceSolve-1050"><a href="#forceSolve-1050"><span class="linenos">1050</span></a>        <span class="c1"># on it.</span>
</span><span id="forceSolve-1051"><a href="#forceSolve-1051"><span class="linenos">1051</span></a>        <span class="n">tSteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">imageFiles</span><span class="p">)</span><span class="c1">#len([b for b in rectBetaArr if len(b) &gt; 0][0])</span>
</span><span id="forceSolve-1052"><a href="#forceSolve-1052"><span class="linenos">1052</span></a>        <span class="n">contactPointImages</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tSteps</span><span class="p">)]</span>
</span><span id="forceSolve-1053"><a href="#forceSolve-1053"><span class="linenos">1053</span></a>        <span class="n">contactAngleImages</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tSteps</span><span class="p">)]</span>
</span><span id="forceSolve-1054"><a href="#forceSolve-1054"><span class="linenos">1054</span></a>
</span><span id="forceSolve-1055"><a href="#forceSolve-1055"><span class="linenos">1055</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tSteps</span><span class="p">):</span>
</span><span id="forceSolve-1056"><a href="#forceSolve-1056"><span class="linenos">1056</span></a>            <span class="c1"># Have to do this, because the settings variable could be None </span>
</span><span id="forceSolve-1057"><a href="#forceSolve-1057"><span class="linenos">1057</span></a>            <span class="n">startI</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageStartIndex&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;imageStartIndex&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="forceSolve-1058"><a href="#forceSolve-1058"><span class="linenos">1058</span></a>
</span><span id="forceSolve-1059"><a href="#forceSolve-1059"><span class="linenos">1059</span></a>            <span class="c1"># First, just the contact points</span>
</span><span id="forceSolve-1060"><a href="#forceSolve-1060"><span class="linenos">1060</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="forceSolve-1061"><a href="#forceSolve-1061"><span class="linenos">1061</span></a>            <span class="n">visCircles</span><span class="p">([</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">))],</span> <span class="p">[</span><span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">))],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="forceSolve-1062"><a href="#forceSolve-1062"><span class="linenos">1062</span></a>
</span><span id="forceSolve-1063"><a href="#forceSolve-1063"><span class="linenos">1063</span></a>            <span class="k">for</span> <span class="n">particleIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectBetaArr</span><span class="p">)):</span>
</span><span id="forceSolve-1064"><a href="#forceSolve-1064"><span class="linenos">1064</span></a>                <span class="n">visContacts</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span id="forceSolve-1065"><a href="#forceSolve-1065"><span class="linenos">1065</span></a>                            <span class="n">rectBetaArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">forceColors</span><span class="o">=</span><span class="n">forceColors</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">])</span>
</span><span id="forceSolve-1066"><a href="#forceSolve-1066"><span class="linenos">1066</span></a>
</span><span id="forceSolve-1067"><a href="#forceSolve-1067"><span class="linenos">1067</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1280</span><span class="p">])</span>
</span><span id="forceSolve-1068"><a href="#forceSolve-1068"><span class="linenos">1068</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="forceSolve-1069"><a href="#forceSolve-1069"><span class="linenos">1069</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1070"><a href="#forceSolve-1070"><span class="linenos">1070</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">startI</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1071"><a href="#forceSolve-1071"><span class="linenos">1071</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="forceSolve-1072"><a href="#forceSolve-1072"><span class="linenos">1072</span></a>
</span><span id="forceSolve-1073"><a href="#forceSolve-1073"><span class="linenos">1073</span></a>            <span class="n">canvas</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_current_fig_manager</span><span class="p">()</span><span class="o">.</span><span class="n">canvas</span>
</span><span id="forceSolve-1074"><a href="#forceSolve-1074"><span class="linenos">1074</span></a>            <span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="forceSolve-1075"><a href="#forceSolve-1075"><span class="linenos">1075</span></a>            <span class="n">contactPointImages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">(),</span> 
</span><span id="forceSolve-1076"><a href="#forceSolve-1076"><span class="linenos">1076</span></a>                                        <span class="n">canvas</span><span class="o">.</span><span class="n">tostring_rgb</span><span class="p">())</span>
</span><span id="forceSolve-1077"><a href="#forceSolve-1077"><span class="linenos">1077</span></a>
</span><span id="forceSolve-1078"><a href="#forceSolve-1078"><span class="linenos">1078</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="forceSolve-1079"><a href="#forceSolve-1079"><span class="linenos">1079</span></a>       
</span><span id="forceSolve-1080"><a href="#forceSolve-1080"><span class="linenos">1080</span></a>            <span class="c1"># Now the one with angles</span>
</span><span id="forceSolve-1081"><a href="#forceSolve-1081"><span class="linenos">1081</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
</span><span id="forceSolve-1082"><a href="#forceSolve-1082"><span class="linenos">1082</span></a>            <span class="n">visCircles</span><span class="p">([</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">))],</span> <span class="p">[</span><span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectRadiusArr</span><span class="p">))],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="forceSolve-1083"><a href="#forceSolve-1083"><span class="linenos">1083</span></a>
</span><span id="forceSolve-1084"><a href="#forceSolve-1084"><span class="linenos">1084</span></a>            <span class="k">for</span> <span class="n">particleIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rectBetaArr</span><span class="p">)):</span>
</span><span id="forceSolve-1085"><a href="#forceSolve-1085"><span class="linenos">1085</span></a>                <span class="n">visContacts</span><span class="p">(</span><span class="n">rectCenterArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">rectRadiusArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span id="forceSolve-1086"><a href="#forceSolve-1086"><span class="linenos">1086</span></a>                            <span class="n">rectBetaArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][:,</span><span class="n">i</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">forceColors</span><span class="o">=</span><span class="n">forceColors</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">],</span> <span class="n">alphaArr</span><span class="o">=</span><span class="n">rectAlphaArr</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">][:,</span><span class="n">i</span><span class="p">])</span>
</span><span id="forceSolve-1087"><a href="#forceSolve-1087"><span class="linenos">1087</span></a>                                                
</span><span id="forceSolve-1088"><a href="#forceSolve-1088"><span class="linenos">1088</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1280</span><span class="p">])</span>
</span><span id="forceSolve-1089"><a href="#forceSolve-1089"><span class="linenos">1089</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1024</span><span class="p">])</span>
</span><span id="forceSolve-1090"><a href="#forceSolve-1090"><span class="linenos">1090</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1091"><a href="#forceSolve-1091"><span class="linenos">1091</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">startI</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="forceSolve-1092"><a href="#forceSolve-1092"><span class="linenos">1092</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</span><span id="forceSolve-1093"><a href="#forceSolve-1093"><span class="linenos">1093</span></a>
</span><span id="forceSolve-1094"><a href="#forceSolve-1094"><span class="linenos">1094</span></a>            <span class="n">canvas</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_current_fig_manager</span><span class="p">()</span><span class="o">.</span><span class="n">canvas</span>
</span><span id="forceSolve-1095"><a href="#forceSolve-1095"><span class="linenos">1095</span></a>            <span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="forceSolve-1096"><a href="#forceSolve-1096"><span class="linenos">1096</span></a>            <span class="n">contactAngleImages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">(),</span> 
</span><span id="forceSolve-1097"><a href="#forceSolve-1097"><span class="linenos">1097</span></a>                                        <span class="n">canvas</span><span class="o">.</span><span class="n">tostring_rgb</span><span class="p">())</span>
</span><span id="forceSolve-1098"><a href="#forceSolve-1098"><span class="linenos">1098</span></a>
</span><span id="forceSolve-1099"><a href="#forceSolve-1099"><span class="linenos">1099</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="forceSolve-1100"><a href="#forceSolve-1100"><span class="linenos">1100</span></a>
</span><span id="forceSolve-1101"><a href="#forceSolve-1101"><span class="linenos">1101</span></a>        <span class="n">contactPointImages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/contact_points.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="forceSolve-1102"><a href="#forceSolve-1102"><span class="linenos">1102</span></a>                                   <span class="n">append_images</span><span class="o">=</span><span class="n">contactPointImages</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="forceSolve-1103"><a href="#forceSolve-1103"><span class="linenos">1103</span></a>
</span><span id="forceSolve-1104"><a href="#forceSolve-1104"><span class="linenos">1104</span></a>        <span class="n">contactAngleImages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outputFolderPath</span> <span class="o">+</span> <span class="s1">&#39;FitReport_src/contact_angles.gif&#39;</span><span class="p">,</span> <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="forceSolve-1105"><a href="#forceSolve-1105"><span class="linenos">1105</span></a>                                   <span class="n">append_images</span><span class="o">=</span><span class="n">contactAngleImages</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">duration</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="forceSolve-1106"><a href="#forceSolve-1106"><span class="linenos">1106</span></a>
</span><span id="forceSolve-1107"><a href="#forceSolve-1107"><span class="linenos">1107</span></a>    <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;showProgressBar&quot;</span><span class="p">]:</span>
</span><span id="forceSolve-1108"><a href="#forceSolve-1108"><span class="linenos">1108</span></a>        <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="forceSolve-1109"><a href="#forceSolve-1109"><span class="linenos">1109</span></a>        <span class="n">bar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="forceSolve-1110"><a href="#forceSolve-1110"><span class="linenos">1110</span></a>
</span><span id="forceSolve-1111"><a href="#forceSolve-1111"><span class="linenos">1111</span></a>    <span class="k">return</span> <span class="n">rectForceArr</span><span class="p">,</span> <span class="n">rectAlphaArr</span><span class="p">,</span> <span class="n">rectBetaArr</span><span class="p">,</span> <span class="n">rectCenterArr</span><span class="p">,</span> <span class="n">rectRadiusArr</span><span class="p">,</span> <span class="n">rectAngleArr</span>
</span></pre></div>


            <div class="docstring"><p>Complete pipeline to solve for forces and particle positions for all image files
in a directory. Results will be returned and potentially written to various files.
See <code>Returns</code> section for more information</p>

<p>Expects all particles to be the same (or very similar) sizes. This assumption is made
by the calculation of the gradient squared calibration value, which is computed just
once using the guess of the radii. This should not be a problem if the radii are only
slightly varied (~10 pixels or something) but any more than that and errors will begin
to accumulate.</p>

<p>This method has <strong>a lot</strong> of arguments; it is intended to be used once reasonable
values for all of these have already been found. While the <code>debug</code> option for this function
is very helpful, it is recommended to utilize the various notebooks/examples to find good
choices for parameters first.</p>

<p>The output readme file can also serve as a cache of the parameter values/settings, which
can be passed back to future calls of this method using the <code>inputSettingsFile</code> argument.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>imageDirectory</strong> (str):
An absolute or relative path to the directory containing the images that are
to be analyzed. The names of the images need not follow any particular naming
scheme, but they should be such that sorting the list alphabetically will give
the images in their proper order.</li>
<li><p><strong>guessRadius</strong> (float):
The radius of the particles to be detected, in pixels. As of now, this value will
be taken as the particle radius, but future versions may be able to vary this to
find the optimal value.</p>

<p>Currently no support for particles of different sizes.</p></li>
<li><strong>fSigma</strong> (float):
Stress optic coefficient, relating to material thickness, wavelength of light and
other material property (denoted as C in most literature; sometimes also called the
"stress optic coefficient").</li>
<li><p><strong>pxPerMeter</strong> (float):
The number of pixels per meter in the images. Depends on the camera, lens, and 
zoom settings used to capture the images.</p>

<p>Note that this is <strong>not</strong> the inverse of the number of pixels per meter, as is used
in some of the other force solving implementations.</p></li>
<li><strong>brightfield</strong> (bool):
Whether the images are captured using a brightfield polariscope (<code>True</code>) or
a darkfield polariscope (<code>False</code>).</li>
<li><strong>contactPadding</strong> (int):
Maximum distance (in pixels) between a particle's edge and the wall or the edges of two
particles that will still be considered a potential force-bearing contact.</li>
<li><strong>g2MaskPadding</strong> (int or float):
Number of pixels to ignore at the edge of each particle when calculating the average G^2.
If float value &lt; 1 is passed, gradient mask radius will be taken as that percent of the full
particle radius. A value of 0 means no padding is included.</li>
<li><strong>contactMaskRadius</strong> (float):
The radius of the circular mask that will be constructed around each contact to estimate
the magnitude of the force using the gradient squared in that region.</li>
<li><strong>lightCorrectionImage</strong> (str or np.ndarray[H,W[,C]]):
The path to an image (or an array representing an image) that contains no particles, and
can be used to correct for any light gradients present in the actual data.</li>
<li><strong>lightCorrectionHorizontalMask</strong> (str or np.ndarray[H,W[,C]]):
A mask array, containing values of <code>0</code> or <code>1</code>, with the latter representing areas over which
the horizontal light correction should be calculated. Can also be a path to an image.</li>
<li><strong>lightCorrectionVerticalMask</strong> (str or np.ndarray[H,W[,C]]):
A mask array, containing values of <code>0</code> or <code>1</code>, with the latter representing areas over which
the vertical light correction should be calculated. Can also be a path to an image.</li>
<li><strong>g2CalibrationImage</strong> (str or np.ndarray[H,W,C]):
An image with a single particle (or at least one particle) that has no force acting on it.
Used to determine the base level of gradient squared (due to noise) for a free particle. Can
also be a path to an image.</li>
<li><strong>g2CalibrationCutoffFactor</strong> (float):
The factor that is multipled by the mean gradient squared value of the particles in the 
calibration image. Any particle that has an average gradient squared value below the 
calibration value multipled by this factor will be assumed to have no forces acting on it.</li>
<li><strong>maskImage</strong> (str or np.ndarray[H,W,C]):
A mask array, containing values of <code>0</code> or <code>1</code>, with the latter representing the regions of
importance for the image. Used in detecting particles, generating initial guesses, and
calculating error during non-linear optimization. can also be a path to an image.</li>
<li><strong>cropXMin</strong> (int or None):
Left bound to crop down the image in the x direction.</li>
<li><strong>cropXMax</strong> (int or None):
Right bound to crop down the image in the x direction.</li>
<li><strong>peBlurKernel</strong> (int):
The kernel size that will be used for bluring the photoelastic channel of each image, to
reduce noise. Should be an odd integer.</li>
<li><strong>imageExtension</strong> (str):
The extension of the image files that will be read in from <code>imageDirectory</code>. Should not include
the '.' before the extension.</li>
<li><p><strong>requireForceBalance</strong> (bool):
Whether to impose particle-wise force balance at each step (<code>True</code>) or to take the results of
the optimization process as they are (<code>False</code>).</p>

<p>Currently WIP, and does not do anything.</p></li>
<li><strong>forceBalanceWeighting</strong> (float):
If a non-zero positive value, adds a contribution to the optimization cost
pertaining to how well the ensemble of forces satisfy force balance.</li>
<li><strong>imageStartIndex</strong> (int or None):
The index of which image to start at when analyzing the files in <code>imageDirectory</code>. Value
of <code>None</code> will start at the first (alphabetically sorted) image.</li>
<li><strong>imageEndIndex</strong> (int or None):
The index of which image to end at when analyzing the files in <code>imageDirectory</code>. Value
of <code>None</code> will end at the last (alphabetically sorted) image.</li>
<li><p><strong>circleDetectionMethod</strong> (['convolution' or 'hough']):
Whether to use the convolution or hough circle detection method to identify particles.</p>

<p>See <code>pepe.tracking.convCircle()</code> and <code>pepe.tracking.houghCircle()</code> for more information.</p></li>
<li><p><strong>circleTrackingKwargs</strong> (**kwargs):
Keyword arguments to be passed to the selected circle tracking function.</p>

<p>See <code>pepe.tracking.convCircle()</code> and <code>pepe.tracking.houghCircle()</code> for more information.</p></li>
<li><strong>circleTrackingChannel</strong> (int):
The channel of the image that will be used to track the particles. <code>0</code> for red, <code>1</code> for
green, and <code>2</code> for blue.</li>
<li><strong>circleTrackingGain</strong> (float):
The gain applied to the intensity in the circle tracking channel.</li>
<li><strong>maxBetaDisplacement</strong> (float):
The maximum distance (angle) that a force can move between frames and still be identified
as the same force. If a force moves more than this value, it will still be recorded as a force,
but will be considered a new and independent force from any of the ones in the previous frame.</li>
<li><strong>photoelasticChannel</strong> (int):
The channel of the image that will be used to gauge the photoelastic response. <code>0</code> for red, <code>1</code> for
green, and <code>2</code> for blue.</li>
<li><strong>photoelasticGain</strong> (float):
The gain applied to the intensity in the photoelastic channel.</li>
<li><strong>forceNoiseWidth</strong> (float or None):
The width of the gaussian distribution (centered at 0) that noise is sampled from to add to the
force guesses (potentially from the previous frame). This is done to avoid getting stuck in a local
minimum for too long (adds some Monte-Carlo-esque behavior to the solving).</li>
<li><strong>alphaNoiseWidth</strong> (float or None):
The width of the gaussian distribution (centered at 0) that noise is sampled from to add to the
alpha guesses (potentially from the previous frame). This is done to avoid getting stuck in a local
minimum for too long (adds some Monte-Carlo-esque behavior to the solving).</li>
<li><p><strong>optimizationKwargs</strong> (**kwargs):
Keyword arguments to be passed to the optimization process.</p>

<p>For more information, see <code>pepe.analysis.forceOptimize()</code>.</p></li>
<li><p><strong>performOptimization</strong> (bool):
Whether or not to perform optimization on the particles.</p>

<p>Mostly included as a debug option, but any real data analysis should
utilize the optimization, as the initial guessing is often not nearly
accurate enough to get any real results.</p></li>
<li><strong>debug</strong> (bool):
Whether to print progress updates for each frame to the screen (<code>True</code>) or not (<code>False</code>).</li>
<li><strong>showProgressBar</strong> (bool):
Whether to show a progress bar throughout the analysis (<code>True</code>) or not (<code>False</code>). Uses
<code>tqdm</code> library.</li>
<li><strong>progressBarOffset</strong> (int):
The number of lines to offset the progress bar by. Generally an internal variable
used when multiple threads are active.</li>
<li><strong>progressBarTitle</strong> (str):
The text to be written to the left of the progress bar. Generally an internal variable
controlled by some solving script.</li>
<li><strong>saveMovie</strong> (bool):
Whether to save a compiled gif of the reconstructed forces at each frame at the end (<code>True</code>)
or not (<code>False</code>).</li>
<li><strong>outputRootFolder</strong> (str):
The location where the output folder (potentially containg the movie, pickle files, readme, etc.)
will be created. Output folder itself will be named after the <code>imageDirectory</code>, with '_Synthetic'
appended to the end.</li>
<li><strong>pickleArrays</strong> (bool):
Whether to save the forces, betas, alphas, centers, and radii as pickle files (<code>True</code>) or not (<code>False</code>).
Files will be located in the output folder (see <code>outputRootFolder</code>).</li>
<li><p><strong>inputSettingsFile</strong> (str):
Path to a readme file containg parameters for the solving process, likely generated from
a previous iteration of the program. Explicitly passed arguments will override those that
are included in the settings file.</p>

<p>Currently WIP and does not do anything.</p></li>
<li><p><strong>genFitReport</strong> (bool):
Whether or not to generate a fit report of the results, including errors per frame,
examinations of all particles/forces, and settings, compiled in a latex pdf.</p>

<p>Will generate both the compiled file 'FitReport.pdf' and the source directory
'FitReport_src/'.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>rectForceArr</strong> (list<a href="np.ndarray[F,T]">P</a>):
A list of arrays representing the force magnitude for each force on each particle.</li>
<li><strong>rectAlphaArr</strong> (list<a href="np.ndarray[F,T]">P</a>):
A list of arrays representing the alpha angle for each force on each particle.</li>
<li><strong>rectBetaArr</strong> (list<a href="np.ndarray[F,T]">P</a>):
A list of arrays representing the beta angle for force on each particle.</li>
<li><strong>rectCenterArr</strong> (np.ndarray[P,T,2]):
Particle centers for each timestep. Elements take on a value of <code>[np.nan, np.nan]</code>
if the particle does not exist for a given timestep.</li>
<li><strong>rectRadiusArr</strong> (np.ndarray[P,T]):
Particle radii for each timestep. Elements take on a value of <code>np.nan</code> if the particle
does not exist for a given timestep.</li>
<li><strong>Depending on kwarg values, several files may be written created in the output</strong></li>
<li><strong>folder, which will be located in <code>outputRootFolder</code> and named according</strong></li>
<li><strong>to</strong> ('&lt;<code>imageDirectory</code>&gt;_Synthetic/'.):</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>